!function e(r,s,n){function t(o,i){if(!s[o]){if(!r[o]){var l="function"==typeof require&&require;if(!i&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var g=s[o]={exports:{}};r[o][0].call(g.exports,function(e){var s=r[o][1][e];return t(s?s:e)},g,g.exports,e,r,s,n)}return s[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)t(n[o]);return t}({1:[function(e,r,s){"use strict";function n(){}angular.module("app").component("babyBassinetIcon",{templateUrl:"components/baby-bassinet-icon/baby-bassinet-icon.html",controller:[n],controllerAs:"vm",bindings:{rfisc:"=rfisc"}})},{}],2:[function(e,r,s){"use strict";function n(e,r,s,n){function t(){p.locked||s.checkServiceRemovalProhibited("meal")||(p.service.active=!p.service.active,p.service.active?o():s.removeExtraService({code:"meal"}))}function a(e,r){p.selectedFlight=e,p.selectedPassenger=r,i()}function o(){p.selectedFlight=m(),p.selectedPassenger=v(p.selectedFlight),i()}function i(){p.mealMenu=p.service.itemsByPassengerSegments[p.selectedPassenger][p.selectedFlight],void 0===p.mealMenuSubgroup&&(p.mealMenuSubgroup=!1)}function l(e,r){var n=g(p.selectedPassenger,p.selectedFlight),t={code:"meal",passenger_id:p.orderInfo.passengers[p.selectedPassenger].id,segment_id:p.orderInfo.plainFlights[p.selectedFlight].id,subgroup:p.service.subgroups[e],service_type:r.serviceType,rfisc:r.rfisc};p.locked||(n&&!s.checkServiceRemovalProhibited("meal",p.selectedPassenger,p.selectedFlight)?s.removeExtraService({code:"meal",passenger_id:p.orderInfo.passengers[p.selectedPassenger].id,segment_id:p.orderInfo.plainFlights[p.selectedFlight].id,service_type:n.serviceType,rfisc:n.rfisc},!0).then(function(){s.modifyExtraService(t)}):s.modifyExtraService(t))}function c(e,r){p.locked||s.checkServiceRemovalProhibited("meal",e,r)||s.removeExtraService({code:"meal",passenger_id:p.orderInfo.passengers[e].id,segment_id:p.orderInfo.plainFlights[r].id})}function g(e,r){var s,n,t;return p.orderInfo.editableExtraServicesByPassengers&&p.orderInfo.editableExtraServicesByPassengers[e]&&(n=p.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],n&&(t=_.findWhere(n,{code:"meal"}),t&&(s=t.serviceItem))),s}function d(){b.scrollTo(0)}function u(){b.scrollTo(b[0].scrollWidth)}function f(){var r=b[0].scrollLeft,s=b[0].scrollWidth,n=b[0].clientWidth,t=s-n-r;p.canScrollRight=0!==t,p.canScrollLeft=0!==r,e.$apply()}function m(){var e;for(e=0;e<p.orderInfo.plainFlights.length;e++)if(p.service.availableBySegments[e])return e;return-1}function v(e){var r;if(p.service.availableByPassengerSegments)for(r=0;r<p.orderInfo.passengers.length;r++)if(p.service.availableByPassengerSegments[r][e])return r;return-1}function h(){for(var e=0;e<p.orderInfo.plainFlights.length;e++)for(var r=0;r<p.orderInfo.passengers.length;r++)if(g(r,e))return!0;return!1}var p=this,b=r.find("div.passengersTableContainer");p.switchService=t,p.selectFlightPassenger=a,p.selectFirstAvailablePassengerFlight=o,p.setPassengerFlightMeal=l,p.removePassengerFlightMeal=c,p.getSelectedPassengerFlightMeal=g,p.scrollToStart=d,p.scrollToEnd=u,p.checkAllChoose=h,p.hasAlias=s.hasAlias,p.getAvailablePassengersCount=n.getAvailablePassengersCount,p.checkServiceRemovalProhibited=s.checkServiceRemovalProhibited,p.canScrollRight=!0,p.canScrollLeft=!1,p.selectedFlight=0,p.selectedPassenger=0,s.getParam("site.externalStorageBaseUrl")?p.mealImagesPath=s.getParam("site.externalStorageBaseUrl")+"/img/content/meal":p.mealImagesPath="./themes/websky/assets/static/img/content/meal",s.addOrderInfoListener(function(e){p.orderInfo=e},!1,!0),e.$watch("vm.service",function(){p.mealMenu&&i()}),b.on("scroll",f),p.service.active&&i()}angular.module("app").component("esMealRossiya",{templateUrl:"components/es-meal-rossiya/es-meal-rossiya.html",controller:["$scope","$element","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],3:[function(e,r,s){"use strict";function n(e,r,s,n,t){function a(){I.locked||n.checkServiceRemovalProhibited("seat")||(I.service.active=!I.service.active,I.service.active?c():(I.modifyError=!1,n.removeExtraService({code:"seat"}).then(o,function(e){e.error&&(I.modifyError=e.error)})))}function o(){I.seatMap=!1,I.selectedFlight=-1,I.selectedPassenger=-1}function i(e){x=e?"0px":jQuery("#seatMapCont .mCSB_container").css("top")}function l(e,r){i(I.selectedFlight!==e),I.selectedFlight=e,I.selectedPassenger=r,g()}function c(){I.selectedFlight=f(),I.selectedPassenger=m(I.selectedFlight),g()}function g(){-1!==I.selectedPassenger&&-1!==I.selectedFlight&&(I.loadingSeatMap=!0,I.seatMapError=!1,n.seatMap(I.orderInfo.passengers[I.selectedPassenger].id,I.orderInfo.plainFlights[I.selectedFlight].id).then(function(e){I.seatMap=e,I.loadingSeatMap=!1,s(function(){jQuery("#seatMapCont .mCSB_container").css("top",x)})},function(e){I.seatMapError=e.error,I.loadingSeatMap=!1}))}function d(e,r,s){I.locked||e.available&&r&&(i(),I.modifyError=!1,n.modifyExtraService({code:"seat",passenger_id:I.orderInfo.passengers[I.selectedPassenger].id,segment_id:I.orderInfo.plainFlights[I.selectedFlight].id,value:s+e.number,subgroup:I.service.commonSubgroup,rfisc:e.rfisc||"",service_type:"F"}).then(g,function(e){e.error&&(I.modifyError=e.error)}))}function u(){I.sunInfoByFlights=[],I.orderInfo.plainFlights.forEach(function(e,r){n.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){I.sunInfoByFlights[r]=e})})}function f(){var e;for(e=0;e<I.orderInfo.plainFlights.length;e++)if(I.service.availableBySegments[e])return e;return-1}function m(e){var r;if(I.service.availableByPassengerSegments)for(r=0;r<I.orderInfo.passengers.length;r++)if(I.service.availableByPassengerSegments[r][e])return r;return-1}function v(){F.scrollTo(0)}function h(){F.scrollTo(F[0].scrollWidth)}function p(){var r=F[0].scrollLeft,s=F[0].scrollWidth,n=F[0].clientWidth,t=s-n-r;I.canScrollRight=0!==t,I.canScrollLeft=0!==r,e.$apply()}function b(e){var r=t.getAvailablePassengersCount(e);return r+I.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function S(e,r){I.locked||n.checkServiceRemovalProhibited("seat",e,r)||(I.modifyError=!1,n.removeExtraService({code:"seat",passenger_id:I.orderInfo.passengers[e].id,segment_id:I.orderInfo.plainFlights[r].id}).then(function(){I.selectedFlight===r&&g()},function(e){e.error&&(I.modifyError=e.error)}))}function y(e,r){var s,n,t;return I.orderInfo.editableExtraServicesByPassengers&&I.orderInfo.editableExtraServicesByPassengers[e]&&(n=I.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],n&&(t=_.findWhere(n,{code:"seat"}),t&&(s=t.serviceItem))),s}function P(){for(var e=0;e<I.orderInfo.plainFlights.length;e++)for(var r=0;r<I.orderInfo.passengers.length;r++)if(y(r,e))return!0;return!1}var I=this,F=r.find("div.passengersTableContainer"),x="0px";I.switchService=a,I.selectFlightPassenger=l,I.selectFirstAvailablePassengerFlight=c,I.setPassengerFlightSeat=d,I.getSelectedPassengerFlightMeal=y,I.checkAllChoose=P,I.hasAlias=n.hasAlias,I.scrollToStart=v,I.scrollToEnd=h,I.getAvailablePassengersCount=t.getAvailablePassengersCount,I.getAvailablePassengersCountWrap=b,I.removePassengerFlightSeat=S,I.checkServiceRemovalProhibited=n.checkServiceRemovalProhibited,I.canScrollRight=!0,I.canScrollLeft=!1,n.addOrderInfoListener(function(e){I.orderInfo=e},!1,!0),u(),F.on("scroll",p),I.service.active&&c()}angular.module("app").component("esSeatRossiya",{templateUrl:"components/es-seat-rossiya/es-seat-rossiya.html",controller:["$scope","$element","$timeout","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],4:[function(e,r,s){"use strict";function n(e,r,s,n,t,a){function o(){g.loading=!0,s.retryRegister().then(function(r){r.lastName&&r.pnr?e.location="./order?pnr="+r.pnr+"&lastName="+r.lastName:g.loading=!1},function(e){g.loading=!1,g.errorMessage=e.error})}function i(){g.orderInfo.header&&g.orderInfo.header.regnum&&(g.loading=!0,s.bindOrder(g.orderInfo.header.regnum,g.lastName).then(function(){g.loading=!1,g.orderInfo.bindAlowed=!1,g.showBindOrderSuccessMessage=!0,r(function(){g.showBindOrderSuccessMessage=!1},1e4)},function(){g.loading=!1,g.showBindOrderFailMessage=!0,r(function(){g.showBindOrderFailMessage=!1},1e4)}))}function l(e){var r=!0;return g.orderInfo.passengers.forEach(function(s,n){g.orderInfo.allExtraServicesByPassengers&&g.orderInfo.allExtraServicesByPassengers[n]&&g.orderInfo.allExtraServicesByPassengers[n].passengerSegmentServices?g.orderInfo.allExtraServicesByPassengers[n].passengerSegmentServices.forEach(function(s){var n=_.findWhere(s,{code:e});(!s||!n||n&&n.serviceItem&&"ISSUED_WITH_EMD"!==n.serviceItem.status)&&(r=!1)}):r=!1}),r}function c(){s.clearSession().then(function(){t.goToSearchOrder()})}var g=this;g.loading=!0,g.errorMessage=!1,g.openExchange=t.goToExchange,g.openRefund=t.goToRefund,g.openAddServices=t.goToAddServices,g.suffixCount=n.suffixCount,g.retryPayment=o,g.bindOrder=i,g.checkAllPassengersHavePaidService=l,g.clearSession=c,s.searchOrder(g.pnrOrTicketNumber,g.lastName).then(function(t){var o=n.getParamFromLocation("result");g.orderInfo=t,!g.orderInfo.header||"being_paid"!==g.orderInfo.header.status&&"being_paid_for_exchange"!==g.orderInfo.header.status?g.loading=!1:"success"===o?s.waitPayment(g.orderInfo.header.regnum,g.lastName).then(function(){e.location="./order?pnr="+g.orderInfo.header.regnum+"&lastName="+g.lastName+"&result=success"},function(){g.loading=!1}):(g.orderInfo.hasFailedServices||(g.showPaymentFrame=!0),g.loading=!1),!g.orderInfo.hasFailedServices||o||!g.orderInfo.header||"being_paid"!==g.orderInfo.header.status&&"booked"!==g.orderInfo.header.status||r(function(){a.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){g.orderInfo.paymentRedirectTo&&(g.showPaymentFrame=!0),g.ignoreFailedServices=!0},disableOutsideCloseClick:!0})}),s.getParam("ffp.enable")&&(g.orderInfo.hasBonusCard||g.orderInfo.ffpSumm)&&s.ffpBonus().then(function(e){g.ffpBonus=e.total||0})},function(e){g.loading=!1,g.errorMessage=e.error})}angular.module("app").component("orderRossiya",{templateUrl:"components/order-rossiya/order-rossiya.html",controller:["$window","$timeout","backend","utils","redirect","fancyboxTools",n],controllerAs:"vm",bindings:{pnrOrTicketNumber:"=num",lastName:"=lastname"}})},{}],5:[function(e,r,s){"use strict";function n(e,r){function s(){l.availablePassengers=l.passengers.filter(function(e,r){return l.service.availableByPassengerSegments[r]&&l.service.availableByPassengerSegments[r][l.currentFlightIndex]})}function n(){l.mealMenuSubgroupMobile===!1?l.mealMenuSubgroup=!1:l.mealMenuSubgroup=1*l.mealMenuSubgroupMobile}function t(){for(var e=!1,r=l.currentPassengerIndex+1;r<l.passengers.length;r++)if(l.service.availableByPassengerSegments[r]&&l.service.availableByPassengerSegments[r][l.currentFlightIndex]){l.selectFlightPassenger(l.currentFlightIndex,r),e=!0;break}if(!e)for(var s=0;s<l.passengers.length;s++)if(l.service.availableByPassengerSegments[s]&&l.service.availableByPassengerSegments[s][l.currentFlightIndex]){l.selectFlightPassenger(l.currentFlightIndex,s);break}}function a(){for(var e=!1,r=l.currentPassengerIndex-1;r>-1;r--)if(l.service.availableByPassengerSegments[r]&&l.service.availableByPassengerSegments[r][l.currentFlightIndex]){l.selectFlightPassenger(l.currentFlightIndex,r),e=!0;break}if(!e)for(var s=l.passengers.length-1;s>-1;s--)if(l.service.availableByPassengerSegments[s]&&l.service.availableByPassengerSegments[s][l.currentFlightIndex]){l.selectFlightPassenger(l.currentFlightIndex,s);break}}function o(e){if(Array.isArray(e)){var r=e.reduce(function(e,r){return e.concat(r)},[]);return l.mealMenuSubgroup===!1?r:e}}function i(e,r){for(var s=0;s<r.length;s++)for(var n=0;n<r[s].length;n++)if(r[s][n].rfisc==e.rfisc)return s}var l=this;l.close=jQuery.fancybox.close,l.mealMenuSubgroupMobileChange=n,l.mealMenuSubgroup=!1,l.mealMenuSubgroupMobile="false",l.subgroupItems=e.createOptionsForUiSelect(l.subgroups,"all"),l.switchNext=t,l.switchPrev=a,l.arrayString=o,l.getGroupMeal=i,r.$watch("vm.currentFlightIndex",function(){s()})}angular.module("app").component("popupMealRossiya",{templateUrl:"components/popup-meal-rossiya/popup-meal-rossiya.html",controller:["utils","$scope",n],controllerAs:"vm",bindings:{mealMenu:"=menu",passenger:"=passenger",currentPassengerIndex:"=",currentFlightIndex:"=",passengers:"=passengers",flight:"=flight",setPassengerFlightMeal:"=handler",clearPassengerFlightMeal:"&remove",getPassengerFlightMeal:"=get",subgroups:"=subgroups",mealImagesPath:"=path",service:"=",selectFlightPassenger:"=select"}})},{}],6:[function(e,r,s){"use strict";e("./components/popup-meal-rossiya/popup-meal-rossiya"),e("./components/es-meal-rossiya/es-meal-rossiya"),e("./components/es-seat-rossiya/es-seat-rossiya"),e("./components/order-rossiya/order-rossiya"),e("./components/baby-bassinet-icon/baby-bassinet-icon")},{"./components/baby-bassinet-icon/baby-bassinet-icon":1,"./components/es-meal-rossiya/es-meal-rossiya":2,"./components/es-seat-rossiya/es-seat-rossiya":3,"./components/order-rossiya/order-rossiya":4,"./components/popup-meal-rossiya/popup-meal-rossiya":5}]},{},[6]);
//# sourceMappingURL=controllers-rossia.js.map
