!function e(r,s,n){function t(i,l){if(!s[i]){if(!r[i]){var o="function"==typeof require&&require;if(!l&&o)return o(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var g=s[i]={exports:{}};r[i][0].call(g.exports,function(e){var s=r[i][1][e];return t(s?s:e)},g,g.exports,e,r,s,n)}return s[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)t(n[i]);return t}({1:[function(e,r,s){"use strict";function n(e,r,s,n){function t(){p.locked||s.checkServiceRemovalProhibited("meal")||(p.service.active=!p.service.active,p.service.active?i():s.removeExtraService({code:"meal"}))}function a(e,r){p.selectedFlight=e,p.selectedPassenger=r,l()}function i(){p.selectedFlight=f(),p.selectedPassenger=h(p.selectedFlight),l()}function l(){p.mealMenu=p.service.itemsByPassengerSegments[p.selectedPassenger][p.selectedFlight],p.mealMenuSubgroup=!1}function o(e,r){var n=g(p.selectedPassenger,p.selectedFlight),t={code:"meal",passenger_id:p.orderInfo.passengers[p.selectedPassenger].id,segment_id:p.orderInfo.plainFlights[p.selectedFlight].id,subgroup:p.service.subgroups[e],service_type:r.serviceType,rfisc:r.rfisc};p.locked||(n&&!s.checkServiceRemovalProhibited("meal",p.selectedPassenger,p.selectedFlight)?s.removeExtraService({code:"meal",passenger_id:p.orderInfo.passengers[p.selectedPassenger].id,segment_id:p.orderInfo.plainFlights[p.selectedFlight].id,service_type:n.serviceType,rfisc:n.rfisc},!0).then(function(){s.modifyExtraService(t)}):s.modifyExtraService(t))}function c(e,r){p.locked||s.checkServiceRemovalProhibited("meal",e,r)||s.removeExtraService({code:"meal",passenger_id:p.orderInfo.passengers[e].id,segment_id:p.orderInfo.plainFlights[r].id})}function g(e,r){var s,n,t;return p.orderInfo.editableExtraServicesByPassengers&&p.orderInfo.editableExtraServicesByPassengers[e]&&(n=p.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],n&&(t=_.findWhere(n,{code:"meal"}),t&&(s=t.serviceItem))),s}function d(){S.scrollTo(0)}function u(){S.scrollTo(S[0].scrollWidth)}function v(){var r=S[0].scrollLeft,s=S[0].scrollWidth,n=S[0].clientWidth,t=s-n-r;p.canScrollRight=0!==t,p.canScrollLeft=0!==r,e.$apply()}function f(){var e;for(e=0;e<p.orderInfo.plainFlights.length;e++)if(p.service.availableBySegments[e])return e;return-1}function h(e){var r;if(p.service.availableByPassengerSegments)for(r=0;r<p.orderInfo.passengers.length;r++)if(p.service.availableByPassengerSegments[r][e])return r;return-1}function m(){for(var e=0,r=0,s=0;s<p.service.availableByPassengerSegments.length;s++)for(var n=0;n<p.service.availableByPassengerSegments[s].length;n++)p.service.availableByPassengerSegments[s][n]&&e++;for(var s=0;s<p.orderInfo.plainFlights.length;s++)for(var n=0;n<p.orderInfo.passengers.length;n++)g(n,s)&&r++;return r==e}var p=this,S=r.find("div.passengersTableContainer");p.switchService=t,p.selectFlightPassenger=a,p.selectFirstAvailablePassengerFlight=i,p.setPassengerFlightMeal=o,p.removePassengerFlightMeal=c,p.getSelectedPassengerFlightMeal=g,p.scrollToStart=d,p.scrollToEnd=u,p.checkAllChoose=m,p.hasAlias=s.hasAlias,p.getAvailablePassengersCount=n.getAvailablePassengersCount,p.checkServiceRemovalProhibited=s.checkServiceRemovalProhibited,p.canScrollRight=!0,p.canScrollLeft=!1,p.selectedFlight=0,p.selectedPassenger=0,s.getParam("site.externalStorageBaseUrl")?p.mealImagesPath=s.getParam("site.externalStorageBaseUrl")+"/img/content/meal":p.mealImagesPath="./themes/websky/assets/static/img/content/meal",s.addOrderInfoListener(function(e){p.orderInfo=e},!1,!0),e.$watch("vm.service",function(){p.mealMenu&&l()}),S.on("scroll",v),p.service.active&&l()}angular.module("app").component("esMealRossiya",{templateUrl:"components/es-meal-rossiya/es-meal-rossiya.html",controller:["$scope","$element","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],2:[function(e,r,s){"use strict";function n(e,r,s,n,t){function a(){F.locked||n.checkServiceRemovalProhibited("seat")||(F.service.active=!F.service.active,F.service.active?c():(F.modifyError=!1,n.removeExtraService({code:"seat"}).then(i,function(e){e.error&&(F.modifyError=e.error)})))}function i(){F.seatMap=!1,F.selectedFlight=-1,F.selectedPassenger=-1}function l(e){x=e?"0px":jQuery("#seatMapCont .mCSB_container").css("top")}function o(e,r){l(F.selectedFlight!==e),F.selectedFlight=e,F.selectedPassenger=r,g()}function c(){F.selectedFlight=v(),F.selectedPassenger=f(F.selectedFlight),g()}function g(){-1!==F.selectedPassenger&&-1!==F.selectedFlight&&(F.loadingSeatMap=!0,F.seatMapError=!1,n.seatMap(F.orderInfo.passengers[F.selectedPassenger].id,F.orderInfo.plainFlights[F.selectedFlight].id).then(function(e){F.seatMap=e,F.loadingSeatMap=!1,s(function(){jQuery("#seatMapCont .mCSB_container").css("top",x)})},function(e){F.seatMapError=e.error,F.loadingSeatMap=!1}))}function d(e,r,s){F.locked||e.available&&r&&(l(),F.modifyError=!1,n.modifyExtraService({code:"seat",passenger_id:F.orderInfo.passengers[F.selectedPassenger].id,segment_id:F.orderInfo.plainFlights[F.selectedFlight].id,value:s+e.number,subgroup:F.service.commonSubgroup,rfisc:e.rfisc||"",service_type:"F"}).then(g,function(e){e.error&&(F.modifyError=e.error)}))}function u(){F.sunInfoByFlights=[],F.orderInfo.plainFlights.forEach(function(e,r){n.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){F.sunInfoByFlights[r]=e})})}function v(){var e;for(e=0;e<F.orderInfo.plainFlights.length;e++)if(F.service.availableBySegments[e])return e;return-1}function f(e){var r;if(F.service.availableByPassengerSegments)for(r=0;r<F.orderInfo.passengers.length;r++)if(F.service.availableByPassengerSegments[r][e])return r;return-1}function h(){I.scrollTo(0)}function m(){I.scrollTo(I[0].scrollWidth)}function p(){var r=I[0].scrollLeft,s=I[0].scrollWidth,n=I[0].clientWidth,t=s-n-r;F.canScrollRight=0!==t,F.canScrollLeft=0!==r,e.$apply()}function S(e){var r=t.getAvailablePassengersCount(e);return r+F.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function P(e,r){F.locked||n.checkServiceRemovalProhibited("seat",e,r)||(F.modifyError=!1,n.removeExtraService({code:"seat",passenger_id:F.orderInfo.passengers[e].id,segment_id:F.orderInfo.plainFlights[r].id}).then(function(){F.selectedFlight===r&&g()},function(e){e.error&&(F.modifyError=e.error)}))}function b(e,r){var s,n,t;return F.orderInfo.editableExtraServicesByPassengers&&F.orderInfo.editableExtraServicesByPassengers[e]&&(n=F.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],n&&(t=_.findWhere(n,{code:"seat"}),t&&(s=t.serviceItem))),s}function y(){for(var e=0,r=0,s=0;s<F.service.availableByPassengerSegments.length;s++)for(var n=0;n<F.service.availableByPassengerSegments[s].length;n++)F.service.availableByPassengerSegments[s][n]&&e++;for(var s=0;s<F.orderInfo.plainFlights.length;s++)for(var n=0;n<F.orderInfo.passengers.length;n++)b(n,s)&&r++;return r==e}var F=this,I=r.find("div.passengersTableContainer"),x="0px";F.switchService=a,F.selectFlightPassenger=o,F.selectFirstAvailablePassengerFlight=c,F.setPassengerFlightSeat=d,F.getSelectedPassengerFlightMeal=b,F.checkAllChoose=y,F.hasAlias=n.hasAlias,F.scrollToStart=h,F.scrollToEnd=m,F.getAvailablePassengersCount=t.getAvailablePassengersCount,F.getAvailablePassengersCountWrap=S,F.removePassengerFlightSeat=P,F.checkServiceRemovalProhibited=n.checkServiceRemovalProhibited,F.canScrollRight=!0,F.canScrollLeft=!1,n.addOrderInfoListener(function(e){F.orderInfo=e},!1,!0),u(),I.on("scroll",p),F.service.active&&c()}angular.module("app").component("esSeatRossiya",{templateUrl:"components/es-seat-rossiya/es-seat-rossiya.html",controller:["$scope","$element","$timeout","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],3:[function(e,r,s){"use strict";function n(e){function r(){t.mealMenuSubgroupMobile===!1?t.mealMenuSubgroup=!1:t.mealMenuSubgroup=1*t.mealMenuSubgroupMobile}function s(){for(var e=!1,r=t.currentPassengerIndex+1;r<t.passengers.length;r++)if(t.service.availableByPassengerSegments[r]&&t.service.availableByPassengerSegments[r][t.currentFlightIndex]){t.selectFlightPassenger(t.currentFlightIndex,r),e=!0;break}if(!e)for(var s=0;s<t.passengers.length;s++)if(t.service.availableByPassengerSegments[s]&&t.service.availableByPassengerSegments[s][t.currentFlightIndex]){t.selectFlightPassenger(t.currentFlightIndex,s);break}}function n(){for(var e=!1,r=t.currentPassengerIndex-1;r>-1;r--)if(t.service.availableByPassengerSegments[r]&&t.service.availableByPassengerSegments[r][t.currentFlightIndex]){t.selectFlightPassenger(t.currentFlightIndex,r),e=!0;break}if(!e)for(var s=t.passengers.length-1;s>-1;s--)if(t.service.availableByPassengerSegments[s]&&t.service.availableByPassengerSegments[s][t.currentFlightIndex]){t.selectFlightPassenger(t.currentFlightIndex,s);break}}var t=this;t.close=jQuery.fancybox.close,t.mealMenuSubgroupMobileChange=r,t.mealMenuSubgroup=!1,t.mealMenuSubgroupMobile="false",t.subgroupItems=e.createOptionsForUiSelect(t.subgroups,"all"),t.switchNext=s,t.switchPrev=n,t.availablePassengers=t.passengers.filter(function(e,r){return t.service.availableByPassengerSegments[r]&&t.service.availableByPassengerSegments[r][t.currentFlightIndex]})}angular.module("app").component("popupMealRossiya",{templateUrl:"components/popup-meal-rossiya/popup-meal-rossiya.html",controller:["utils",n],controllerAs:"vm",bindings:{mealMenu:"=menu",passenger:"=passenger",currentPassengerIndex:"=",currentFlightIndex:"=",passengers:"=passengers",flight:"=flight",setPassengerFlightMeal:"=handler",clearPassengerFlightMeal:"&remove",getPassengerFlightMeal:"=get",subgroups:"=subgroups",mealImagesPath:"=path",service:"=",selectFlightPassenger:"=select"}})},{}],4:[function(e,r,s){"use strict";console.log("app: ",angular.module("app")),e("./components/popup-meal-rossiya/popup-meal-rossiya"),e("./components/es-meal-rossiya/es-meal-rossiya"),e("./components/es-seat-rossiya/es-seat-rossiya")},{"./components/es-meal-rossiya/es-meal-rossiya":1,"./components/es-seat-rossiya/es-seat-rossiya":2,"./components/popup-meal-rossiya/popup-meal-rossiya":3}]},{},[4]);
//# sourceMappingURL=controllers-rossia.js.map
