!function e(r,s,n){function a(i,o){if(!s[i]){if(!r[i]){var c="function"==typeof require&&require;if(!o&&c)return c(i,!0);if(t)return t(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var g=s[i]={exports:{}};r[i][0].call(g.exports,function(e){var s=r[i][1][e];return a(s?s:e)},g,g.exports,e,r,s,n)}return s[i].exports}for(var t="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(e,r,s){"use strict";angular.module("app").component("babyBassinetIconLegend",{templateUrl:"components/baby-bassinet-icon-legend/baby-bassinet-icon-legend.html"})},{}],2:[function(e,r,s){"use strict";angular.module("app").component("babyBassinetIcon",{templateUrl:"components/baby-bassinet-icon/baby-bassinet-icon.html",controller:function(){},controllerAs:"vm",bindings:{rfisc:"=rfisc",active:"=active",disabled:"=disabled"}})},{}],3:[function(e,r,s){"use strict";function n(e,r,s,n){function a(){h.locked||s.checkServiceRemovalProhibited("meal")||(h.service.active=!h.service.active,h.service.active?i():s.removeExtraService({code:"meal"}))}function t(e,r){h.selectedFlight=e,h.selectedPassenger=r,o()}function i(){h.selectedFlight=m(),h.selectedPassenger=v(h.selectedFlight),o()}function o(){h.mealMenu=h.service.itemsByPassengerSegments[h.selectedPassenger][h.selectedFlight],void 0===h.mealMenuSubgroup&&(h.mealMenuSubgroup=!1)}function c(e,r){var n=g(h.selectedPassenger,h.selectedFlight),a={code:"meal",passenger_id:h.orderInfo.passengers[h.selectedPassenger].id,segment_id:h.orderInfo.plainFlights[h.selectedFlight].id,subgroup:h.service.subgroups[e],service_type:r.serviceType,rfisc:r.rfisc};h.locked||(n&&!s.checkServiceRemovalProhibited("meal",h.selectedPassenger,h.selectedFlight)?s.removeExtraService({code:"meal",passenger_id:h.orderInfo.passengers[h.selectedPassenger].id,segment_id:h.orderInfo.plainFlights[h.selectedFlight].id,service_type:n.serviceType,rfisc:n.rfisc},!0).then(function(){s.modifyExtraService(a)}):s.modifyExtraService(a))}function l(e,r){h.locked||s.checkServiceRemovalProhibited("meal",e,r)||s.removeExtraService({code:"meal",passenger_id:h.orderInfo.passengers[e].id,segment_id:h.orderInfo.plainFlights[r].id})}function g(e,r){var s,n,a;return h.orderInfo.editableExtraServicesByPassengers&&h.orderInfo.editableExtraServicesByPassengers[e]&&(n=h.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],n&&(a=_.findWhere(n,{code:"meal"}),a&&(s=a.serviceItem))),s}function d(){b.scrollTo(0)}function u(){b.scrollTo(b[0].scrollWidth)}function f(){var r=b[0].scrollLeft,s=b[0].scrollWidth,n=b[0].clientWidth,a=s-n-r;h.canScrollRight=0!==a,h.canScrollLeft=0!==r,e.$apply()}function m(){var e;for(e=0;e<h.orderInfo.plainFlights.length;e++)if(h.service.availableBySegments[e])return e;return-1}function v(e){var r;if(h.service.availableByPassengerSegments)for(r=0;r<h.orderInfo.passengers.length;r++)if(h.service.availableByPassengerSegments[r][e])return r;return-1}function p(){for(var e=0;e<h.orderInfo.plainFlights.length;e++)for(var r=0;r<h.orderInfo.passengers.length;r++)if(g(r,e))return!0;return!1}var h=this,b=r.find("div.passengersTableContainer");h.switchService=a,h.selectFlightPassenger=t,h.selectFirstAvailablePassengerFlight=i,h.setPassengerFlightMeal=c,h.removePassengerFlightMeal=l,h.getSelectedPassengerFlightMeal=g,h.scrollToStart=d,h.scrollToEnd=u,h.checkAllChoose=p,h.hasAlias=s.hasAlias,h.getAvailablePassengersCount=n.getAvailablePassengersCount,h.checkServiceRemovalProhibited=s.checkServiceRemovalProhibited,h.canScrollRight=!0,h.canScrollLeft=!1,h.selectedFlight=0,h.selectedPassenger=0,s.getParam("site.externalStorageBaseUrl")?h.mealImagesPath=s.getParam("site.externalStorageBaseUrl")+"/img/content/meal":h.mealImagesPath="./themes/websky/assets/static/img/content/meal",s.addOrderInfoListener(function(e){h.orderInfo=e},!1,!0),e.$watch("vm.service",function(){h.mealMenu&&o()}),b.on("scroll",f),h.service.active&&o()}angular.module("app").component("esMealRossiya",{templateUrl:"components/es-meal-rossiya/es-meal-rossiya.html",controller:["$scope","$element","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],4:[function(e,r,s){"use strict";function n(e,r,s,n,a){function t(){x.locked||n.checkServiceRemovalProhibited("seat")||(x.service.active=!x.service.active,x.service.active?l():(x.modifyError=!1,n.removeExtraService({code:"seat"}).then(function(){i(),x.orderInfo.editable_extra_services&&_.findWhere(x.orderInfo.editable_extra_services,{code:"babyBassinet"})&&n.removeExtraService({code:"babyBassinet"})},function(e){e.error&&(x.modifyError=e.error)})))}function i(){x.seatMap=!1,x.selectedFlight=-1,x.selectedPassenger=-1}function o(e){M=e?"0px":jQuery("#seatMapCont .mCSB_container").css("top")}function c(e,r){o(x.selectedFlight!==e),x.selectedFlight=e,x.selectedPassenger=r,g()}function l(){x.selectedFlight=v(),x.selectedPassenger=p(x.selectedFlight),g()}function g(){-1!==x.selectedPassenger&&-1!==x.selectedFlight&&(x.loadingSeatMap=!0,x.seatMapError=!1,n.seatMap(x.orderInfo.passengers[x.selectedPassenger].id,x.orderInfo.plainFlights[x.selectedFlight].id).then(function(e){x.seatMap=e,x.seatMap.hasSeatsWithBabyBassinet=d(e),x.loadingSeatMap=!1,s(function(){jQuery("#seatMapCont .mCSB_container").css("top",M)})},function(e){x.seatMapError=e.error,x.loadingSeatMap=!1}))}function d(e){var r=!1;return e&&e.decks&&e.decks.forEach(function(e){e&&e.cabins&&e.cabins.forEach(function(e){e&&e.rows&&e.rows.forEach(function(e){e&&e.chairs&&e.chairs.forEach(function(e){u(e)&&(r=!0)})})})}),r}function u(e){var r=!1;return e&&e.properties&&e.properties.forEach(function(e){"babyBassinet"===e&&(r=!0)}),r}function f(e,r,s){var t,i=x.orderInfo.passengers[x.selectedPassenger].id,c=x.orderInfo.plainFlights[x.selectedFlight].id;x.locked||e.available&&r&&(o(),x.modifyError=!1,n.modifyExtraService({code:"seat",passenger_id:i,segment_id:c,value:s+e.number,subgroup:x.service.commonSubgroup,rfisc:e.rfisc||"",service_type:"F"}).then(function(){g(),u(e)?x.babyBassinetService&&x.babyBassinetService.itemsByPassengerSegments&&x.babyBassinetService.itemsByPassengerSegments[x.selectedPassenger]&&x.babyBassinetService.itemsByPassengerSegments[x.selectedPassenger][x.selectedFlight]&&(t=a.getFirstNotEmptySubListItem(x.babyBassinetService.itemsByPassengerSegments[x.selectedPassenger][x.selectedFlight]),t&&t.serviceType&&t.rfisc&&n.modifyExtraService({code:"babyBassinet",passenger_id:i,segment_id:c,subgroup:x.babyBassinetService.commonSubgroup,rfisc:t.rfisc,service_type:t.serviceType})):I(i,c)},function(e){e.error&&(x.modifyError=e.error)}))}function m(){x.sunInfoByFlights=[],x.orderInfo.plainFlights.forEach(function(e,r){n.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){x.sunInfoByFlights[r]=e})})}function v(){var e;for(e=0;e<x.orderInfo.plainFlights.length;e++)if(x.service.availableBySegments[e])return e;return-1}function p(e){var r;if(x.service.availableByPassengerSegments)for(r=0;r<x.orderInfo.passengers.length;r++)if(x.service.availableByPassengerSegments[r][e])return r;return-1}function h(){E.scrollTo(0)}function b(){E.scrollTo(E[0].scrollWidth)}function y(){var r=E[0].scrollLeft,s=E[0].scrollWidth,n=E[0].clientWidth,a=s-n-r;x.canScrollRight=0!==a,x.canScrollLeft=0!==r,e.$apply()}function S(e){var r=a.getAvailablePassengersCount(e);return r+x.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function P(e,r){var s=x.orderInfo.passengers[e].id,a=x.orderInfo.plainFlights[r].id;x.locked||n.checkServiceRemovalProhibited("seat",e,r)||(x.modifyError=!1,n.removeExtraService({code:"seat",passenger_id:s,segment_id:a}).then(function(){I(s,a),x.selectedFlight===r&&g()},function(e){e.error&&(x.modifyError=e.error)}))}function I(e,r){x.orderInfo.editableExtraServicesHeap&&_.findWhere(x.orderInfo.editableExtraServicesHeap,{groupCode:"babyBassinet",mainSegmentId:r,passengerId:e})&&n.removeExtraService({code:"babyBassinet",passenger_id:e,segment_id:r})}function F(e,r){var s,n,a;return x.orderInfo.editableExtraServicesByPassengers&&x.orderInfo.editableExtraServicesByPassengers[e]&&(n=x.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],n&&(a=_.findWhere(n,{code:"seat"}),a&&(s=a.serviceItem))),s}function B(){for(var e=0;e<x.orderInfo.plainFlights.length;e++)for(var r=0;r<x.orderInfo.passengers.length;r++)if(F(r,e))return!0;return!1}var x=this,E=r.find("div.passengersTableContainer"),M="0px";x.switchService=t,x.selectFlightPassenger=c,x.selectFirstAvailablePassengerFlight=l,x.setPassengerFlightSeat=f,x.getSelectedPassengerFlightMeal=F,x.checkAllChoose=B,x.hasAlias=n.hasAlias,x.scrollToStart=h,x.scrollToEnd=b,x.getAvailablePassengersCount=a.getAvailablePassengersCount,x.getAvailablePassengersCountWrap=S,x.removePassengerFlightSeat=P,x.checkServiceRemovalProhibited=n.checkServiceRemovalProhibited,x.canScrollRight=!0,x.canScrollLeft=!1,n.addOrderInfoListener(function(e){x.orderInfo=e},!1,!0),m(),E.on("scroll",y),x.service.active&&l()}angular.module("app").component("esSeatRossiya",{templateUrl:"components/es-seat-rossiya/es-seat-rossiya.html",controller:["$scope","$element","$timeout","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",babyBassinetService:"=",locked:"=locked"}})},{}],5:[function(e,r,s){"use strict";function n(e,r,s,n,a,t){function i(){g.loading=!0,s.retryRegister().then(function(r){r.lastName&&r.pnr?e.location="./order?pnr="+r.pnr+"&lastName="+r.lastName:g.loading=!1},function(e){g.loading=!1,g.errorMessage=e.error})}function o(){g.orderInfo.header&&g.orderInfo.header.regnum&&(g.loading=!0,s.bindOrder(g.orderInfo.header.regnum,g.lastName).then(function(){g.loading=!1,g.orderInfo.bindAlowed=!1,g.showBindOrderSuccessMessage=!0,r(function(){g.showBindOrderSuccessMessage=!1},1e4)},function(){g.loading=!1,g.showBindOrderFailMessage=!0,r(function(){g.showBindOrderFailMessage=!1},1e4)}))}function c(e){var r=!0;return g.orderInfo.passengers.forEach(function(s,n){g.orderInfo.allExtraServicesByPassengers&&g.orderInfo.allExtraServicesByPassengers[n]&&g.orderInfo.allExtraServicesByPassengers[n].passengerSegmentServices?g.orderInfo.allExtraServicesByPassengers[n].passengerSegmentServices.forEach(function(s){var n=_.findWhere(s,{code:e});(!s||!n||n&&n.serviceItem&&"ISSUED_WITH_EMD"!==n.serviceItem.status)&&(r=!1)}):r=!1}),r}function l(){s.clearSession().then(function(){a.goToSearchOrder()})}var g=this;g.loading=!0,g.errorMessage=!1,g.openExchange=a.goToExchange,g.openRefund=a.goToRefund,g.openAddServices=a.goToAddServices,g.suffixCount=n.suffixCount,g.retryPayment=i,g.bindOrder=o,g.checkAllPassengersHavePaidService=c,g.clearSession=l,s.searchOrder(g.pnrOrTicketNumber,g.lastName).then(function(a){var i=n.getParamFromLocation("result");g.orderInfo=a,!g.orderInfo.header||"being_paid"!==g.orderInfo.header.status&&"being_paid_for_exchange"!==g.orderInfo.header.status?g.loading=!1:"success"===i?s.waitPayment(g.orderInfo.header.regnum,g.lastName).then(function(){e.location="./order?pnr="+g.orderInfo.header.regnum+"&lastName="+g.lastName+"&result=success"},function(){g.loading=!1}):(g.orderInfo.hasFailedServices||(g.showPaymentFrame=!0),g.loading=!1),!g.orderInfo.hasFailedServices||i||!g.orderInfo.header||"being_paid"!==g.orderInfo.header.status&&"booked"!==g.orderInfo.header.status||r(function(){t.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){g.orderInfo.paymentRedirectTo&&(g.showPaymentFrame=!0),g.ignoreFailedServices=!0},disableOutsideCloseClick:!0})}),s.getParam("ffp.enable")&&(g.orderInfo.hasBonusCard||g.orderInfo.ffpSumm)&&s.ffpBonus().then(function(e){g.ffpBonus=e.total||0})},function(e){g.loading=!1,g.errorMessage=e.error})}angular.module("app").component("orderRossiya",{templateUrl:"components/order-rossiya/order-rossiya.html",controller:["$window","$timeout","backend","utils","redirect","fancyboxTools",n],controllerAs:"vm",bindings:{pnrOrTicketNumber:"=num",lastName:"=lastname"}})},{}],6:[function(e,r,s){"use strict";function n(e,r){function s(){c.availablePassengers=c.passengers.filter(function(e,r){return c.service.availableByPassengerSegments[r]&&c.service.availableByPassengerSegments[r][c.currentFlightIndex]})}function n(){c.mealMenuSubgroupMobile===!1?c.mealMenuSubgroup=!1:c.mealMenuSubgroup=1*c.mealMenuSubgroupMobile}function a(){for(var e=!1,r=c.currentPassengerIndex+1;r<c.passengers.length;r++)if(c.service.availableByPassengerSegments[r]&&c.service.availableByPassengerSegments[r][c.currentFlightIndex]){c.selectFlightPassenger(c.currentFlightIndex,r),e=!0;break}if(!e)for(var s=0;s<c.passengers.length;s++)if(c.service.availableByPassengerSegments[s]&&c.service.availableByPassengerSegments[s][c.currentFlightIndex]){c.selectFlightPassenger(c.currentFlightIndex,s);break}}function t(){for(var e=!1,r=c.currentPassengerIndex-1;r>-1;r--)if(c.service.availableByPassengerSegments[r]&&c.service.availableByPassengerSegments[r][c.currentFlightIndex]){c.selectFlightPassenger(c.currentFlightIndex,r),e=!0;break}if(!e)for(var s=c.passengers.length-1;s>-1;s--)if(c.service.availableByPassengerSegments[s]&&c.service.availableByPassengerSegments[s][c.currentFlightIndex]){c.selectFlightPassenger(c.currentFlightIndex,s);break}}function i(e){if(Array.isArray(e)){var r=e.reduce(function(e,r){return e.concat(r)},[]);return c.mealMenuSubgroup===!1?r:e}}function o(e,r){for(var s=0;s<r.length;s++)for(var n=0;n<r[s].length;n++)if(r[s][n].rfisc==e.rfisc)return s}var c=this;c.close=jQuery.fancybox.close,c.mealMenuSubgroupMobileChange=n,c.mealMenuSubgroup=!1,c.mealMenuSubgroupMobile="false",c.subgroupItems=e.createOptionsForUiSelect(c.subgroups,"all"),c.switchNext=a,c.switchPrev=t,c.arrayString=i,c.getGroupMeal=o,r.$watch("vm.currentFlightIndex",function(){s()})}angular.module("app").component("popupMealRossiya",{templateUrl:"components/popup-meal-rossiya/popup-meal-rossiya.html",controller:["utils","$scope",n],controllerAs:"vm",bindings:{mealMenu:"=menu",passenger:"=passenger",currentPassengerIndex:"=",currentFlightIndex:"=",passengers:"=passengers",flight:"=flight",setPassengerFlightMeal:"=handler",clearPassengerFlightMeal:"&remove",getPassengerFlightMeal:"=get",subgroups:"=subgroups",mealImagesPath:"=path",service:"=",selectFlightPassenger:"=select"}})},{}],7:[function(e,r,s){"use strict";e("./components/popup-meal-rossiya/popup-meal-rossiya"),e("./components/es-meal-rossiya/es-meal-rossiya"),e("./components/es-seat-rossiya/es-seat-rossiya"),e("./components/order-rossiya/order-rossiya"),e("./components/baby-bassinet-icon/baby-bassinet-icon"),e("./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend")},{"./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend":1,"./components/baby-bassinet-icon/baby-bassinet-icon":2,"./components/es-meal-rossiya/es-meal-rossiya":3,"./components/es-seat-rossiya/es-seat-rossiya":4,"./components/order-rossiya/order-rossiya":5,"./components/popup-meal-rossiya/popup-meal-rossiya":6}]},{},[7]);
//# sourceMappingURL=controllers-rossia.js.map
