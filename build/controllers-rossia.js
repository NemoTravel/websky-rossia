!function e(r,n,s){function t(i,o){if(!n[i]){if(!r[i]){var c="function"==typeof require&&require;if(!o&&c)return c(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[i]={exports:{}};r[i][0].call(d.exports,function(e){var n=r[i][1][e];return t(n?n:e)},d,d.exports,e,r,n,s)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<s.length;i++)t(s[i]);return t}({1:[function(e,r,n){"use strict";angular.module("app").component("babyBassinetIconLegend",{templateUrl:"components/baby-bassinet-icon-legend/baby-bassinet-icon-legend.html"})},{}],2:[function(e,r,n){"use strict";angular.module("app").component("babyBassinetIconTooltip",{templateUrl:"components/baby-bassinet-icon-tooltip/baby-bassinet-icon-tooltip.html"})},{}],3:[function(e,r,n){"use strict";angular.module("app").component("babyBassinetIcon",{templateUrl:"components/baby-bassinet-icon/baby-bassinet-icon.html",controller:function(){},controllerAs:"vm",bindings:{rfisc:"=rfisc",active:"=active",disabled:"=disabled"}})},{}],4:[function(e,r,n){"use strict";function s(e,r,n,s){function t(){F.locked||n.checkServiceRemovalProhibited("meal")||(F.service.active=!F.service.active,F.service.active?o():n.removeExtraService({code:"meal"}))}function a(e,r,s){0>s&&(F.locked||n.modifyExtraService({code:"meal",passenger_id:F.orderInfo.passengers[F.selectedPassenger].id,segment_id:F.orderInfo.plainFlights[F.selectedFlight].id,subgroup:F.service.subgroups[e],amount:(r.alreadySelectedCount||0)+s,service_type:r.serviceType,rfisc:r.rfisc})),!y()&&s>0&&(F.locked||n.modifyExtraService({code:"meal",passenger_id:F.orderInfo.passengers[F.selectedPassenger].id,segment_id:F.orderInfo.plainFlights[F.selectedFlight].id,subgroup:F.service.subgroups[e],amount:(r.alreadySelectedCount||0)+s,service_type:r.serviceType,rfisc:r.rfisc}))}function i(e,r){F.selectedFlight=e,F.selectedPassenger=r,c()}function o(){F.selectedFlight=v(),F.selectedPassenger=h(F.selectedFlight),c()}function c(){F.mealMenu=l(F.service.itemsByPassengerSegments[F.selectedPassenger][F.selectedFlight]),void 0===F.mealMenuSubgroup&&(F.mealMenuSubgroup=!1)}function l(e){var r=[];return e&&e.length&&e.forEach(function(e,n){e&&e.length&&e.forEach(function(e){e.subgroupNum=n,r.push(e)})}),r}function d(e,r){var s=u(F.selectedPassenger,F.selectedFlight),t={code:"meal",passenger_id:F.orderInfo.passengers[F.selectedPassenger].id,segment_id:F.orderInfo.plainFlights[F.selectedFlight].id,subgroup:F.service.subgroups[e],service_type:r.serviceType,rfisc:r.rfisc};F.locked||(s&&!n.checkServiceRemovalProhibited("meal",F.selectedPassenger,F.selectedFlight)?n.removeExtraService({code:"meal",passenger_id:F.orderInfo.passengers[F.selectedPassenger].id,segment_id:F.orderInfo.plainFlights[F.selectedFlight].id,service_type:s.serviceType,rfisc:s.rfisc},!0).then(function(){n.modifyExtraService(t)}):n.modifyExtraService(t))}function g(e,r){F.locked||n.checkServiceRemovalProhibited("meal",e,r)||n.removeExtraService({code:"meal",passenger_id:F.orderInfo.passengers[e].id,segment_id:F.orderInfo.plainFlights[r].id})}function u(e,r){var n,s,t;return F.orderInfo.editableExtraServicesByPassengers&&F.orderInfo.editableExtraServicesByPassengers[e]&&(s=F.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],s&&(t=_.findWhere(s,{code:"meal"}),t&&(n=t.serviceItem))),n}function f(){B.scrollTo(0)}function m(){B.scrollTo(B[0].scrollWidth)}function p(){var r=B[0].scrollLeft,n=B[0].scrollWidth,s=B[0].clientWidth,t=n-s-r;F.canScrollRight=0!==t,F.canScrollLeft=0!==r,e.$apply()}function v(){var e;for(e=0;e<F.orderInfo.plainFlights.length;e++)if(F.service.availableBySegments[e])return e;return-1}function h(e){var r;if(F.service.availableByPassengerSegments)for(r=0;r<F.orderInfo.passengers.length;r++)if(F.service.availableByPassengerSegments[r][e])return r;return-1}function b(){for(var e=0;e<F.orderInfo.plainFlights.length;e++)for(var r=0;r<F.orderInfo.passengers.length;r++)if(u(r,e))return!0;return!1}function y(){var e=0,r=F.selectedPassenger||0,n=F.selectedFlight||0,s=S(r,n);return F.mealMenu.forEach(function(r){e+=r.alreadySelectedCount}),e+=s,e>=3?!0:!1}function S(e,r){return F.orderInfo.groupedIssuedExtraServices&&F.orderInfo.groupedIssuedExtraServices.meal&&F.orderInfo.groupedIssuedExtraServices.meal[e]&&F.orderInfo.groupedIssuedExtraServices.meal[e][r]&&F.orderInfo.groupedIssuedExtraServices.meal[e][r].length?F.orderInfo.groupedIssuedExtraServices.meal[e][r].length:0}function I(e){for(var r={group:0,meal:{}},n=0;n<F.mealMenu.length;n++)F.mealMenu[n].rfisc==e.rfisc&&(r.meal=F.mealMenu[n],r.group=F.mealMenu[n].subgroupNum);return r}function P(e){return e&&e.length&&(e=e.map(function(e){return e&&e.length&&(e=e.map(function(e){var r=[];return e&&e.length&&(e.forEach(function(e){var n;if(e&&e.amount){n=angular.copy(e),n.amount=1,n.totalPrice=Big(e.totalPrice).div(e.amount).toFixed(2);for(var s=0;s<e.amount;s++)r.push(n)}}),e=r),e})),e})),e}var F=this,B=r.find("div.passengersTableContainer");F.switchService=t,F.selectFlightPassenger=i,F.selectFirstAvailablePassengerFlight=o,F.setPassengerFlightMeal=d,F.removePassengerFlightMeal=g,F.getSelectedPassengerFlightMeal=u,F.scrollToStart=f,F.scrollToEnd=m,F.checkAllChoose=b,F.mealCountChangeHandler=a,F.hasAlias=n.hasAlias,F.getAvailablePassengersCount=s.getAvailablePassengersCount,F.checkServiceRemovalProhibited=n.checkServiceRemovalProhibited,F.getLimitStatus=y,F.getMealInfo=I,F.canScrollRight=!0,F.canScrollLeft=!1,F.selectedFlight=0,F.selectedPassenger=0,n.getParam("site.externalStorageBaseUrl")?F.mealImagesPath=n.getParam("site.externalStorageBaseUrl")+"/img/content/meal":F.mealImagesPath="./themes/websky/assets/static/img/content/meal",n.addOrderInfoListener(function(e){e&&e.groupedEditableExtraServices&&e.groupedEditableExtraServices.meal&&(e.groupedEditableExtraServices.meal=P(e.groupedEditableExtraServices.meal)),F.orderInfo=e},!1,!0),e.$watch("vm.service",function(){F.mealMenu&&c()}),B.on("scroll",p),F.service.active&&c()}angular.module("app").component("esMealRossiya",{templateUrl:"components/es-meal-rossiya/es-meal-rossiya.html",controller:["$scope","$element","backend","utils",s],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],5:[function(e,r,n){"use strict";function s(e,r,n,s,t){function a(){E.locked||s.checkServiceRemovalProhibited("seat")||(E.service.active=!E.service.active,E.service.active?l():(E.modifyError=!1,s.removeExtraService({code:"seat"}).then(function(){i(),E.orderInfo.editable_extra_services&&_.findWhere(E.orderInfo.editable_extra_services,{code:"babyBassinet"})&&s.removeExtraService({code:"babyBassinet"})},function(e){e.error&&(E.modifyError=e.error)})))}function i(){E.seatMap=!1,E.selectedFlight=-1,E.selectedPassenger=-1}function o(e){k=e?"0px":jQuery(".passengersSeatMap").find(".mCSB_container").css("top")}function c(e,r){o(E.selectedFlight!==e),E.selectedFlight=e,E.selectedPassenger=r,d()}function l(){E.selectedFlight=v(),E.selectedPassenger=h(E.selectedFlight),d()}function d(){-1!==E.selectedPassenger&&-1!==E.selectedFlight&&(E.loadingSeatMap=!0,E.seatMapError=!1,s.seatMap(E.orderInfo.passengers[E.selectedPassenger].id,E.orderInfo.plainFlights[E.selectedFlight].id).then(function(e){E.seatMap=e,E.seatMap.hasSeatsWithBabyBassinet=u(e),E.seatMap.hasSeatsWithBabyBassinet&&(E.seatMap.babyBassinetCost=g()),E.loadingSeatMap=!1,n(function(){jQuery(".passengersSeatMap").find(".mCSB_container").css("top",k)})},function(e){E.seatMapError=e.error,E.loadingSeatMap=!1}))}function g(e,r){var n;return E.babyBassinetService&&E.babyBassinetService.itemsByPassengerSegments&&E.babyBassinetService.itemsByPassengerSegments[E.selectedPassenger]&&E.babyBassinetService.itemsByPassengerSegments[E.selectedPassenger][E.selectedFlight]&&(n=t.getFirstNotEmptySubListItem(E.babyBassinetService.itemsByPassengerSegments[E.selectedPassenger][E.selectedFlight]),n&&n.price&&n.currency)?{value:n.price,currency:n.currency}:void 0}function u(e){var r=!1;return e&&e.decks&&e.decks.forEach(function(e){e&&e.cabins&&e.cabins.forEach(function(e){e&&e.rows&&e.rows.forEach(function(e){e&&e.chairs&&e.chairs.forEach(function(e){f(e)&&(r=!0)})})})}),r}function f(e){var r=!1;return e&&e.properties&&e.properties.forEach(function(n){"babyBassinet"===n&&(r=!0,e.hasBabyBassinet=!0)}),r}function m(e,r,n){var a,i=E.orderInfo.passengers[E.selectedPassenger].id,o=E.orderInfo.plainFlights[E.selectedFlight].id;E.locked||e.available&&r&&(k=jQuery(".passengersSeatMap").find(".mCSB_container").css("top"),E.modifyError=!1,s.modifyExtraService({code:"seat",passenger_id:i,segment_id:o,value:n+e.number,subgroup:E.service.commonSubgroup,rfisc:e.rfisc||"",service_type:"F"}).then(function(){d(),f(e)?E.babyBassinetService&&E.babyBassinetService.itemsByPassengerSegments&&E.babyBassinetService.itemsByPassengerSegments[E.selectedPassenger]&&E.babyBassinetService.itemsByPassengerSegments[E.selectedPassenger][E.selectedFlight]&&(a=t.getFirstNotEmptySubListItem(E.babyBassinetService.itemsByPassengerSegments[E.selectedPassenger][E.selectedFlight]),a&&a.serviceType&&a.rfisc&&s.modifyExtraService({code:"babyBassinet",passenger_id:i,segment_id:o,subgroup:E.babyBassinetService.commonSubgroup,rfisc:a.rfisc,service_type:a.serviceType})):F(i,o)},function(e){e.error&&(E.modifyError=e.error)}))}function p(){E.sunInfoByFlights=[],E.orderInfo.plainFlights.forEach(function(e,r){s.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){E.sunInfoByFlights[r]=e})})}function v(){var e;for(e=0;e<E.orderInfo.plainFlights.length;e++)if(E.service.availableBySegments[e])return e;return-1}function h(e){var r;if(E.service.availableByPassengerSegments)for(r=0;r<E.orderInfo.passengers.length;r++)if(E.service.availableByPassengerSegments[r][e])return r;return-1}function b(){M.scrollTo(0)}function y(){M.scrollTo(M[0].scrollWidth)}function S(){var r=M[0].scrollLeft,n=M[0].scrollWidth,s=M[0].clientWidth,t=n-s-r;E.canScrollRight=0!==t,E.canScrollLeft=0!==r,e.$apply()}function I(e){var r=t.getAvailablePassengersCount(e);return r+E.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function P(e,r){var n=E.orderInfo.passengers[e].id,t=E.orderInfo.plainFlights[r].id;E.locked||s.checkServiceRemovalProhibited("seat",e,r)||(E.modifyError=!1,s.removeExtraService({code:"seat",passenger_id:n,segment_id:t}).then(function(){F(n,t),E.selectedFlight===r&&d()},function(e){e.error&&(E.modifyError=e.error)}))}function F(e,r){E.orderInfo.editableExtraServicesHeap&&_.findWhere(E.orderInfo.editableExtraServicesHeap,{groupCode:"babyBassinet",mainSegmentId:r,passengerId:e})&&s.removeExtraService({code:"babyBassinet",passenger_id:e,segment_id:r})}function B(e,r){var n,s,t;return E.orderInfo.editableExtraServicesByPassengers&&E.orderInfo.editableExtraServicesByPassengers[e]&&(s=E.orderInfo.editableExtraServicesByPassengers[e].passengerSegmentServices[r],s&&(t=_.findWhere(s,{code:"seat"}),t&&(n=t.serviceItem))),n}function x(){for(var e=0;e<E.orderInfo.plainFlights.length;e++)for(var r=0;r<E.orderInfo.passengers.length;r++)if(B(r,e))return!0;return!1}var E=this,M=r.find("div.passengersTableContainer"),k="0px";E.switchService=a,E.selectFlightPassenger=c,E.selectFirstAvailablePassengerFlight=l,E.setPassengerFlightSeat=m,E.getSelectedPassengerFlightMeal=B,E.checkAllChoose=x,E.hasAlias=s.hasAlias,E.scrollToStart=b,E.scrollToEnd=y,E.getAvailablePassengersCount=t.getAvailablePassengersCount,E.getAvailablePassengersCountWrap=I,E.removePassengerFlightSeat=P,E.checkServiceRemovalProhibited=s.checkServiceRemovalProhibited,E.canScrollRight=!0,E.canScrollLeft=!1,s.addOrderInfoListener(function(e){E.orderInfo=e},!1,!0),p(),M.on("scroll",S),E.service.active&&l()}angular.module("app").component("esSeatRossiya",{templateUrl:"components/es-seat-rossiya/es-seat-rossiya.html",controller:["$scope","$element","$timeout","backend","utils",s],controllerAs:"vm",bindings:{service:"=service",babyBassinetService:"=",locked:"=locked"}})},{}],6:[function(e,r,n){"use strict";function s(e,r,n,s,t,a){function i(){d.loading=!0,n.retryRegister().then(function(r){r.lastName&&r.pnr?e.location="./order?pnr="+r.pnr+"&lastName="+r.lastName:d.loading=!1},function(e){d.loading=!1,d.errorMessage=e.error})}function o(){d.orderInfo.header&&d.orderInfo.header.regnum&&(d.loading=!0,n.bindOrder(d.orderInfo.header.regnum,d.lastName).then(function(){d.loading=!1,d.orderInfo.bindAlowed=!1,d.showBindOrderSuccessMessage=!0,r(function(){d.showBindOrderSuccessMessage=!1},1e4)},function(){d.loading=!1,d.showBindOrderFailMessage=!0,r(function(){d.showBindOrderFailMessage=!1},1e4)}))}function c(e){var r=!0;return d.orderInfo.passengers.forEach(function(n,s){d.orderInfo.allExtraServicesByPassengers&&d.orderInfo.allExtraServicesByPassengers[s]&&d.orderInfo.allExtraServicesByPassengers[s].passengerSegmentServices?d.orderInfo.allExtraServicesByPassengers[s].passengerSegmentServices.forEach(function(n){var s=_.findWhere(n,{code:e});(!n||!s||s&&s.serviceItem&&"ISSUED_WITH_EMD"!==s.serviceItem.status)&&(r=!1)}):r=!1}),r}function l(){n.clearSession().then(function(){t.goToSearchOrder()})}var d=this;d.loading=!0,d.errorMessage=!1,d.openExchange=t.goToExchange,d.openRefund=t.goToRefund,d.openAddServices=t.goToAddServices,d.suffixCount=s.suffixCount,d.retryPayment=i,d.bindOrder=o,d.checkAllPassengersHavePaidService=c,d.clearSession=l,n.searchOrder(d.pnrOrTicketNumber,d.lastName).then(function(t){var i=s.getParamFromLocation("result");d.orderInfo=t,!d.orderInfo.header||"being_paid"!==d.orderInfo.header.status&&"being_paid_for_exchange"!==d.orderInfo.header.status?d.loading=!1:"success"===i?n.waitPayment(d.orderInfo.header.regnum,d.lastName).then(function(){e.location="./order?pnr="+d.orderInfo.header.regnum+"&lastName="+d.lastName+"&result=success"},function(){d.loading=!1}):(d.orderInfo.hasFailedServices||(d.showPaymentFrame=!0),d.loading=!1),!d.orderInfo.hasFailedServices||i||!d.orderInfo.header||"being_paid"!==d.orderInfo.header.status&&"booked"!==d.orderInfo.header.status||r(function(){a.openHandler("popupRemovedServicesWarning",!1,{submitCallback:function(){d.orderInfo.paymentRedirectTo&&(d.showPaymentFrame=!0),d.ignoreFailedServices=!0},disableOutsideCloseClick:!0})}),n.getParam("ffp.enable")&&(d.orderInfo.hasBonusCard||d.orderInfo.ffpSumm)&&n.ffpBonus().then(function(e){d.ffpBonus=e.total||0})},function(e){d.loading=!1,d.errorMessage=e.error})}angular.module("app").component("orderRossiya",{templateUrl:"components/order-rossiya/order-rossiya.html",controller:["$window","$timeout","backend","utils","redirect","fancyboxTools",s],controllerAs:"vm",bindings:{pnrOrTicketNumber:"=num",lastName:"=lastname"}})},{}],7:[function(e,r,n){"use strict";function s(e,r){function n(e){f.detailedView.open=!0,f.detailedView.mealIndex=e}function s(){f.detailedView.open=!1}function t(){f.detailedView.mealIndex<f.mealMenu.length-1?f.detailedView.mealIndex++:f.detailedView.mealIndex=0}function a(){f.detailedView.mealIndex>0?f.detailedView.mealIndex--:f.detailedView.mealIndex=f.mealMenu.length-1}function i(){f.availablePassengers=f.passengers.filter(function(e,r){return f.service.availableByPassengerSegments[r]&&f.service.availableByPassengerSegments[r][f.currentFlightIndex]})}function o(){f.mealMenuSubgroupMobile===!1?f.mealMenuSubgroup=!1:f.mealMenuSubgroup=1*f.mealMenuSubgroupMobile}function c(){for(var e=!1,r=f.currentPassengerIndex+1;r<f.passengers.length;r++)if(f.service.availableByPassengerSegments[r]&&f.service.availableByPassengerSegments[r][f.currentFlightIndex]){f.selectFlightPassenger(f.currentFlightIndex,r),e=!0;break}if(!e)for(var n=0;n<f.passengers.length;n++)if(f.service.availableByPassengerSegments[n]&&f.service.availableByPassengerSegments[n][f.currentFlightIndex]){f.selectFlightPassenger(f.currentFlightIndex,n);break}}function l(){for(var e=!1,r=f.currentPassengerIndex-1;r>-1;r--)if(f.service.availableByPassengerSegments[r]&&f.service.availableByPassengerSegments[r][f.currentFlightIndex]){f.selectFlightPassenger(f.currentFlightIndex,r),e=!0;break}if(!e)for(var n=f.passengers.length-1;n>-1;n--)if(f.service.availableByPassengerSegments[n]&&f.service.availableByPassengerSegments[n][f.currentFlightIndex]){f.selectFlightPassenger(f.currentFlightIndex,n);break}}function d(e){if(Array.isArray(e)){var r=e.reduce(function(e,r){return e.concat(r)},[]);return f.mealMenuSubgroup===!1?r:e}}function g(e,r){for(var n=0;n<r.length;n++)for(var s=0;s<r[n].length;s++)if(r[n][s].rfisc==e.rfisc)return n}function u(){f.mealMenu=f.mealMenu||[];for(var e=0,r=0;r<f.mealMenu.length;r++)for(var n=0;n<f.mealMenu[r].length;n++)f.mealMenu[r][n].alreadySelectedCount&&(e+=f.mealMenu[r][n].price*f.mealMenu[r][n].alreadySelectedCount);return e}var f=this;f.close=jQuery.fancybox.close,f.mealMenuSubgroupMobileChange=o,f.mealMenuSubgroup=!1,f.mealMenuSubgroupMobile="false",f.subgroupItems=e.createOptionsForUiSelect(f.subgroups,"all"),f.switchNext=c,f.switchPrev=l,f.arrayString=d,f.getGroupMeal=g,f.detailedView={open:!1},f.setItemIndex=n,f.closeItemPopup=s,f.nextItemPopup=t,f.prevItemPopup=a,f.totalAmount=u,r.$watch("vm.currentFlightIndex",function(){i()})}angular.module("app").component("popupMealRossiya",{templateUrl:"components/popup-meal-rossiya/popup-meal-rossiya.html",controller:["utils","$scope",s],controllerAs:"vm",bindings:{mealMenu:"=menu",passenger:"=passenger",currentPassengerIndex:"=",currentFlightIndex:"=",passengers:"=passengers",flight:"=flight",mealCountChangeHandler:"=handler",clearPassengerFlightMeal:"&remove",getPassengerFlightMeal:"=get",subgroups:"=subgroups",mealImagesPath:"=path",service:"=",selectFlightPassenger:"=select",getLimitStatus:"=limit",mealSelect:"=",getMealInfo:"="}})},{}],8:[function(e,r,n){"use strict";e("./components/popup-meal-rossiya/popup-meal-rossiya"),e("./components/es-meal-rossiya/es-meal-rossiya"),e("./components/es-seat-rossiya/es-seat-rossiya"),e("./components/order-rossiya/order-rossiya"),e("./components/baby-bassinet-icon/baby-bassinet-icon"),e("./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend"),e("./components/baby-bassinet-icon-tooltip/baby-bassinet-icon-tooltip")},{"./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend":1,"./components/baby-bassinet-icon-tooltip/baby-bassinet-icon-tooltip":2,"./components/baby-bassinet-icon/baby-bassinet-icon":3,"./components/es-meal-rossiya/es-meal-rossiya":4,"./components/es-seat-rossiya/es-seat-rossiya":5,"./components/order-rossiya/order-rossiya":6,"./components/popup-meal-rossiya/popup-meal-rossiya":7}]},{},[8]);
//# sourceMappingURL=controllers-rossia.js.map
