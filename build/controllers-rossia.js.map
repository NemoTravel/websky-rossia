{"version":3,"sources":["controllers-rossia.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","MealRossiyaController","$scope","$element","backend","utils","switchService","vm","locked","checkServiceRemovalProhibited","service","active","selectFirstAvailablePassengerFlight","removeExtraService","selectFlightPassenger","flightNum","passengerNum","selectedFlight","selectedPassenger","updateMealMenu","getFirstAvailableFlightNum","getFirstAvailablePassengerNum","mealMenu","itemsByPassengerSegments","undefined","mealMenuSubgroup","setPassengerFlightMeal","subgroupNum","mealItem","selectedPassengerFlightMeal","getSelectedPassengerFlightMeal","newMealParams","passenger_id","orderInfo","passengers","id","segment_id","plainFlights","subgroup","subgroups","service_type","serviceType","rfisc","then","modifyExtraService","removePassengerFlightMeal","result","passengerSegmentServices","passengerSegmentMeal","editableExtraServicesByPassengers","_","findWhere","serviceItem","scrollToStart","passengersTableContainer","scrollTo","scrollToEnd","scrollWidth","mobileTableScrollHandler","scrollLeft","clientWidth","scrollRight","canScrollRight","canScrollLeft","$apply","availableBySegments","availableByPassengerSegments","checkAllChoose","j","this","find","hasAlias","getAvailablePassengersCount","getParam","mealImagesPath","addOrderInfoListener","$watch","on","angular","component","templateUrl","controller","controllerAs","bindings","2","SeatRossiyaController","$timeout","modifyError","clearFlightPassenger","resp","error","seatMap","setSeatMapContainerTopPosition","reset","seatMapContainerTopPosition","jQuery","css","updateSeatMap","loadingSeatMap","seatMapError","setPassengerFlightSeat","chair","cabinAllowed","rowNumber","available","value","number","commonSubgroup","updateSunInfoByFlights","sunInfoByFlights","forEach","flight","sunInfo","origincity","departuredate","departuretime","destinationcity","arrivaldate","arrivaltime","getAvailablePassengersCountWrap","count","filter","pax","hasSeats","removePassengerFlightSeat","passengerSegmentSeat","3","OrderRossiyaController","$window","redirect","fancyboxTools","retryPayment","loading","retryRegister","lastName","pnr","location","errorMessage","bindOrder","bindAlowed","showBindOrderSuccessMessage","showBindOrderFailMessage","checkAllPassengersHavePaidService","name","passenger","allExtraServicesByPassengers","segmentServices","segmentWantedService","status","clearSession","goToSearchOrder","openExchange","goToExchange","openRefund","goToRefund","openAddServices","goToAddServices","suffixCount","searchOrder","resultParam","getParamFromLocation","header","waitPayment","hasFailedServices","showPaymentFrame","openHandler","submitCallback","paymentRedirectTo","ignoreFailedServices","disableOutsideCloseClick","hasBonusCard","ffpSumm","ffpBonus","total","4","PopupMealRossiyaController","setAvailablePassengers","availablePassengers","index","currentFlightIndex","mealMenuSubgroupMobileChange","mealMenuSubgroupMobile","switchNext","successSwitch","currentPassengerIndex","switchPrev","arrayString","arrays","Array","isArray","reduce","flat","current","concat","getGroupMeal","meal","close","fancybox","subgroupItems","createOptionsForUiSelect","clearPassengerFlightMeal","getPassengerFlightMeal","5","./components/es-meal-rossiya/es-meal-rossiya","./components/es-seat-rossiya/es-seat-rossiya","./components/order-rossiya/order-rossiya","./components/popup-meal-rossiya/popup-meal-rossiya"],"mappings":"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","file":"controllers-rossia.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esMealRossiya', {\r\n    templateUrl: 'components/es-meal-rossiya/es-meal-rossiya.html',\r\n    controller: ['$scope', '$element','backend', 'utils', MealRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        service: '=service',\r\n        locked: '=locked'\r\n    }\r\n});\r\n\r\nfunction MealRossiyaController($scope, $element, backend, utils) {\r\n\r\n    var vm = this,\r\n        passengersTableContainer = $element.find('div.passengersTableContainer');\r\n\r\n    vm.switchService = switchService;\r\n    vm.selectFlightPassenger = selectFlightPassenger;\r\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\r\n    vm.setPassengerFlightMeal = setPassengerFlightMeal;\r\n    vm.removePassengerFlightMeal = removePassengerFlightMeal;\r\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\r\n    vm.scrollToStart = scrollToStart;\r\n    vm.scrollToEnd = scrollToEnd;\r\n    vm.checkAllChoose = checkAllChoose;\r\n    vm.hasAlias = backend.hasAlias;\r\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\r\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\r\n\r\n    vm.canScrollRight = true;\r\n    vm.canScrollLeft = false;\r\n\r\n    vm.selectedFlight = 0;\r\n    vm.selectedPassenger = 0;\r\n\r\n    if (backend.getParam('site.externalStorageBaseUrl')) {\r\n        vm.mealImagesPath = backend.getParam('site.externalStorageBaseUrl') + '/img/content/meal';\r\n    } else {\r\n        vm.mealImagesPath = './themes/websky/assets/static/img/content/meal';\r\n    }\r\n\r\n    backend.addOrderInfoListener(function (orderInfo) {\r\n        vm.orderInfo = orderInfo;\r\n    }, false, true);\r\n\r\n    $scope.$watch('vm.service', function () {\r\n        if (vm.mealMenu) {\r\n            updateMealMenu();\r\n        }\r\n    });\r\n\r\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\r\n\r\n    if (vm.service.active) {\r\n        updateMealMenu();\r\n    }\r\n\r\n    function switchService() {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal')) {\r\n            vm.service.active = !vm.service.active;\r\n            if (vm.service.active) {\r\n                selectFirstAvailablePassengerFlight();\r\n            } else {\r\n                backend.removeExtraService({\r\n                    code: 'meal'\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function selectFlightPassenger(flightNum, passengerNum) {\r\n        vm.selectedFlight = flightNum;\r\n        vm.selectedPassenger = passengerNum;\r\n        updateMealMenu();\r\n    }\r\n\r\n    function selectFirstAvailablePassengerFlight() {\r\n        vm.selectedFlight = getFirstAvailableFlightNum();\r\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\r\n        updateMealMenu();\r\n    }\r\n\r\n    function updateMealMenu() {\r\n        vm.mealMenu = vm.service.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight];\r\n        if (vm.mealMenuSubgroup === undefined) {\r\n            vm.mealMenuSubgroup = false;\r\n        }\r\n    }\r\n\r\n    function setPassengerFlightMeal(subgroupNum, mealItem) {\r\n        var selectedPassengerFlightMeal = getSelectedPassengerFlightMeal(vm.selectedPassenger, vm.selectedFlight),\r\n            newMealParams = {\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                subgroup: vm.service.subgroups[subgroupNum],\r\n                service_type: mealItem.serviceType,\r\n                rfisc: mealItem.rfisc\r\n            };\r\n        if (!vm.locked) {\r\n            if (\r\n                selectedPassengerFlightMeal &&\r\n                !backend.checkServiceRemovalProhibited('meal', vm.selectedPassenger, vm.selectedFlight)\r\n            ) {\r\n                backend.removeExtraService({\r\n                    code: 'meal',\r\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                    service_type: selectedPassengerFlightMeal.serviceType,\r\n                    rfisc: selectedPassengerFlightMeal.rfisc\r\n                }, true).then(function () {\r\n                    backend.modifyExtraService(newMealParams);\r\n                });\r\n            } else {\r\n                backend.modifyExtraService(newMealParams);\r\n            }\r\n        }\r\n    }\r\n\r\n    function removePassengerFlightMeal(passengerNum, flightNum) {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal', passengerNum, flightNum)) {\r\n            backend.removeExtraService({\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\r\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\r\n            });\r\n        }\r\n    }\r\n\r\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\r\n        var result,\r\n            passengerSegmentServices,\r\n            passengerSegmentMeal;\r\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\r\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\r\n                /* jshint maxlen: 150 */\r\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\r\n                if (passengerSegmentServices) {\r\n                    passengerSegmentMeal = _.findWhere(passengerSegmentServices, { code: 'meal' });\r\n                    if (passengerSegmentMeal) {\r\n                        result = passengerSegmentMeal.serviceItem;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function scrollToStart() {\r\n        passengersTableContainer.scrollTo(0);\r\n    }\r\n\r\n    function scrollToEnd() {\r\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\r\n    }\r\n\r\n    function mobileTableScrollHandler() {\r\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\r\n            scrollWidth = passengersTableContainer[0].scrollWidth,\r\n            clientWidth = passengersTableContainer[0].clientWidth,\r\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\r\n        vm.canScrollRight = (scrollRight !== 0);\r\n        vm.canScrollLeft = (scrollLeft !== 0);\r\n        $scope.$apply();\r\n    }\r\n\r\n    function getFirstAvailableFlightNum() {\r\n        var i;\r\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n            if (vm.service.availableBySegments[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function getFirstAvailablePassengerNum(flightNum) {\r\n        var i;\r\n        if (vm.service.availableByPassengerSegments) {\r\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\r\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function checkAllChoose() {\r\n\r\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\r\n          if (getSelectedPassengerFlightMeal(j, i)) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n}\r\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esSeatRossiya', {\r\n    templateUrl: 'components/es-seat-rossiya/es-seat-rossiya.html',\r\n    controller: ['$scope', '$element', '$timeout', 'backend', 'utils', SeatRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        service: '=service',\r\n        locked: '=locked'\r\n    }\r\n});\r\n\r\nfunction SeatRossiyaController($scope, $element, $timeout, backend, utils) {\r\n\r\n    var vm = this,\r\n        passengersTableContainer = $element.find('div.passengersTableContainer'),\r\n        seatMapContainerTopPosition = '0px';\r\n\r\n    vm.switchService = switchService;\r\n\r\n    vm.selectFlightPassenger = selectFlightPassenger;\r\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\r\n    vm.setPassengerFlightSeat = setPassengerFlightSeat;\r\n    //\r\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\r\n    vm.checkAllChoose = checkAllChoose;\r\n\r\n    vm.hasAlias = backend.hasAlias;\r\n\r\n    vm.scrollToStart = scrollToStart;\r\n    vm.scrollToEnd = scrollToEnd;\r\n\r\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\r\n    vm.getAvailablePassengersCountWrap = getAvailablePassengersCountWrap;\r\n\r\n    vm.removePassengerFlightSeat = removePassengerFlightSeat;\r\n\r\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\r\n\r\n    vm.canScrollRight = true;\r\n    vm.canScrollLeft = false;\r\n\r\n    backend.addOrderInfoListener(function (orderInfo) {\r\n        vm.orderInfo = orderInfo;\r\n    }, false, true);\r\n\r\n    updateSunInfoByFlights();\r\n\r\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\r\n\r\n    if (vm.service.active) {\r\n        selectFirstAvailablePassengerFlight();\r\n    }\r\n\r\n    function switchService() {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('seat')) {\r\n            vm.service.active = !vm.service.active;\r\n            if (vm.service.active) {\r\n                selectFirstAvailablePassengerFlight();\r\n            } else {\r\n                vm.modifyError = false;\r\n                backend.removeExtraService({\r\n                    code: 'seat'\r\n                }).then(clearFlightPassenger, function (resp) {\r\n                    if (resp.error) {\r\n                        vm.modifyError = resp.error;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function clearFlightPassenger() {\r\n        vm.seatMap = false;\r\n        vm.selectedFlight = -1;\r\n        vm.selectedPassenger = -1;\r\n    }\r\n\r\n    function setSeatMapContainerTopPosition(reset) {\r\n        if (reset) {\r\n            seatMapContainerTopPosition = '0px';\r\n        } else {\r\n            seatMapContainerTopPosition = jQuery('#seatMapCont .mCSB_container').css('top');\r\n        }\r\n    }\r\n\r\n    function selectFlightPassenger(flightNum, passengerNum) {\r\n        // Нужно запомнить положение карты мест для переключения между пассажирами одного сегмента\r\n        setSeatMapContainerTopPosition(vm.selectedFlight !== flightNum);\r\n        vm.selectedFlight = flightNum;\r\n        vm.selectedPassenger = passengerNum;\r\n        updateSeatMap();\r\n    }\r\n\r\n    function selectFirstAvailablePassengerFlight() {\r\n        vm.selectedFlight = getFirstAvailableFlightNum();\r\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\r\n        updateSeatMap();\r\n    }\r\n\r\n    function updateSeatMap() {\r\n\r\n        if (vm.selectedPassenger !== -1 && vm.selectedFlight !== -1) {\r\n            vm.loadingSeatMap = true;\r\n            vm.seatMapError = false;\r\n            backend.seatMap(\r\n                vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                vm.orderInfo.plainFlights[vm.selectedFlight].id\r\n            ).then(function (resp) {\r\n                vm.seatMap = resp;\r\n                vm.loadingSeatMap = false;\r\n                $timeout(function () {\r\n                    jQuery('#seatMapCont .mCSB_container').css('top', seatMapContainerTopPosition);\r\n                });\r\n            }, function (resp) {\r\n                vm.seatMapError = resp.error;\r\n                vm.loadingSeatMap = false;\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    function setPassengerFlightSeat(chair, cabinAllowed, rowNumber) {\r\n        if (!vm.locked) {\r\n            if (chair.available && cabinAllowed) {\r\n                setSeatMapContainerTopPosition();\r\n                vm.modifyError = false;\r\n                backend.modifyExtraService({\r\n                    code: 'seat',\r\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                    value: rowNumber + chair.number,\r\n                    subgroup: vm.service.commonSubgroup,\r\n                    rfisc: chair.rfisc || '',\r\n                    service_type: 'F'\r\n                }).then(updateSeatMap, function (resp) {\r\n                    if (resp.error) {\r\n                        vm.modifyError = resp.error;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function updateSunInfoByFlights() {\r\n        vm.sunInfoByFlights = [];\r\n        vm.orderInfo.plainFlights.forEach(function (flight, flightNum) {\r\n            backend.sunInfo(\r\n                flight.origincity,\r\n                flight.departuredate,\r\n                flight.departuretime,\r\n                flight.destinationcity,\r\n                flight.arrivaldate,\r\n                flight.arrivaltime\r\n            ).then(function (resp) {\r\n                vm.sunInfoByFlights[flightNum] = resp;\r\n            });\r\n        });\r\n    }\r\n\r\n    function getFirstAvailableFlightNum() {\r\n        var i;\r\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n            if (vm.service.availableBySegments[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function getFirstAvailablePassengerNum(flightNum) {\r\n        var i;\r\n        if (vm.service.availableByPassengerSegments) {\r\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\r\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function scrollToStart() {\r\n        passengersTableContainer.scrollTo(0);\r\n    }\r\n\r\n    function scrollToEnd() {\r\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\r\n    }\r\n\r\n    function mobileTableScrollHandler() {\r\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\r\n            scrollWidth = passengersTableContainer[0].scrollWidth,\r\n            clientWidth = passengersTableContainer[0].clientWidth,\r\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\r\n        vm.canScrollRight = (scrollRight !== 0);\r\n        vm.canScrollLeft = (scrollLeft !== 0);\r\n        $scope.$apply();\r\n    }\r\n\r\n    function getAvailablePassengersCountWrap(availableByPassengerSegments) {\r\n        var count = utils.getAvailablePassengersCount(availableByPassengerSegments);\r\n        return count + vm.orderInfo.passengers.filter(function (pax) {\r\n            return !pax.hasSeats;\r\n        }).length;\r\n    }\r\n\r\n    function removePassengerFlightSeat(passengerNum, flightNum) {\r\n        if (\r\n            !vm.locked && !backend.checkServiceRemovalProhibited('seat', passengerNum, flightNum)\r\n        ) {\r\n            vm.modifyError = false;\r\n            backend.removeExtraService({\r\n                code: 'seat',\r\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\r\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\r\n            }).then(function () {\r\n                if (vm.selectedFlight === flightNum) {\r\n                    updateSeatMap();\r\n                }\r\n            }, function (resp) {\r\n                if (resp.error) {\r\n                    vm.modifyError = resp.error;\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\r\n        var result,\r\n            passengerSegmentServices,\r\n            passengerSegmentSeat;\r\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\r\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\r\n                /* jshint maxlen: 150 */\r\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\r\n                if (passengerSegmentServices) {\r\n                    passengerSegmentSeat = _.findWhere(passengerSegmentServices, { code: 'seat' });\r\n                    if (passengerSegmentSeat) {\r\n                        result = passengerSegmentSeat.serviceItem;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function checkAllChoose() {\r\n\r\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\r\n          if (getSelectedPassengerFlightMeal(j, i)) {\r\n            return true\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n}\r\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\n\r\nangular.module('app').component('orderRossiya', {\r\n    templateUrl: 'components/order-rossiya/order-rossiya.html',\r\n    controller: ['$window', '$timeout', 'backend', 'utils', 'redirect', 'fancyboxTools', OrderRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        pnr: '=pnr',\r\n        lastName: '=lastname'\r\n    }\r\n});\r\n\r\nfunction OrderRossiyaController($window, $timeout, backend, utils, redirect, fancyboxTools) {\r\n\r\n    var vm = this;\r\n    vm.loading = true;\r\n    vm.errorMessage = false;\r\n    vm.openExchange = redirect.goToExchange;\r\n    vm.openRefund = redirect.goToRefund;\r\n    vm.openAddServices = redirect.goToAddServices;\r\n    vm.suffixCount = utils.suffixCount;\r\n    vm.retryPayment = retryPayment;\r\n    vm.bindOrder = bindOrder;\r\n    vm.checkAllPassengersHavePaidService = checkAllPassengersHavePaidService;\r\n    vm.clearSession = clearSession;\r\n\r\n    backend.searchOrder(vm.pnr, vm.lastName).then(function (orderInfo) {\r\n\r\n        var resultParam = utils.getParamFromLocation('result');\r\n\r\n        vm.orderInfo = orderInfo;\r\n\r\n        if (\r\n            vm.orderInfo.header &&\r\n            (\r\n                vm.orderInfo.header.status === 'being_paid' ||\r\n                vm.orderInfo.header.status === 'being_paid_for_exchange'\r\n            )\r\n        ) {\r\n            if (resultParam === 'success') {\r\n                backend.waitPayment(vm.pnr, vm.lastName).then(function () {\r\n                    $window.location = './order?pnr=' + vm.pnr + '&lastName=' + vm.lastName + '&result=success';\r\n                    return;\r\n                }, function () {\r\n                    vm.loading = false;\r\n                });\r\n            } else {\r\n                if (!vm.orderInfo.hasFailedServices) {\r\n                    vm.showPaymentFrame = true;\r\n                }\r\n                vm.loading = false;\r\n            }\r\n        } else {\r\n            vm.loading = false;\r\n        }\r\n\r\n        if (\r\n            vm.orderInfo.hasFailedServices &&\r\n            !resultParam &&\r\n            vm.orderInfo.header &&\r\n            (\r\n                vm.orderInfo.header.status === 'being_paid' ||\r\n                vm.orderInfo.header.status === 'booked'\r\n            )\r\n        ) {\r\n            $timeout(function () {\r\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\r\n                    submitCallback: function () {\r\n                        if (vm.orderInfo.paymentRedirectTo) {\r\n                            vm.showPaymentFrame = true;\r\n                        }\r\n                        vm.ignoreFailedServices = true;\r\n                    },\r\n                    disableOutsideCloseClick: true\r\n                });\r\n            });\r\n        }\r\n\r\n\r\n        if (\r\n            backend.getParam('ffp.enable') &&\r\n            (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)\r\n        ) {\r\n            backend.ffpBonus().then(function (resp) {\r\n                vm.ffpBonus = resp.total || 0;\r\n            });\r\n        }\r\n\r\n    }, function (resp) {\r\n        vm.loading = false;\r\n        vm.errorMessage = resp.error;\r\n    });\r\n\r\n    function retryPayment() {\r\n        vm.loading = true;\r\n        backend.retryRegister().then(function (resp) {\r\n            if (resp.lastName && resp.pnr) {\r\n                $window.location = './order?pnr=' + vm.pnr + '&lastName=' + vm.lastName;\r\n            } else {\r\n                vm.loading = false;\r\n            }\r\n        }, function (resp) {\r\n            vm.loading = false;\r\n            vm.errorMessage = resp.error;\r\n        });\r\n    }\r\n\r\n    function bindOrder() {\r\n        vm.loading = true;\r\n        backend.bindOrder(vm.pnr, vm.lastName).then(function () {\r\n            vm.loading = false;\r\n            vm.orderInfo.bindAlowed = false;\r\n            vm.showBindOrderSuccessMessage = true;\r\n            $timeout(function () {\r\n                vm.showBindOrderSuccessMessage = false;\r\n            }, 10000);\r\n        }, function () {\r\n            vm.loading = false;\r\n            vm.showBindOrderFailMessage = true;\r\n            $timeout(function () {\r\n                vm.showBindOrderFailMessage = false;\r\n            }, 10000);\r\n        });\r\n    }\r\n\r\n    function checkAllPassengersHavePaidService(name) {\r\n        var result = true;\r\n        vm.orderInfo.passengers.forEach(function (passenger, passengerNum) {\r\n            if (\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers &&\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum] &&\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices\r\n\t\t\t) {\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices.forEach(\r\n\t\t\t\t\tfunction (segmentServices) {\r\n\t\t\t\t\t\tvar segmentWantedService = _.findWhere(segmentServices, { code: name });\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t!segmentServices || !segmentWantedService ||\r\n\t\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t\tsegmentWantedService &&\r\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem &&\r\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem.status !== 'ISSUED_WITH_EMD'\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tresult = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tresult = false;\r\n\t\t\t}\r\n        });\r\n        return result;\r\n    }\r\n\r\n    function clearSession() {\r\n        backend.clearSession().then(function () {\r\n            redirect.goToSearchOrder();\r\n        });\r\n    }\r\n\r\n}\r\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('popupMealRossiya', {\r\n\ttemplateUrl: 'components/popup-meal-rossiya/popup-meal-rossiya.html',\r\n\tcontroller: ['utils', '$scope', PopupMealRossiyaController],\r\n\tcontrollerAs: 'vm',\r\n\tbindings: {\r\n\t\tmealMenu: '=menu',\r\n\t\tpassenger: '=passenger',\r\n\t\tcurrentPassengerIndex: '=',\r\n\t\tcurrentFlightIndex: '=',\r\n\t\tpassengers: '=passengers',\r\n\t\tflight: '=flight',\r\n\t\tsetPassengerFlightMeal: '=handler',\r\n\t\tclearPassengerFlightMeal: '&remove',\r\n\t\tgetPassengerFlightMeal: '=get',\r\n\t\tsubgroups: '=subgroups',\r\n\t\tmealImagesPath: '=path',\r\n\t\tservice: '=',\r\n\t\tselectFlightPassenger: '=select'\r\n\t}\r\n});\r\n\r\nfunction PopupMealRossiyaController(utils, $scope) {\r\n\r\n\tvar vm = this;\r\n\tvm.close = jQuery.fancybox.close;\r\n\tvm.mealMenuSubgroupMobileChange = mealMenuSubgroupMobileChange;\r\n\tvm.mealMenuSubgroup = false;\r\n\tvm.mealMenuSubgroupMobile = 'false';\r\n\tvm.subgroupItems = utils.createOptionsForUiSelect(vm.subgroups, 'all');\r\n\tvm.switchNext = switchNext;\r\n\tvm.switchPrev = switchPrev;\r\n\tvm.arrayString = arrayString;\r\n\tvm.getGroupMeal = getGroupMeal;\r\n\r\n\tfunction setAvailablePassengers() {\r\n\t\tvm.availablePassengers = vm.passengers.filter(function (passenger, index) {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index] &&\r\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index][vm.currentFlightIndex]\r\n\t\t\t\t\t);\r\n\t\t\t});\r\n\t}\r\n\r\n\t$scope.$watch('vm.currentFlightIndex', function () {\r\n\t\tsetAvailablePassengers();\r\n\t});\r\n\r\n\tfunction mealMenuSubgroupMobileChange() {\r\n\t\tif (vm.mealMenuSubgroupMobile === false) {\r\n\t\t\tvm.mealMenuSubgroup = false;\r\n\t\t} else {\r\n\t\t\tvm.mealMenuSubgroup = vm.mealMenuSubgroupMobile * 1;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction switchNext() {\r\n\t\tvar successSwitch = false;\r\n\t\tfor (var i = vm.currentPassengerIndex + 1; i < vm.passengers.length; i++) {\r\n\t\t\tif (\r\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\r\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\r\n\t\t\t) {\r\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\r\n\t\t\t\tsuccessSwitch = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!successSwitch) {\r\n\t\t\tfor (var j = 0; j < vm.passengers.length; j++) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\r\n\t\t\t\t) {\r\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction switchPrev() {\r\n\t\tvar successSwitch = false;\r\n\t\tfor (var i = vm.currentPassengerIndex - 1; i > -1; i--) {\r\n\t\t\tif (\r\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\r\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\r\n\t\t\t) {\r\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\r\n\t\t\t\tsuccessSwitch = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!successSwitch) {\r\n\t\t\tfor (var j = vm.passengers.length - 1; j > -1; j--) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\r\n\t\t\t\t) {\r\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction arrayString(arrays) {\r\n\r\n\t\tif(!Array.isArray(arrays)) return;\r\n\r\n\t\tvar total = arrays.reduce(function(flat, current) {\r\n\t\t\treturn flat.concat(current);\r\n\t\t}, []);\r\n\r\n\t\tif(vm.mealMenuSubgroup === false ) return total;\r\n\r\n\t\treturn arrays;\r\n\t}\r\n\r\n\tfunction getGroupMeal(meal, arrays) {\r\n\r\n\t\tfor (var i = 0; i < arrays.length; i++) {\r\n\t\t\tfor(var j = 0; j < arrays[i].length; j++) {\r\n\t\t\t\tif (arrays[i][j]['rfisc'] == meal['rfisc']) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\nrequire('./components/popup-meal-rossiya/popup-meal-rossiya');\r\nrequire('./components/es-meal-rossiya/es-meal-rossiya');\r\nrequire('./components/es-seat-rossiya/es-seat-rossiya');\r\nrequire('./components/order-rossiya/order-rossiya');\n},{\"./components/es-meal-rossiya/es-meal-rossiya\":1,\"./components/es-seat-rossiya/es-seat-rossiya\":2,\"./components/order-rossiya/order-rossiya\":3,\"./components/popup-meal-rossiya/popup-meal-rossiya\":4}]},{},[5]);\n"]}