<<<<<<< HEAD
{"version":3,"sources":["controllers-rossia.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","angular","component","templateUrl","2","controller","controllerAs","bindings","rfisc","active","3","MealRossiyaController","$scope","$element","backend","utils","switchService","vm","locked","checkServiceRemovalProhibited","service","selectFirstAvailablePassengerFlight","removeExtraService","mealCountChangeHandler","subgroupNum","mealItem","delta","modifyExtraService","passenger_id","orderInfo","passengers","selectedPassenger","id","segment_id","plainFlights","selectedFlight","subgroup","subgroups","amount","alreadySelectedCount","service_type","serviceType","selectFlightPassenger","flightNum","passengerNum","updateMealMenu","getFirstAvailableFlightNum","getFirstAvailablePassengerNum","mealMenu","itemsByPassengerSegments","undefined","mealMenuSubgroup","setPassengerFlightMeal","selectedPassengerFlightMeal","getSelectedPassengerFlightMeal","newMealParams","then","removePassengerFlightMeal","result","passengerSegmentServices","passengerSegmentMeal","editableExtraServicesByPassengers","_","findWhere","serviceItem","scrollToStart","passengersTableContainer","scrollTo","scrollToEnd","scrollWidth","mobileTableScrollHandler","scrollLeft","clientWidth","scrollRight","canScrollRight","canScrollLeft","$apply","availableBySegments","availableByPassengerSegments","checkAllChoose","j","this","find","hasAlias","getAvailablePassengersCount","getParam","mealImagesPath","addOrderInfoListener","$watch","on","4","SeatRossiyaController","$timeout","modifyError","clearFlightPassenger","editable_extra_services","resp","error","seatMap","setSeatMapContainerTopPosition","reset","seatMapContainerTopPosition","jQuery","css","updateSeatMap","loadingSeatMap","seatMapError","hasSeatsWithBabyBassinet","checkExistSeatsWithBabyBassinetBySeatMap","hasBabyBassinet","decks","forEach","deck","cabins","cabin","rows","row","chairs","chair","checkExistSeatsWithBabyBassinetByChair","properties","prop","setPassengerFlightSeat","cabinAllowed","rowNumber","babyBassinetItem","paxId","segId","available","value","number","commonSubgroup","babyBassinetService","getFirstNotEmptySubListItem","removeBabyBassinetIfExist","updateSunInfoByFlights","sunInfoByFlights","flight","sunInfo","origincity","departuredate","departuretime","destinationcity","arrivaldate","arrivaltime","getAvailablePassengersCountWrap","count","filter","pax","hasSeats","removePassengerFlightSeat","editableExtraServicesHeap","groupCode","mainSegmentId","passengerId","passengerSegmentSeat","5","OrderRossiyaController","$window","redirect","fancyboxTools","retryPayment","loading","retryRegister","lastName","pnr","location","errorMessage","bindOrder","header","regnum","bindAlowed","showBindOrderSuccessMessage","showBindOrderFailMessage","checkAllPassengersHavePaidService","name","passenger","allExtraServicesByPassengers","segmentServices","segmentWantedService","status","clearSession","goToSearchOrder","openExchange","goToExchange","openRefund","goToRefund","openAddServices","goToAddServices","suffixCount","searchOrder","pnrOrTicketNumber","resultParam","getParamFromLocation","waitPayment","hasFailedServices","showPaymentFrame","openHandler","submitCallback","paymentRedirectTo","ignoreFailedServices","disableOutsideCloseClick","hasBonusCard","ffpSumm","ffpBonus","total","6","PopupMealRossiyaController","setAvailablePassengers","availablePassengers","index","currentFlightIndex","mealMenuSubgroupMobileChange","mealMenuSubgroupMobile","switchNext","successSwitch","currentPassengerIndex","switchPrev","arrayString","arrays","Array","isArray","reduce","flat","current","concat","getGroupMeal","meal","close","fancybox","subgroupItems","createOptionsForUiSelect","clearPassengerFlightMeal","getPassengerFlightMeal","7","./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend","./components/baby-bassinet-icon/baby-bassinet-icon","./components/es-meal-rossiya/es-meal-rossiya","./components/es-seat-rossiya/es-seat-rossiya","./components/order-rossiya/order-rossiya","./components/popup-meal-rossiya/popup-meal-rossiya"],"mappings":"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","file":"controllers-rossia.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIconLegend', {\r\n    templateUrl: 'components/baby-bassinet-icon-legend/baby-bassinet-icon-legend.html'\r\n});\r\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIcon', {\r\n    templateUrl: 'components/baby-bassinet-icon/baby-bassinet-icon.html',\r\n    controller: function () {},\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        rfisc: '=rfisc',\r\n        active: '=active'\r\n    }\r\n});\r\n\r\n\r\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esMealRossiya', {\r\n    templateUrl: 'components/es-meal-rossiya/es-meal-rossiya.html',\r\n    controller: ['$scope', '$element','backend', 'utils', MealRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        service: '=service',\r\n        locked: '=locked'\r\n    }\r\n});\r\n\r\nfunction MealRossiyaController($scope, $element, backend, utils) {\r\n\r\n    var vm = this,\r\n        passengersTableContainer = $element.find('div.passengersTableContainer');\r\n\r\n    vm.switchService = switchService;\r\n    vm.selectFlightPassenger = selectFlightPassenger;\r\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\r\n    vm.setPassengerFlightMeal = setPassengerFlightMeal;\r\n    vm.removePassengerFlightMeal = removePassengerFlightMeal;\r\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\r\n    vm.scrollToStart = scrollToStart;\r\n    vm.scrollToEnd = scrollToEnd;\r\n    vm.checkAllChoose = checkAllChoose;\r\n    vm.mealCountChangeHandler = mealCountChangeHandler;\r\n    vm.hasAlias = backend.hasAlias;\r\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\r\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\r\n\r\n    vm.canScrollRight = true;\r\n    vm.canScrollLeft = false;\r\n\r\n    vm.selectedFlight = 0;\r\n    vm.selectedPassenger = 0;\r\n\r\n    if (backend.getParam('site.externalStorageBaseUrl')) {\r\n        vm.mealImagesPath = backend.getParam('site.externalStorageBaseUrl') + '/img/content/meal';\r\n    } else {\r\n        vm.mealImagesPath = './themes/websky/assets/static/img/content/meal';\r\n    }\r\n\r\n    backend.addOrderInfoListener(function (orderInfo) {\r\n        vm.orderInfo = orderInfo;\r\n    }, false, true);\r\n\r\n    $scope.$watch('vm.service', function () {\r\n        if (vm.mealMenu) {\r\n            updateMealMenu();\r\n        }\r\n    });\r\n\r\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\r\n\r\n    if (vm.service.active) {\r\n        updateMealMenu();\r\n    }\r\n\r\n    function switchService() {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal')) {\r\n            vm.service.active = !vm.service.active;\r\n            if (vm.service.active) {\r\n                selectFirstAvailablePassengerFlight();\r\n            } else {\r\n                backend.removeExtraService({\r\n                    code: 'meal'\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function mealCountChangeHandler(subgroupNum, mealItem, delta) {\r\n        if (!vm.locked) {\r\n            backend.modifyExtraService({\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                subgroup: vm.service.subgroups[subgroupNum],\r\n                amount: (mealItem.alreadySelectedCount || 0) + delta,\r\n                service_type: mealItem.serviceType,\r\n                rfisc: mealItem.rfisc\r\n            });\r\n        }\r\n    }\r\n\r\n    function selectFlightPassenger(flightNum, passengerNum) {\r\n        vm.selectedFlight = flightNum;\r\n        vm.selectedPassenger = passengerNum;\r\n        updateMealMenu();\r\n    }\r\n\r\n    function selectFirstAvailablePassengerFlight() {\r\n        vm.selectedFlight = getFirstAvailableFlightNum();\r\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\r\n        updateMealMenu();\r\n    }\r\n\r\n    function updateMealMenu() {\r\n        vm.mealMenu = vm.service.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight];\r\n        if (vm.mealMenuSubgroup === undefined) {\r\n            vm.mealMenuSubgroup = false;\r\n        }\r\n    }\r\n\r\n    function setPassengerFlightMeal(subgroupNum, mealItem) {\r\n        var selectedPassengerFlightMeal = getSelectedPassengerFlightMeal(vm.selectedPassenger, vm.selectedFlight),\r\n            newMealParams = {\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                subgroup: vm.service.subgroups[subgroupNum],\r\n                service_type: mealItem.serviceType,\r\n                rfisc: mealItem.rfisc\r\n            };\r\n        if (!vm.locked) {\r\n            if (\r\n                selectedPassengerFlightMeal &&\r\n                !backend.checkServiceRemovalProhibited('meal', vm.selectedPassenger, vm.selectedFlight)\r\n            ) {\r\n                backend.removeExtraService({\r\n                    code: 'meal',\r\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                    service_type: selectedPassengerFlightMeal.serviceType,\r\n                    rfisc: selectedPassengerFlightMeal.rfisc\r\n                }, true).then(function () {\r\n                    backend.modifyExtraService(newMealParams);\r\n                });\r\n            } else {\r\n                backend.modifyExtraService(newMealParams);\r\n            }\r\n        }\r\n    }\r\n\r\n    function removePassengerFlightMeal(passengerNum, flightNum) {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal', passengerNum, flightNum)) {\r\n            backend.removeExtraService({\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\r\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\r\n            });\r\n        }\r\n    }\r\n\r\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\r\n        var result,\r\n            passengerSegmentServices,\r\n            passengerSegmentMeal;\r\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\r\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\r\n                /* jshint maxlen: 150 */\r\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\r\n                if (passengerSegmentServices) {\r\n                    passengerSegmentMeal = _.findWhere(passengerSegmentServices, { code: 'meal' });\r\n                    if (passengerSegmentMeal) {\r\n                        result = passengerSegmentMeal.serviceItem;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function scrollToStart() {\r\n        passengersTableContainer.scrollTo(0);\r\n    }\r\n\r\n    function scrollToEnd() {\r\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\r\n    }\r\n\r\n    function mobileTableScrollHandler() {\r\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\r\n            scrollWidth = passengersTableContainer[0].scrollWidth,\r\n            clientWidth = passengersTableContainer[0].clientWidth,\r\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\r\n        vm.canScrollRight = (scrollRight !== 0);\r\n        vm.canScrollLeft = (scrollLeft !== 0);\r\n        $scope.$apply();\r\n    }\r\n\r\n    function getFirstAvailableFlightNum() {\r\n        var i;\r\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n            if (vm.service.availableBySegments[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function getFirstAvailablePassengerNum(flightNum) {\r\n        var i;\r\n        if (vm.service.availableByPassengerSegments) {\r\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\r\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function checkAllChoose() {\r\n\r\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\r\n          if (getSelectedPassengerFlightMeal(j, i)) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n}\r\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esSeatRossiya', {\r\n    templateUrl: 'components/es-seat-rossiya/es-seat-rossiya.html',\r\n    controller: ['$scope', '$element', '$timeout', 'backend', 'utils', SeatRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        service: '=service',\r\n        babyBassinetService: '=',\r\n        locked: '=locked'\r\n    }\r\n});\r\n\r\nfunction SeatRossiyaController($scope, $element, $timeout, backend, utils) {\r\n\r\n    var vm = this,\r\n        passengersTableContainer = $element.find('div.passengersTableContainer'),\r\n        seatMapContainerTopPosition = '0px';\r\n\r\n    vm.switchService = switchService;\r\n\r\n    vm.selectFlightPassenger = selectFlightPassenger;\r\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\r\n    vm.setPassengerFlightSeat = setPassengerFlightSeat;\r\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\r\n    vm.checkAllChoose = checkAllChoose;\r\n\r\n    vm.hasAlias = backend.hasAlias;\r\n\r\n    vm.scrollToStart = scrollToStart;\r\n    vm.scrollToEnd = scrollToEnd;\r\n\r\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\r\n    vm.getAvailablePassengersCountWrap = getAvailablePassengersCountWrap;\r\n\r\n    vm.removePassengerFlightSeat = removePassengerFlightSeat;\r\n\r\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\r\n\r\n    vm.canScrollRight = true;\r\n    vm.canScrollLeft = false;\r\n\r\n    backend.addOrderInfoListener(function (orderInfo) {\r\n        vm.orderInfo = orderInfo;\r\n    }, false, true);\r\n\r\n    updateSunInfoByFlights();\r\n\r\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\r\n\r\n    if (vm.service.active) {\r\n        selectFirstAvailablePassengerFlight();\r\n    }\r\n\r\n    function switchService() {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('seat')) {\r\n            vm.service.active = !vm.service.active;\r\n            if (vm.service.active) {\r\n                selectFirstAvailablePassengerFlight();\r\n            } else {\r\n                vm.modifyError = false;\r\n                backend.removeExtraService({\r\n                    code: 'seat'\r\n                }).then(function () {\r\n                    clearFlightPassenger();\r\n                    if (\r\n                        vm.orderInfo.editable_extra_services &&\r\n                        _.findWhere(vm.orderInfo.editable_extra_services, { code: 'babyBassinet' })\r\n                    ) {\r\n                        backend.removeExtraService({\r\n                            code: 'babyBassinet'\r\n                        })\r\n                    }\r\n                }, function (resp) {\r\n                    if (resp.error) {\r\n                        vm.modifyError = resp.error;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function clearFlightPassenger() {\r\n        vm.seatMap = false;\r\n        vm.selectedFlight = -1;\r\n        vm.selectedPassenger = -1;\r\n    }\r\n\r\n    function setSeatMapContainerTopPosition(reset) {\r\n        if (reset) {\r\n            seatMapContainerTopPosition = '0px';\r\n        } else {\r\n            seatMapContainerTopPosition = jQuery('#seatMapCont .mCSB_container').css('top');\r\n        }\r\n    }\r\n\r\n    function selectFlightPassenger(flightNum, passengerNum) {\r\n        // Нужно запомнить положение карты мест для переключения между пассажирами одного сегмента\r\n        setSeatMapContainerTopPosition(vm.selectedFlight !== flightNum);\r\n        vm.selectedFlight = flightNum;\r\n        vm.selectedPassenger = passengerNum;\r\n        updateSeatMap();\r\n    }\r\n\r\n    function selectFirstAvailablePassengerFlight() {\r\n        vm.selectedFlight = getFirstAvailableFlightNum();\r\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\r\n        updateSeatMap();\r\n    }\r\n\r\n    function updateSeatMap() {\r\n\r\n        if (vm.selectedPassenger !== -1 && vm.selectedFlight !== -1) {\r\n            vm.loadingSeatMap = true;\r\n            vm.seatMapError = false;\r\n            backend.seatMap(\r\n                vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                vm.orderInfo.plainFlights[vm.selectedFlight].id\r\n            ).then(function (resp) {\r\n                vm.seatMap = resp;\r\n                vm.seatMap.hasSeatsWithBabyBassinet = checkExistSeatsWithBabyBassinetBySeatMap(resp);\r\n                vm.loadingSeatMap = false;\r\n                $timeout(function () {\r\n                    jQuery('#seatMapCont .mCSB_container').css('top', seatMapContainerTopPosition);\r\n                });\r\n            }, function (resp) {\r\n                vm.seatMapError = resp.error;\r\n                vm.loadingSeatMap = false;\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    function checkExistSeatsWithBabyBassinetBySeatMap(seatMap) {\r\n        var hasBabyBassinet = false;\r\n        if (seatMap && seatMap.decks) {\r\n            seatMap.decks.forEach(function (deck) {\r\n                if (deck && deck.cabins) {\r\n                    deck.cabins.forEach(function (cabin) {\r\n                        if (cabin && cabin.rows) {\r\n                            cabin.rows.forEach(function (row) {\r\n                                if (row && row.chairs) {\r\n                                    row.chairs.forEach(function (chair) {\r\n                                        if (checkExistSeatsWithBabyBassinetByChair(chair)) {\r\n                                            hasBabyBassinet = true;\r\n                                        }\r\n                                    });\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        return hasBabyBassinet;\r\n    }\r\n\r\n    function checkExistSeatsWithBabyBassinetByChair(chair) {\r\n        var hasBabyBassinet = false;\r\n        if (chair && chair.properties) {\r\n            chair.properties.forEach(function (prop) {\r\n                if (prop === 'babyBassinet') {\r\n                    hasBabyBassinet = true\r\n                }\r\n            });\r\n        }\r\n        return hasBabyBassinet;\r\n    }\r\n\r\n    function setPassengerFlightSeat(chair, cabinAllowed, rowNumber) {\r\n        var babyBassinetItem,\r\n            paxId = vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n            segId = vm.orderInfo.plainFlights[vm.selectedFlight].id;\r\n        if (!vm.locked) {\r\n            if (chair.available && cabinAllowed) {\r\n                setSeatMapContainerTopPosition();\r\n                vm.modifyError = false;\r\n                backend.modifyExtraService({\r\n                    code: 'seat',\r\n                    passenger_id: paxId,\r\n                    segment_id: segId,\r\n                    value: rowNumber + chair.number,\r\n                    subgroup: vm.service.commonSubgroup,\r\n                    rfisc: chair.rfisc || '',\r\n                    service_type: 'F'\r\n                }).then(function () {\r\n                    updateSeatMap()\r\n                    if (checkExistSeatsWithBabyBassinetByChair(chair)) {\r\n                        if (\r\n                            vm.babyBassinetService &&\r\n                            vm.babyBassinetService.itemsByPassengerSegments &&\r\n                            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger] &&\r\n                            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]\r\n                        ) { \r\n                            babyBassinetItem = utils.getFirstNotEmptySubListItem(vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]);\r\n                            if (\r\n                                babyBassinetItem &&\r\n                                babyBassinetItem.serviceType &&\r\n                                babyBassinetItem.rfisc\r\n                            ) {\r\n                                backend.modifyExtraService({\r\n                                    code: 'babyBassinet',\r\n                                    passenger_id: paxId,\r\n                                    segment_id: segId,\r\n                                    subgroup: vm.babyBassinetService.commonSubgroup,\r\n                                    rfisc: babyBassinetItem.rfisc,\r\n                                    service_type: babyBassinetItem.serviceType\r\n                                })\r\n                            }\r\n                        }\r\n                    } else {\r\n                        removeBabyBassinetIfExist(paxId, segId);\r\n                    }\r\n                }, function (resp) {\r\n                    if (resp.error) {\r\n                        vm.modifyError = resp.error;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function updateSunInfoByFlights() {\r\n        vm.sunInfoByFlights = [];\r\n        vm.orderInfo.plainFlights.forEach(function (flight, flightNum) {\r\n            backend.sunInfo(\r\n                flight.origincity,\r\n                flight.departuredate,\r\n                flight.departuretime,\r\n                flight.destinationcity,\r\n                flight.arrivaldate,\r\n                flight.arrivaltime\r\n            ).then(function (resp) {\r\n                vm.sunInfoByFlights[flightNum] = resp;\r\n            });\r\n        });\r\n    }\r\n\r\n    function getFirstAvailableFlightNum() {\r\n        var i;\r\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n            if (vm.service.availableBySegments[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function getFirstAvailablePassengerNum(flightNum) {\r\n        var i;\r\n        if (vm.service.availableByPassengerSegments) {\r\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\r\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function scrollToStart() {\r\n        passengersTableContainer.scrollTo(0);\r\n    }\r\n\r\n    function scrollToEnd() {\r\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\r\n    }\r\n\r\n    function mobileTableScrollHandler() {\r\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\r\n            scrollWidth = passengersTableContainer[0].scrollWidth,\r\n            clientWidth = passengersTableContainer[0].clientWidth,\r\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\r\n        vm.canScrollRight = (scrollRight !== 0);\r\n        vm.canScrollLeft = (scrollLeft !== 0);\r\n        $scope.$apply();\r\n    }\r\n\r\n    function getAvailablePassengersCountWrap(availableByPassengerSegments) {\r\n        var count = utils.getAvailablePassengersCount(availableByPassengerSegments);\r\n        return count + vm.orderInfo.passengers.filter(function (pax) {\r\n            return !pax.hasSeats;\r\n        }).length;\r\n    }\r\n\r\n    function removePassengerFlightSeat(passengerNum, flightNum) {\r\n        var paxId = vm.orderInfo.passengers[passengerNum].id,\r\n            segId = vm.orderInfo.plainFlights[flightNum].id;\r\n        if (\r\n            !vm.locked && !backend.checkServiceRemovalProhibited('seat', passengerNum, flightNum)\r\n        ) {\r\n            vm.modifyError = false;\r\n            \r\n            backend.removeExtraService({\r\n                code: 'seat',\r\n                passenger_id: paxId,\r\n                segment_id: segId\r\n            }).then(function () {\r\n                removeBabyBassinetIfExist(paxId, segId);\r\n                if (vm.selectedFlight === flightNum) {\r\n                    updateSeatMap();\r\n                }\r\n            }, function (resp) {\r\n                if (resp.error) {\r\n                    vm.modifyError = resp.error;\r\n                }\r\n            });\r\n            \r\n           \r\n        }\r\n    }\r\n\r\n    function removeBabyBassinetIfExist(paxId, segId) {\r\n        if (\r\n            vm.orderInfo.editableExtraServicesHeap &&\r\n            _.findWhere(\r\n                vm.orderInfo.editableExtraServicesHeap,\r\n                {\r\n                    groupCode: 'babyBassinet',\r\n                    mainSegmentId: segId,\r\n                    passengerId: paxId\r\n                }\r\n            )\r\n        ) {\r\n            backend.removeExtraService({\r\n                code: 'babyBassinet',\r\n                passenger_id: paxId,\r\n                segment_id: segId\r\n            })\r\n        }\r\n    }\r\n\r\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\r\n        var result,\r\n            passengerSegmentServices,\r\n            passengerSegmentSeat;\r\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\r\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\r\n                /* jshint maxlen: 150 */\r\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\r\n                if (passengerSegmentServices) {\r\n                    passengerSegmentSeat = _.findWhere(passengerSegmentServices, { code: 'seat' });\r\n                    if (passengerSegmentSeat) {\r\n                        result = passengerSegmentSeat.serviceItem;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function checkAllChoose() {\r\n\r\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\r\n          if (getSelectedPassengerFlightMeal(j, i)) {\r\n            return true\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n}\r\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\r\nangular.module('app').component('orderRossiya', {\r\n    templateUrl: 'components/order-rossiya/order-rossiya.html',\r\n    controller: ['$window', '$timeout', 'backend', 'utils', 'redirect', 'fancyboxTools', OrderRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        pnrOrTicketNumber: '=num',\r\n        lastName: '=lastname'\r\n    }\r\n});\r\n\r\nfunction OrderRossiyaController($window, $timeout, backend, utils, redirect, fancyboxTools) {\r\n\r\n    var vm = this;\r\n    vm.loading = true;\r\n    vm.errorMessage = false;\r\n    vm.openExchange = redirect.goToExchange;\r\n    vm.openRefund = redirect.goToRefund;\r\n    vm.openAddServices = redirect.goToAddServices;\r\n    vm.suffixCount = utils.suffixCount;\r\n    vm.retryPayment = retryPayment;\r\n    vm.bindOrder = bindOrder;\r\n    vm.checkAllPassengersHavePaidService = checkAllPassengersHavePaidService;\r\n    vm.clearSession = clearSession;\r\n\r\n    backend.searchOrder(vm.pnrOrTicketNumber, vm.lastName).then(function (orderInfo) {\r\n\r\n        var resultParam = utils.getParamFromLocation('result');\r\n\r\n        vm.orderInfo = orderInfo;\r\n\r\n        if (\r\n            vm.orderInfo.header &&\r\n            (\r\n                vm.orderInfo.header.status === 'being_paid' ||\r\n                vm.orderInfo.header.status === 'being_paid_for_exchange'\r\n            )\r\n        ) {\r\n            if (resultParam === 'success') {\r\n                backend.waitPayment(vm.orderInfo.header.regnum, vm.lastName).then(function () {\r\n                    $window.location = './order?pnr=' + vm.orderInfo.header.regnum + '&lastName=' + vm.lastName + '&result=success';\r\n                    return;\r\n                }, function () {\r\n                    vm.loading = false;\r\n                });\r\n            } else {\r\n                if (!vm.orderInfo.hasFailedServices) {\r\n                    vm.showPaymentFrame = true;\r\n                }\r\n                vm.loading = false;\r\n            }\r\n        } else {\r\n            vm.loading = false;\r\n        }\r\n\r\n        if (\r\n            vm.orderInfo.hasFailedServices &&\r\n            !resultParam &&\r\n            vm.orderInfo.header &&\r\n            (\r\n                vm.orderInfo.header.status === 'being_paid' ||\r\n                vm.orderInfo.header.status === 'booked'\r\n            )\r\n        ) {\r\n            $timeout(function () {\r\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\r\n                    submitCallback: function () {\r\n                        if (vm.orderInfo.paymentRedirectTo) {\r\n                            vm.showPaymentFrame = true;\r\n                        }\r\n                        vm.ignoreFailedServices = true;\r\n                    },\r\n                    disableOutsideCloseClick: true\r\n                });\r\n            });\r\n        }\r\n\r\n\r\n        if (\r\n            backend.getParam('ffp.enable') &&\r\n            (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)\r\n        ) {\r\n            backend.ffpBonus().then(function (resp) {\r\n                vm.ffpBonus = resp.total || 0;\r\n            });\r\n        }\r\n\r\n    }, function (resp) {\r\n        vm.loading = false;\r\n        vm.errorMessage = resp.error;\r\n    });\r\n\r\n    function retryPayment() {\r\n        vm.loading = true;\r\n        backend.retryRegister().then(function (resp) {\r\n            if (resp.lastName && resp.pnr) {\r\n                $window.location = './order?pnr=' + resp.pnr + '&lastName=' + resp.lastName;\r\n            } else {\r\n                vm.loading = false;\r\n            }\r\n        }, function (resp) {\r\n            vm.loading = false;\r\n            vm.errorMessage = resp.error;\r\n        });\r\n    }\r\n\r\n    function bindOrder() {\r\n        if (!vm.orderInfo.header || !vm.orderInfo.header.regnum) {\r\n            return;\r\n        }\r\n        vm.loading = true;\r\n        backend.bindOrder(vm.orderInfo.header.regnum, vm.lastName).then(function () {\r\n            vm.loading = false;\r\n            vm.orderInfo.bindAlowed = false;\r\n            vm.showBindOrderSuccessMessage = true;\r\n            $timeout(function () {\r\n                vm.showBindOrderSuccessMessage = false;\r\n            }, 10000);\r\n        }, function () {\r\n            vm.loading = false;\r\n            vm.showBindOrderFailMessage = true;\r\n            $timeout(function () {\r\n                vm.showBindOrderFailMessage = false;\r\n            }, 10000);\r\n        });\r\n    }\r\n\r\n    function checkAllPassengersHavePaidService(name) {\r\n        var result = true;\r\n        vm.orderInfo.passengers.forEach(function (passenger, passengerNum) {\r\n            if (\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers &&\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum] &&\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices\r\n\t\t\t) {\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices.forEach(\r\n\t\t\t\t\tfunction (segmentServices) {\r\n\t\t\t\t\t\tvar segmentWantedService = _.findWhere(segmentServices, { code: name });\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t!segmentServices || !segmentWantedService ||\r\n\t\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t\tsegmentWantedService &&\r\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem &&\r\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem.status !== 'ISSUED_WITH_EMD'\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tresult = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tresult = false;\r\n\t\t\t}\r\n        });\r\n        return result;\r\n    }\r\n\r\n    function clearSession() {\r\n        backend.clearSession().then(function () {\r\n            redirect.goToSearchOrder();\r\n        });\r\n    }\r\n\r\n}\r\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('popupMealRossiya', {\r\n\ttemplateUrl: 'components/popup-meal-rossiya/popup-meal-rossiya.html',\r\n\tcontroller: ['utils', '$scope', PopupMealRossiyaController],\r\n\tcontrollerAs: 'vm',\r\n\tbindings: {\r\n\t\tmealMenu: '=menu',\r\n\t\tpassenger: '=passenger',\r\n\t\tcurrentPassengerIndex: '=',\r\n\t\tcurrentFlightIndex: '=',\r\n\t\tpassengers: '=passengers',\r\n\t\tflight: '=flight',\r\n\t\tmealCountChangeHandler: '=handler',\r\n\t\tclearPassengerFlightMeal: '&remove',\r\n\t\tgetPassengerFlightMeal: '=get',\r\n\t\tsubgroups: '=subgroups',\r\n\t\tmealImagesPath: '=path',\r\n\t\tservice: '=',\r\n\t\tselectFlightPassenger: '=select'\r\n\t}\r\n});\r\n\r\nfunction PopupMealRossiyaController(utils, $scope) {\r\n\r\n\tvar vm = this;\r\n\tvm.close = jQuery.fancybox.close;\r\n\tvm.mealMenuSubgroupMobileChange = mealMenuSubgroupMobileChange;\r\n\tvm.mealMenuSubgroup = false;\r\n\tvm.mealMenuSubgroupMobile = 'false';\r\n\tvm.subgroupItems = utils.createOptionsForUiSelect(vm.subgroups, 'all');\r\n\tvm.switchNext = switchNext;\r\n\tvm.switchPrev = switchPrev;\r\n\tvm.arrayString = arrayString;\r\n\tvm.getGroupMeal = getGroupMeal;\r\n\r\n\tfunction setAvailablePassengers() {\r\n\t\tvm.availablePassengers = vm.passengers.filter(function (passenger, index) {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index] &&\r\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index][vm.currentFlightIndex]\r\n\t\t\t\t\t);\r\n\t\t\t});\r\n\t}\r\n\r\n\t$scope.$watch('vm.currentFlightIndex', function () {\r\n\t\tsetAvailablePassengers();\r\n\t});\r\n\r\n\tfunction mealMenuSubgroupMobileChange() {\r\n\t\tif (vm.mealMenuSubgroupMobile === false) {\r\n\t\t\tvm.mealMenuSubgroup = false;\r\n\t\t} else {\r\n\t\t\tvm.mealMenuSubgroup = vm.mealMenuSubgroupMobile * 1;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction switchNext() {\r\n\t\tvar successSwitch = false;\r\n\t\tfor (var i = vm.currentPassengerIndex + 1; i < vm.passengers.length; i++) {\r\n\t\t\tif (\r\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\r\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\r\n\t\t\t) {\r\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\r\n\t\t\t\tsuccessSwitch = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!successSwitch) {\r\n\t\t\tfor (var j = 0; j < vm.passengers.length; j++) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\r\n\t\t\t\t) {\r\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction switchPrev() {\r\n\t\tvar successSwitch = false;\r\n\t\tfor (var i = vm.currentPassengerIndex - 1; i > -1; i--) {\r\n\t\t\tif (\r\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\r\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\r\n\t\t\t) {\r\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\r\n\t\t\t\tsuccessSwitch = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!successSwitch) {\r\n\t\t\tfor (var j = vm.passengers.length - 1; j > -1; j--) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\r\n\t\t\t\t) {\r\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction arrayString(arrays) {\r\n\r\n\t\tif(!Array.isArray(arrays)) return;\r\n\r\n\t\tvar total = arrays.reduce(function(flat, current) {\r\n\t\t\treturn flat.concat(current);\r\n\t\t}, []);\r\n\r\n\t\tif(vm.mealMenuSubgroup === false ) return total;\r\n\r\n\t\treturn arrays;\r\n\t}\r\n\r\n\tfunction getGroupMeal(meal, arrays) {\r\n\r\n\t\tfor (var i = 0; i < arrays.length; i++) {\r\n\t\t\tfor(var j = 0; j < arrays[i].length; j++) {\r\n\t\t\t\tif (arrays[i][j]['rfisc'] == meal['rfisc']) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\nrequire('./components/popup-meal-rossiya/popup-meal-rossiya');\r\nrequire('./components/es-meal-rossiya/es-meal-rossiya');\r\nrequire('./components/es-seat-rossiya/es-seat-rossiya');\r\nrequire('./components/order-rossiya/order-rossiya');\r\nrequire('./components/baby-bassinet-icon/baby-bassinet-icon');\r\nrequire('./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend');\n},{\"./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend\":1,\"./components/baby-bassinet-icon/baby-bassinet-icon\":2,\"./components/es-meal-rossiya/es-meal-rossiya\":3,\"./components/es-seat-rossiya/es-seat-rossiya\":4,\"./components/order-rossiya/order-rossiya\":5,\"./components/popup-meal-rossiya/popup-meal-rossiya\":6}]},{},[7]);\n"]}
=======
{"version":3,"sources":["controllers-rossia.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","angular","component","templateUrl","2","controller","controllerAs","bindings","rfisc","active","disabled","3","MealRossiyaController","$scope","$element","backend","utils","switchService","vm","locked","checkServiceRemovalProhibited","service","selectFirstAvailablePassengerFlight","removeExtraService","selectFlightPassenger","flightNum","passengerNum","selectedFlight","selectedPassenger","updateMealMenu","getFirstAvailableFlightNum","getFirstAvailablePassengerNum","mealMenu","itemsByPassengerSegments","undefined","mealMenuSubgroup","setPassengerFlightMeal","subgroupNum","mealItem","selectedPassengerFlightMeal","getSelectedPassengerFlightMeal","newMealParams","passenger_id","orderInfo","passengers","id","segment_id","plainFlights","subgroup","subgroups","service_type","serviceType","then","modifyExtraService","removePassengerFlightMeal","result","passengerSegmentServices","passengerSegmentMeal","editableExtraServicesByPassengers","_","findWhere","serviceItem","scrollToStart","passengersTableContainer","scrollTo","scrollToEnd","scrollWidth","mobileTableScrollHandler","scrollLeft","clientWidth","scrollRight","canScrollRight","canScrollLeft","$apply","availableBySegments","availableByPassengerSegments","checkAllChoose","j","this","find","hasAlias","getAvailablePassengersCount","getParam","mealImagesPath","addOrderInfoListener","$watch","on","4","SeatRossiyaController","$timeout","modifyError","clearFlightPassenger","editable_extra_services","resp","error","seatMap","setSeatMapContainerTopPosition","reset","seatMapContainerTopPosition","jQuery","css","updateSeatMap","loadingSeatMap","seatMapError","hasSeatsWithBabyBassinet","checkExistSeatsWithBabyBassinetBySeatMap","hasBabyBassinet","decks","forEach","deck","cabins","cabin","rows","row","chairs","chair","checkExistSeatsWithBabyBassinetByChair","properties","prop","setPassengerFlightSeat","cabinAllowed","rowNumber","babyBassinetItem","paxId","segId","available","value","number","commonSubgroup","babyBassinetService","getFirstNotEmptySubListItem","removeBabyBassinetIfExist","updateSunInfoByFlights","sunInfoByFlights","flight","sunInfo","origincity","departuredate","departuretime","destinationcity","arrivaldate","arrivaltime","getAvailablePassengersCountWrap","count","filter","pax","hasSeats","removePassengerFlightSeat","editableExtraServicesHeap","groupCode","mainSegmentId","passengerId","passengerSegmentSeat","5","OrderRossiyaController","$window","redirect","fancyboxTools","retryPayment","loading","retryRegister","lastName","pnr","location","errorMessage","bindOrder","header","regnum","bindAlowed","showBindOrderSuccessMessage","showBindOrderFailMessage","checkAllPassengersHavePaidService","name","passenger","allExtraServicesByPassengers","segmentServices","segmentWantedService","status","clearSession","goToSearchOrder","openExchange","goToExchange","openRefund","goToRefund","openAddServices","goToAddServices","suffixCount","searchOrder","pnrOrTicketNumber","resultParam","getParamFromLocation","waitPayment","hasFailedServices","showPaymentFrame","openHandler","submitCallback","paymentRedirectTo","ignoreFailedServices","disableOutsideCloseClick","hasBonusCard","ffpSumm","ffpBonus","total","6","PopupMealRossiyaController","setAvailablePassengers","availablePassengers","index","currentFlightIndex","mealMenuSubgroupMobileChange","mealMenuSubgroupMobile","switchNext","successSwitch","currentPassengerIndex","switchPrev","arrayString","arrays","Array","isArray","reduce","flat","current","concat","getGroupMeal","meal","close","fancybox","subgroupItems","createOptionsForUiSelect","clearPassengerFlightMeal","getPassengerFlightMeal","7","./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend","./components/baby-bassinet-icon/baby-bassinet-icon","./components/es-meal-rossiya/es-meal-rossiya","./components/es-seat-rossiya/es-seat-rossiya","./components/order-rossiya/order-rossiya","./components/popup-meal-rossiya/popup-meal-rossiya"],"mappings":"CAAA,QAAUA,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAkB,kBAATC,UAAqBA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIK,GAAE,GAAIC,OAAM,uBAAuBN,EAAE,IAAK,MAAMK,GAAEE,KAAK,mBAAmBF,EAAE,GAAIG,GAAEX,EAAEG,IAAIS,WAAYb,GAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,EAAEA,EAAEF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGS,QAAkD,IAAI,GAA1CL,GAAkB,kBAATD,UAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,GAAI,OAAOD,KAAKa,GAAG,SAAST,EAAQU,EAAOJ,GACvd,YACAK,SAAQD,OAAO,OAAOE,UAAU,0BAC5BC,YAAa,6EAGXC,GAAG,SAASd,EAAQU,EAAOJ,GACjC,YACAK,SAAQD,OAAO,OAAOE,UAAU,oBAC5BC,YAAa,wDACbE,WAAY,aACZC,aAAc,KACdC,UACIC,MAAO,SACPC,OAAQ,UACRC,SAAU,oBAMZC,GAAG,SAASrB,EAAQU,EAAOJ,GACjC,YAWA,SAASgB,GAAsBC,EAAQC,EAAUC,EAASC,GA8CtD,QAASC,KACAC,EAAGC,QAAWJ,EAAQK,8BAA8B,UACrDF,EAAGG,QAAQZ,QAAUS,EAAGG,QAAQZ,OAC5BS,EAAGG,QAAQZ,OACXa,IAEAP,EAAQQ,oBACJ7B,KAAM,UAMtB,QAAS8B,GAAsBC,EAAWC,GACtCR,EAAGS,eAAiBF,EACpBP,EAAGU,kBAAoBF,EACvBG,IAGJ,QAASP,KACLJ,EAAGS,eAAiBG,IACpBZ,EAAGU,kBAAoBG,EAA8Bb,EAAGS,gBACxDE,IAGJ,QAASA,KACLX,EAAGc,SAAWd,EAAGG,QAAQY,yBAAyBf,EAAGU,mBAAmBV,EAAGS,gBAC/CO,SAAxBhB,EAAGiB,mBACHjB,EAAGiB,kBAAmB,GAI9B,QAASC,GAAuBC,EAAaC,GACzC,GAAIC,GAA8BC,EAA+BtB,EAAGU,kBAAmBV,EAAGS,gBACtFc,GACI/C,KAAM,OACNgD,aAAcxB,EAAGyB,UAAUC,WAAW1B,EAAGU,mBAAmBiB,GAC5DC,WAAY5B,EAAGyB,UAAUI,aAAa7B,EAAGS,gBAAgBkB,GACzDG,SAAU9B,EAAGG,QAAQ4B,UAAUZ,GAC/Ba,aAAcZ,EAASa,YACvB3C,MAAO8B,EAAS9B,MAEnBU,GAAGC,SAEAoB,IACCxB,EAAQK,8BAA8B,OAAQF,EAAGU,kBAAmBV,EAAGS,gBAExEZ,EAAQQ,oBACJ7B,KAAM,OACNgD,aAAcxB,EAAGyB,UAAUC,WAAW1B,EAAGU,mBAAmBiB,GAC5DC,WAAY5B,EAAGyB,UAAUI,aAAa7B,EAAGS,gBAAgBkB,GACzDK,aAAcX,EAA4BY,YAC1C3C,MAAO+B,EAA4B/B,QACpC,GAAM4C,KAAK,WACVrC,EAAQsC,mBAAmBZ,KAG/B1B,EAAQsC,mBAAmBZ,IAKvC,QAASa,GAA0B5B,EAAcD,GACxCP,EAAGC,QAAWJ,EAAQK,8BAA8B,OAAQM,EAAcD,IAC3EV,EAAQQ,oBACJ7B,KAAM,OACNgD,aAAcxB,EAAGyB,UAAUC,WAAWlB,GAAcmB,GACpDC,WAAY5B,EAAGyB,UAAUI,aAAatB,GAAWoB,KAK7D,QAASL,GAA+Bd,EAAcD,GAClD,GAAI8B,GACAC,EACAC,CAaJ,OAZIvC,GAAGyB,UAAUe,mCACTxC,EAAGyB,UAAUe,kCAAkChC,KAE/C8B,EAA2BtC,EAAGyB,UAAUe,kCAAkChC,GAAc8B,yBAAyB/B,GAC7G+B,IACAC,EAAuBE,EAAEC,UAAUJ,GAA4B9D,KAAM,SACjE+D,IACAF,EAASE,EAAqBI,eAKvCN,EAGX,QAASO,KACLC,EAAyBC,SAAS,GAGtC,QAASC,KACLF,EAAyBC,SAASD,EAAyB,GAAGG,aAGlE,QAASC,KACL,GAAIC,GAAaL,EAAyB,GAAGK,WACzCF,EAAcH,EAAyB,GAAGG,YAC1CG,EAAcN,EAAyB,GAAGM,YAC1CC,EAAcJ,EAAcG,EAAcD,CAC9ClD,GAAGqD,eAAkC,IAAhBD,EACrBpD,EAAGsD,cAAgC,IAAfJ,EACpBvD,EAAO4D,SAGX,QAAS3C,KACL,GAAIvC,EACJ,KAAKA,EAAI,EAAGA,EAAI2B,EAAGyB,UAAUI,aAAajD,OAAQP,IAC9C,GAAI2B,EAAGG,QAAQqD,oBAAoBnF,GAC/B,MAAOA,EAGf,OAAO,GAGX,QAASwC,GAA8BN,GACnC,GAAIlC,EACJ,IAAI2B,EAAGG,QAAQsD,6BACX,IAAKpF,EAAI,EAAGA,EAAI2B,EAAGyB,UAAUC,WAAW9C,OAAQP,IAC5C,GAAI2B,EAAGG,QAAQsD,6BAA6BpF,GAAGkC,GAC3C,MAAOlC,EAInB,OAAO,GAGX,QAASqF,KAEP,IAAK,GAAIrF,GAAI,EAAGA,EAAI2B,EAAGyB,UAAUI,aAAajD,OAAQP,IACpD,IAAK,GAAIsF,GAAI,EAAGA,EAAI3D,EAAGyB,UAAUC,WAAW9C,OAAQ+E,IAClD,GAAIrC,EAA+BqC,EAAGtF,GACpC,OAAO,CAKb,QAAO,EAzLT,GAAI2B,GAAK4D,KACLf,EAA2BjD,EAASiE,KAAK,+BAE7C7D,GAAGD,cAAgBA,EACnBC,EAAGM,sBAAwBA,EAC3BN,EAAGI,oCAAsCA,EACzCJ,EAAGkB,uBAAyBA,EAC5BlB,EAAGoC,0BAA4BA,EAC/BpC,EAAGsB,+BAAiCA,EACpCtB,EAAG4C,cAAgBA,EACnB5C,EAAG+C,YAAcA,EACjB/C,EAAG0D,eAAiBA,EACpB1D,EAAG8D,SAAWjE,EAAQiE,SACtB9D,EAAG+D,4BAA8BjE,EAAMiE,4BACvC/D,EAAGE,8BAAgCL,EAAQK,8BAE3CF,EAAGqD,gBAAiB,EACpBrD,EAAGsD,eAAgB,EAEnBtD,EAAGS,eAAiB,EACpBT,EAAGU,kBAAoB,EAEnBb,EAAQmE,SAAS,+BACjBhE,EAAGiE,eAAiBpE,EAAQmE,SAAS,+BAAiC,oBAEtEhE,EAAGiE,eAAiB,iDAGxBpE,EAAQqE,qBAAqB,SAAUzC,GACnCzB,EAAGyB,UAAYA,IAChB,GAAO,GAEV9B,EAAOwE,OAAO,aAAc,WACpBnE,EAAGc,UACHH,MAIRkC,EAAyBuB,GAAG,SAAUnB,GAElCjD,EAAGG,QAAQZ,QACXoB,IArDR5B,QAAQD,OAAO,OAAOE,UAAU,iBAC5BC,YAAa,kDACbE,YAAa,SAAU,WAAW,UAAW,QAASO,GACtDN,aAAc,KACdC,UACIc,QAAS,WACTF,OAAQ,kBAqMVoE,GAAG,SAASjG,EAAQU,EAAOJ,GACjC,YAYA,SAAS4F,GAAsB3E,EAAQC,EAAU2E,EAAU1E,EAASC,GAyChE,QAASC,KACAC,EAAGC,QAAWJ,EAAQK,8BAA8B,UACrDF,EAAGG,QAAQZ,QAAUS,EAAGG,QAAQZ,OAC5BS,EAAGG,QAAQZ,OACXa,KAEAJ,EAAGwE,aAAc,EACjB3E,EAAQQ,oBACJ7B,KAAM,SACP0D,KAAK,WACJuC,IAEIzE,EAAGyB,UAAUiD,yBACbjC,EAAEC,UAAU1C,EAAGyB,UAAUiD,yBAA2BlG,KAAM,kBAE1DqB,EAAQQ,oBACJ7B,KAAM,kBAGf,SAAUmG,GACLA,EAAKC,QACL5E,EAAGwE,YAAcG,EAAKC,WAO1C,QAASH,KACLzE,EAAG6E,SAAU,EACb7E,EAAGS,eAAiB,GACpBT,EAAGU,kBAAoB,GAG3B,QAASoE,GAA+BC,GAEhCC,EADAD,EAC8B,MAEAE,OAAO,gCAAgCC,IAAI,OAIjF,QAAS5E,GAAsBC,EAAWC,GAEtCsE,EAA+B9E,EAAGS,iBAAmBF,GACrDP,EAAGS,eAAiBF,EACpBP,EAAGU,kBAAoBF,EACvB2E,IAGJ,QAAS/E,KACLJ,EAAGS,eAAiBG,IACpBZ,EAAGU,kBAAoBG,EAA8Bb,EAAGS,gBACxD0E,IAGJ,QAASA,KAEwB,KAAzBnF,EAAGU,mBAAkD,KAAtBV,EAAGS,iBAClCT,EAAGoF,gBAAiB,EACpBpF,EAAGqF,cAAe,EAClBxF,EAAQgF,QACJ7E,EAAGyB,UAAUC,WAAW1B,EAAGU,mBAAmBiB,GAC9C3B,EAAGyB,UAAUI,aAAa7B,EAAGS,gBAAgBkB,IAC/CO,KAAK,SAAUyC,GACb3E,EAAG6E,QAAUF,EACb3E,EAAG6E,QAAQS,yBAA2BC,EAAyCZ,GAC/E3E,EAAGoF,gBAAiB,EACpBb,EAAS,WACLU,OAAO,gCAAgCC,IAAI,MAAOF,MAEvD,SAAUL,GACT3E,EAAGqF,aAAeV,EAAKC,MACvB5E,EAAGoF,gBAAiB,KAMhC,QAASG,GAAyCV,GAC9C,GAAIW,IAAkB,CAoBtB,OAnBIX,IAAWA,EAAQY,OACnBZ,EAAQY,MAAMC,QAAQ,SAAUC,GACxBA,GAAQA,EAAKC,QACbD,EAAKC,OAAOF,QAAQ,SAAUG,GACtBA,GAASA,EAAMC,MACfD,EAAMC,KAAKJ,QAAQ,SAAUK,GACrBA,GAAOA,EAAIC,QACXD,EAAIC,OAAON,QAAQ,SAAUO,GACrBC,EAAuCD,KACvCT,GAAkB,WAU/CA,EAGX,QAASU,GAAuCD,GAC5C,GAAIT,IAAkB,CAQtB,OAPIS,IAASA,EAAME,YACfF,EAAME,WAAWT,QAAQ,SAAUU,GAClB,iBAATA,IACAZ,GAAkB,KAIvBA,EAGX,QAASa,GAAuBJ,EAAOK,EAAcC,GACjD,GAAIC,GACAC,EAAQzG,EAAGyB,UAAUC,WAAW1B,EAAGU,mBAAmBiB,GACtD+E,EAAQ1G,EAAGyB,UAAUI,aAAa7B,EAAGS,gBAAgBkB,EACpD3B,GAAGC,QACAgG,EAAMU,WAAaL,IACnBxB,IACA9E,EAAGwE,aAAc,EACjB3E,EAAQsC,oBACJ3D,KAAM,OACNgD,aAAciF,EACd7E,WAAY8E,EACZE,MAAOL,EAAYN,EAAMY,OACzB/E,SAAU9B,EAAGG,QAAQ2G,eACrBxH,MAAO2G,EAAM3G,OAAS,GACtB0C,aAAc,MACfE,KAAK,WACJiD,IACIe,EAAuCD,GAEnCjG,EAAG+G,qBACH/G,EAAG+G,oBAAoBhG,0BACvBf,EAAG+G,oBAAoBhG,yBAAyBf,EAAGU,oBACnDV,EAAG+G,oBAAoBhG,yBAAyBf,EAAGU,mBAAmBV,EAAGS,kBAEzE+F,EAAmB1G,EAAMkH,4BAA4BhH,EAAG+G,oBAAoBhG,yBAAyBf,EAAGU,mBAAmBV,EAAGS,iBAE1H+F,GACAA,EAAiBvE,aACjBuE,EAAiBlH,OAEjBO,EAAQsC,oBACJ3D,KAAM,eACNgD,aAAciF,EACd7E,WAAY8E,EACZ5E,SAAU9B,EAAG+G,oBAAoBD,eACjCxH,MAAOkH,EAAiBlH,MACxB0C,aAAcwE,EAAiBvE,eAK3CgF,EAA0BR,EAAOC,IAEtC,SAAU/B,GACLA,EAAKC,QACL5E,EAAGwE,YAAcG,EAAKC,UAO1C,QAASsC,KACLlH,EAAGmH,oBACHnH,EAAGyB,UAAUI,aAAa6D,QAAQ,SAAU0B,EAAQ7G,GAChDV,EAAQwH,QACJD,EAAOE,WACPF,EAAOG,cACPH,EAAOI,cACPJ,EAAOK,gBACPL,EAAOM,YACPN,EAAOO,aACTzF,KAAK,SAAUyC,GACb3E,EAAGmH,iBAAiB5G,GAAaoE,MAK7C,QAAS/D,KACL,GAAIvC,EACJ,KAAKA,EAAI,EAAGA,EAAI2B,EAAGyB,UAAUI,aAAajD,OAAQP,IAC9C,GAAI2B,EAAGG,QAAQqD,oBAAoBnF,GAC/B,MAAOA,EAGf,OAAO,GAGX,QAASwC,GAA8BN,GACnC,GAAIlC,EACJ,IAAI2B,EAAGG,QAAQsD,6BACX,IAAKpF,EAAI,EAAGA,EAAI2B,EAAGyB,UAAUC,WAAW9C,OAAQP,IAC5C,GAAI2B,EAAGG,QAAQsD,6BAA6BpF,GAAGkC,GAC3C,MAAOlC,EAInB,OAAO,GAGX,QAASuE,KACLC,EAAyBC,SAAS,GAGtC,QAASC,KACLF,EAAyBC,SAASD,EAAyB,GAAGG,aAGlE,QAASC,KACL,GAAIC,GAAaL,EAAyB,GAAGK,WACzCF,EAAcH,EAAyB,GAAGG,YAC1CG,EAAcN,EAAyB,GAAGM,YAC1CC,EAAcJ,EAAcG,EAAcD,CAC9ClD,GAAGqD,eAAkC,IAAhBD,EACrBpD,EAAGsD,cAAgC,IAAfJ,EACpBvD,EAAO4D,SAGX,QAASqE,GAAgCnE,GACrC,GAAIoE,GAAQ/H,EAAMiE,4BAA4BN,EAC9C,OAAOoE,GAAQ7H,EAAGyB,UAAUC,WAAWoG,OAAO,SAAUC,GACpD,OAAQA,EAAIC,WACbpJ,OAGP,QAASqJ,GAA0BzH,EAAcD,GAC7C,GAAIkG,GAAQzG,EAAGyB,UAAUC,WAAWlB,GAAcmB,GAC9C+E,EAAQ1G,EAAGyB,UAAUI,aAAatB,GAAWoB,EAE5C3B,GAAGC,QAAWJ,EAAQK,8BAA8B,OAAQM,EAAcD,KAE3EP,EAAGwE,aAAc,EAEjB3E,EAAQQ,oBACJ7B,KAAM,OACNgD,aAAciF,EACd7E,WAAY8E,IACbxE,KAAK,WACJ+E,EAA0BR,EAAOC,GAC7B1G,EAAGS,iBAAmBF,GACtB4E,KAEL,SAAUR,GACLA,EAAKC,QACL5E,EAAGwE,YAAcG,EAAKC,UAQtC,QAASqC,GAA0BR,EAAOC,GAElC1G,EAAGyB,UAAUyG,2BACbzF,EAAEC,UACE1C,EAAGyB,UAAUyG,2BAETC,UAAW,eACXC,cAAe1B,EACf2B,YAAa5B,KAIrB5G,EAAQQ,oBACJ7B,KAAM,eACNgD,aAAciF,EACd7E,WAAY8E,IAKxB,QAASpF,GAA+Bd,EAAcD,GAClD,GAAI8B,GACAC,EACAgG,CAaJ,OAZItI,GAAGyB,UAAUe,mCACTxC,EAAGyB,UAAUe,kCAAkChC,KAE/C8B,EAA2BtC,EAAGyB,UAAUe,kCAAkChC,GAAc8B,yBAAyB/B,GAC7G+B,IACAgG,EAAuB7F,EAAEC,UAAUJ,GAA4B9D,KAAM,SACjE8J,IACAjG,EAASiG,EAAqB3F,eAKvCN,EAGX,QAASqB,KAEP,IAAK,GAAIrF,GAAI,EAAGA,EAAI2B,EAAGyB,UAAUI,aAAajD,OAAQP,IACpD,IAAK,GAAIsF,GAAI,EAAGA,EAAI3D,EAAGyB,UAAUC,WAAW9C,OAAQ+E,IAClD,GAAIrC,EAA+BqC,EAAGtF,GACpC,OAAO,CAKb,QAAO,EA1VT,GAAI2B,GAAK4D,KACLf,EAA2BjD,EAASiE,KAAK,gCACzCmB,EAA8B,KAElChF,GAAGD,cAAgBA,EAEnBC,EAAGM,sBAAwBA,EAC3BN,EAAGI,oCAAsCA,EACzCJ,EAAGqG,uBAAyBA,EAC5BrG,EAAGsB,+BAAiCA,EACpCtB,EAAG0D,eAAiBA,EAEpB1D,EAAG8D,SAAWjE,EAAQiE,SAEtB9D,EAAG4C,cAAgBA,EACnB5C,EAAG+C,YAAcA,EAEjB/C,EAAG+D,4BAA8BjE,EAAMiE,4BACvC/D,EAAG4H,gCAAkCA,EAErC5H,EAAGiI,0BAA4BA,EAE/BjI,EAAGE,8BAAgCL,EAAQK,8BAE3CF,EAAGqD,gBAAiB,EACpBrD,EAAGsD,eAAgB,EAEnBzD,EAAQqE,qBAAqB,SAAUzC,GACnCzB,EAAGyB,UAAYA,IAChB,GAAO,GAEVyF,IAEArE,EAAyBuB,GAAG,SAAUnB,GAElCjD,EAAGG,QAAQZ,QACXa,IAjDRrB,QAAQD,OAAO,OAAOE,UAAU,iBAC5BC,YAAa,kDACbE,YAAa,SAAU,WAAY,WAAY,UAAW,QAASmF,GACnElF,aAAc,KACdC,UACIc,QAAS,WACT4G,oBAAqB,IACrB9G,OAAQ,kBAsWVsI,GAAG,SAASnK,EAAQU,EAAOJ,GACjC,YAYA,SAAS8J,GAAuBC,EAASlE,EAAU1E,EAASC,EAAO4I,EAAUC,GAiFzE,QAASC,KACL5I,EAAG6I,SAAU,EACbhJ,EAAQiJ,gBAAgB5G,KAAK,SAAUyC,GAC/BA,EAAKoE,UAAYpE,EAAKqE,IACtBP,EAAQQ,SAAW,eAAiBtE,EAAKqE,IAAM,aAAerE,EAAKoE,SAEnE/I,EAAG6I,SAAU,GAElB,SAAUlE,GACT3E,EAAG6I,SAAU,EACb7I,EAAGkJ,aAAevE,EAAKC,QAI/B,QAASuE,KACAnJ,EAAGyB,UAAU2H,QAAWpJ,EAAGyB,UAAU2H,OAAOC,SAGjDrJ,EAAG6I,SAAU,EACbhJ,EAAQsJ,UAAUnJ,EAAGyB,UAAU2H,OAAOC,OAAQrJ,EAAG+I,UAAU7G,KAAK,WAC5DlC,EAAG6I,SAAU,EACb7I,EAAGyB,UAAU6H,YAAa,EAC1BtJ,EAAGuJ,6BAA8B,EACjChF,EAAS,WACLvE,EAAGuJ,6BAA8B,GAClC,MACJ,WACCvJ,EAAG6I,SAAU,EACb7I,EAAGwJ,0BAA2B,EAC9BjF,EAAS,WACLvE,EAAGwJ,0BAA2B,GAC/B,QAIX,QAASC,GAAkCC,GACvC,GAAIrH,IAAS,CA0Bb,OAzBArC,GAAGyB,UAAUC,WAAWgE,QAAQ,SAAUiE,EAAWnJ,GAEzDR,EAAGyB,UAAUmI,8BACb5J,EAAGyB,UAAUmI,6BAA6BpJ,IAC1CR,EAAGyB,UAAUmI,6BAA6BpJ,GAAc8B,yBAExDtC,EAAGyB,UAAUmI,6BAA6BpJ,GAAc8B,yBAAyBoD,QAChF,SAAUmE,GACT,GAAIC,GAAuBrH,EAAEC,UAAUmH,GAAmBrL,KAAMkL,MAE9DG,IAAoBC,GAEpBA,GACAA,EAAqBnH,aACuB,oBAA5CmH,EAAqBnH,YAAYoH,UAGlC1H,GAAS,KAKZA,GAAS,IAGEA,EAGX,QAAS2H,KACLnK,EAAQmK,eAAe9H,KAAK,WACxBwG,EAASuB,oBAlJjB,GAAIjK,GAAK4D,IACT5D,GAAG6I,SAAU,EACb7I,EAAGkJ,cAAe,EAClBlJ,EAAGkK,aAAexB,EAASyB,aAC3BnK,EAAGoK,WAAa1B,EAAS2B,WACzBrK,EAAGsK,gBAAkB5B,EAAS6B,gBAC9BvK,EAAGwK,YAAc1K,EAAM0K,YACvBxK,EAAG4I,aAAeA,EAClB5I,EAAGmJ,UAAYA,EACfnJ,EAAGyJ,kCAAoCA,EACvCzJ,EAAGgK,aAAeA,EAElBnK,EAAQ4K,YAAYzK,EAAG0K,kBAAmB1K,EAAG+I,UAAU7G,KAAK,SAAUT,GAElE,GAAIkJ,GAAc7K,EAAM8K,qBAAqB,SAE7C5K,GAAGyB,UAAYA,GAGXzB,EAAGyB,UAAU2H,QAEsB,eAA/BpJ,EAAGyB,UAAU2H,OAAOW,QACW,4BAA/B/J,EAAGyB,UAAU2H,OAAOW,OAiBxB/J,EAAG6I,SAAU,EAdO,YAAhB8B,EACA9K,EAAQgL,YAAY7K,EAAGyB,UAAU2H,OAAOC,OAAQrJ,EAAG+I,UAAU7G,KAAK,WAC9DuG,EAAQQ,SAAW,eAAiBjJ,EAAGyB,UAAU2H,OAAOC,OAAS,aAAerJ,EAAG+I,SAAW,mBAE/F,WACC/I,EAAG6I,SAAU,KAGZ7I,EAAGyB,UAAUqJ,oBACd9K,EAAG+K,kBAAmB,GAE1B/K,EAAG6I,SAAU,IAOjB7I,EAAGyB,UAAUqJ,mBACZH,IACD3K,EAAGyB,UAAU2H,QAEsB,eAA/BpJ,EAAGyB,UAAU2H,OAAOW,QACW,WAA/B/J,EAAGyB,UAAU2H,OAAOW,QAGxBxF,EAAS,WACLoE,EAAcqC,YAAY,+BAA+B,GACrDC,eAAgB,WACRjL,EAAGyB,UAAUyJ,oBACblL,EAAG+K,kBAAmB,GAE1B/K,EAAGmL,sBAAuB,GAE9BC,0BAA0B,MAOlCvL,EAAQmE,SAAS,gBAChBhE,EAAGyB,UAAU4J,cAAgBrL,EAAGyB,UAAU6J,UAE3CzL,EAAQ0L,WAAWrJ,KAAK,SAAUyC,GAC9B3E,EAAGuL,SAAW5G,EAAK6G,OAAS,KAIrC,SAAU7G,GACT3E,EAAG6I,SAAU,EACb7I,EAAGkJ,aAAevE,EAAKC,QAxF/B7F,QAAQD,OAAO,OAAOE,UAAU,gBAC5BC,YAAa,8CACbE,YAAa,UAAW,WAAY,UAAW,QAAS,WAAY,gBAAiBqJ,GACrFpJ,aAAc,KACdC,UACIqL,kBAAmB,OACnB3B,SAAU,oBA8JZ0C,GAAG,SAASrN,EAAQU,EAAOJ,GACjC,YAsBA,SAASgN,GAA2B5L,EAAOH,GAa1C,QAASgM,KACR3L,EAAG4L,oBAAsB5L,EAAG0B,WAAWoG,OAAO,SAAU6B,EAAWkC,GAChE,MACE7L,GAAGG,QAAQsD,6BAA6BoI,IACxC7L,EAAGG,QAAQsD,6BAA6BoI,GAAO7L,EAAG8L,sBASxD,QAASC,KACJ/L,EAAGgM,0BAA2B,EACjChM,EAAGiB,kBAAmB,EAEtBjB,EAAGiB,iBAA+C,EAA5BjB,EAAGgM,uBAI3B,QAASC,KAER,IAAK,GADDC,IAAgB,EACX7N,EAAI2B,EAAGmM,sBAAwB,EAAG9N,EAAI2B,EAAG0B,WAAW9C,OAAQP,IACpE,GACC2B,EAAGG,QAAQsD,6BAA6BpF,IACxC2B,EAAGG,QAAQsD,6BAA6BpF,GAAG2B,EAAG8L,oBAC7C,CACD9L,EAAGM,sBAAsBN,EAAG8L,mBAAoBzN,GAChD6N,GAAgB,CAChB,OAGF,IAAKA,EACJ,IAAK,GAAIvI,GAAI,EAAGA,EAAI3D,EAAG0B,WAAW9C,OAAQ+E,IACzC,GACC3D,EAAGG,QAAQsD,6BAA6BE,IACxC3D,EAAGG,QAAQsD,6BAA6BE,GAAG3D,EAAG8L,oBAC7C,CACD9L,EAAGM,sBAAsBN,EAAG8L,mBAAoBnI,EAChD,QAMJ,QAASyI,KAER,IAAK,GADDF,IAAgB,EACX7N,EAAI2B,EAAGmM,sBAAwB,EAAG9N,EAAI,GAAIA,IAClD,GACC2B,EAAGG,QAAQsD,6BAA6BpF,IACxC2B,EAAGG,QAAQsD,6BAA6BpF,GAAG2B,EAAG8L,oBAC7C,CACD9L,EAAGM,sBAAsBN,EAAG8L,mBAAoBzN,GAChD6N,GAAgB,CAChB,OAGF,IAAKA,EACJ,IAAK,GAAIvI,GAAI3D,EAAG0B,WAAW9C,OAAS,EAAG+E,EAAI,GAAIA,IAC9C,GACC3D,EAAGG,QAAQsD,6BAA6BE,IACxC3D,EAAGG,QAAQsD,6BAA6BE,GAAG3D,EAAG8L,oBAC7C,CACD9L,EAAGM,sBAAsBN,EAAG8L,mBAAoBnI,EAChD,QAMJ,QAAS0I,GAAYC,GAEpB,GAAIC,MAAMC,QAAQF,GAAlB,CAEA,GAAId,GAAQc,EAAOG,OAAO,SAASC,EAAMC,GACxC,MAAOD,GAAKE,OAAOD,OAGpB,OAAG3M,GAAGiB,oBAAqB,EAAeuK,EAEnCc,GAGR,QAASO,GAAaC,EAAMR,GAE3B,IAAK,GAAIjO,GAAI,EAAGA,EAAIiO,EAAO1N,OAAQP,IAClC,IAAI,GAAIsF,GAAI,EAAGA,EAAI2I,EAAOjO,GAAGO,OAAQ+E,IACpC,GAAI2I,EAAOjO,GAAGsF,GAAU,OAAKmJ,EAAY,MACxC,MAAOzO,GApGX,GAAI2B,GAAK4D,IACT5D,GAAG+M,MAAQ9H,OAAO+H,SAASD,MAC3B/M,EAAG+L,6BAA+BA,EAClC/L,EAAGiB,kBAAmB,EACtBjB,EAAGgM,uBAAyB,QAC5BhM,EAAGiN,cAAgBnN,EAAMoN,yBAAyBlN,EAAG+B,UAAW,OAChE/B,EAAGiM,WAAaA,EAChBjM,EAAGoM,WAAaA,EAChBpM,EAAGqM,YAAcA,EACjBrM,EAAG6M,aAAeA,EAWlBlN,EAAOwE,OAAO,wBAAyB,WACtCwH,MA5CF5M,QAAQD,OAAO,OAAOE,UAAU,oBAC/BC,YAAa,wDACbE,YAAa,QAAS,SAAUuM,GAChCtM,aAAc,KACdC,UACCyB,SAAU,QACV6I,UAAW,aACXwC,sBAAuB,IACvBL,mBAAoB,IACpBpK,WAAY,cACZ0F,OAAQ,UACRlG,uBAAwB,WACxBiM,yBAA0B,UAC1BC,uBAAwB,OACxBrL,UAAW,aACXkC,eAAgB,QAChB9D,QAAS,IACTG,sBAAuB,kBAkHnB+M,GAAG,SAASjP,EAAQU,EAAOJ,GACjC,YACAN,GAAQ,sDACRA,EAAQ,gDACRA,EAAQ,gDACRA,EAAQ,4CACRA,EAAQ,sDACRA,EAAQ,sEACLkP,mEAAmE,EAAEC,qDAAqD,EAAEC,+CAA+C,EAAEC,+CAA+C,EAAEC,2CAA2C,EAAEC,qDAAqD,SAAS","file":"controllers-rossia.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIconLegend', {\n    templateUrl: 'components/baby-bassinet-icon-legend/baby-bassinet-icon-legend.html'\n});\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIcon', {\n    templateUrl: 'components/baby-bassinet-icon/baby-bassinet-icon.html',\n    controller: function () {},\n    controllerAs: 'vm',\n    bindings: {\n        rfisc: '=rfisc',\n        active: '=active',\n        disabled: '=disabled'\n    }\n});\n\n\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esMealRossiya', {\n    templateUrl: 'components/es-meal-rossiya/es-meal-rossiya.html',\n    controller: ['$scope', '$element','backend', 'utils', MealRossiyaController],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        locked: '=locked'\n    }\n});\n\nfunction MealRossiyaController($scope, $element, backend, utils) {\n\n    var vm = this,\n        passengersTableContainer = $element.find('div.passengersTableContainer');\n\n    vm.switchService = switchService;\n    vm.selectFlightPassenger = selectFlightPassenger;\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\n    vm.setPassengerFlightMeal = setPassengerFlightMeal;\n    vm.removePassengerFlightMeal = removePassengerFlightMeal;\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\n    vm.scrollToStart = scrollToStart;\n    vm.scrollToEnd = scrollToEnd;\n    vm.checkAllChoose = checkAllChoose;\n    vm.hasAlias = backend.hasAlias;\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\n\n    vm.canScrollRight = true;\n    vm.canScrollLeft = false;\n\n    vm.selectedFlight = 0;\n    vm.selectedPassenger = 0;\n\n    if (backend.getParam('site.externalStorageBaseUrl')) {\n        vm.mealImagesPath = backend.getParam('site.externalStorageBaseUrl') + '/img/content/meal';\n    } else {\n        vm.mealImagesPath = './themes/websky/assets/static/img/content/meal';\n    }\n\n    backend.addOrderInfoListener(function (orderInfo) {\n        vm.orderInfo = orderInfo;\n    }, false, true);\n\n    $scope.$watch('vm.service', function () {\n        if (vm.mealMenu) {\n            updateMealMenu();\n        }\n    });\n\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\n\n    if (vm.service.active) {\n        updateMealMenu();\n    }\n\n    function switchService() {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal')) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                selectFirstAvailablePassengerFlight();\n            } else {\n                backend.removeExtraService({\n                    code: 'meal'\n                });\n            }\n        }\n    }\n\n    function selectFlightPassenger(flightNum, passengerNum) {\n        vm.selectedFlight = flightNum;\n        vm.selectedPassenger = passengerNum;\n        updateMealMenu();\n    }\n\n    function selectFirstAvailablePassengerFlight() {\n        vm.selectedFlight = getFirstAvailableFlightNum();\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\n        updateMealMenu();\n    }\n\n    function updateMealMenu() {\n        vm.mealMenu = vm.service.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight];\n        if (vm.mealMenuSubgroup === undefined) {\n            vm.mealMenuSubgroup = false;\n        }\n    }\n\n    function setPassengerFlightMeal(subgroupNum, mealItem) {\n        var selectedPassengerFlightMeal = getSelectedPassengerFlightMeal(vm.selectedPassenger, vm.selectedFlight),\n            newMealParams = {\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                subgroup: vm.service.subgroups[subgroupNum],\n                service_type: mealItem.serviceType,\n                rfisc: mealItem.rfisc\n            };\n        if (!vm.locked) {\n            if (\n                selectedPassengerFlightMeal &&\n                !backend.checkServiceRemovalProhibited('meal', vm.selectedPassenger, vm.selectedFlight)\n            ) {\n                backend.removeExtraService({\n                    code: 'meal',\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                    service_type: selectedPassengerFlightMeal.serviceType,\n                    rfisc: selectedPassengerFlightMeal.rfisc\n                }, true).then(function () {\n                    backend.modifyExtraService(newMealParams);\n                });\n            } else {\n                backend.modifyExtraService(newMealParams);\n            }\n        }\n    }\n\n    function removePassengerFlightMeal(passengerNum, flightNum) {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal', passengerNum, flightNum)) {\n            backend.removeExtraService({\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\n            });\n        }\n    }\n\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\n        var result,\n            passengerSegmentServices,\n            passengerSegmentMeal;\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\n                /* jshint maxlen: 150 */\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\n                if (passengerSegmentServices) {\n                    passengerSegmentMeal = _.findWhere(passengerSegmentServices, { code: 'meal' });\n                    if (passengerSegmentMeal) {\n                        result = passengerSegmentMeal.serviceItem;\n                    }\n                }\n            }\n        }\n        return result;\n    }\n\n    function scrollToStart() {\n        passengersTableContainer.scrollTo(0);\n    }\n\n    function scrollToEnd() {\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\n    }\n\n    function mobileTableScrollHandler() {\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\n            scrollWidth = passengersTableContainer[0].scrollWidth,\n            clientWidth = passengersTableContainer[0].clientWidth,\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\n        vm.canScrollRight = (scrollRight !== 0);\n        vm.canScrollLeft = (scrollLeft !== 0);\n        $scope.$apply();\n    }\n\n    function getFirstAvailableFlightNum() {\n        var i;\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n            if (vm.service.availableBySegments[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getFirstAvailablePassengerNum(flightNum) {\n        var i;\n        if (vm.service.availableByPassengerSegments) {\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    function checkAllChoose() {\n\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\n          if (getSelectedPassengerFlightMeal(j, i)) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n\n    }\n\n}\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esSeatRossiya', {\n    templateUrl: 'components/es-seat-rossiya/es-seat-rossiya.html',\n    controller: ['$scope', '$element', '$timeout', 'backend', 'utils', SeatRossiyaController],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        babyBassinetService: '=',\n        locked: '=locked'\n    }\n});\n\nfunction SeatRossiyaController($scope, $element, $timeout, backend, utils) {\n\n    var vm = this,\n        passengersTableContainer = $element.find('div.passengersTableContainer'),\n        seatMapContainerTopPosition = '0px';\n\n    vm.switchService = switchService;\n\n    vm.selectFlightPassenger = selectFlightPassenger;\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\n    vm.setPassengerFlightSeat = setPassengerFlightSeat;\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\n    vm.checkAllChoose = checkAllChoose;\n\n    vm.hasAlias = backend.hasAlias;\n\n    vm.scrollToStart = scrollToStart;\n    vm.scrollToEnd = scrollToEnd;\n\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\n    vm.getAvailablePassengersCountWrap = getAvailablePassengersCountWrap;\n\n    vm.removePassengerFlightSeat = removePassengerFlightSeat;\n\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\n\n    vm.canScrollRight = true;\n    vm.canScrollLeft = false;\n\n    backend.addOrderInfoListener(function (orderInfo) {\n        vm.orderInfo = orderInfo;\n    }, false, true);\n\n    updateSunInfoByFlights();\n\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\n\n    if (vm.service.active) {\n        selectFirstAvailablePassengerFlight();\n    }\n\n    function switchService() {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('seat')) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                selectFirstAvailablePassengerFlight();\n            } else {\n                vm.modifyError = false;\n                backend.removeExtraService({\n                    code: 'seat'\n                }).then(function () {\n                    clearFlightPassenger();\n                    if (\n                        vm.orderInfo.editable_extra_services &&\n                        _.findWhere(vm.orderInfo.editable_extra_services, { code: 'babyBassinet' })\n                    ) {\n                        backend.removeExtraService({\n                            code: 'babyBassinet'\n                        })\n                    }\n                }, function (resp) {\n                    if (resp.error) {\n                        vm.modifyError = resp.error;\n                    }\n                });\n            }\n        }\n    }\n\n    function clearFlightPassenger() {\n        vm.seatMap = false;\n        vm.selectedFlight = -1;\n        vm.selectedPassenger = -1;\n    }\n\n    function setSeatMapContainerTopPosition(reset) {\n        if (reset) {\n            seatMapContainerTopPosition = '0px';\n        } else {\n            seatMapContainerTopPosition = jQuery('#seatMapCont .mCSB_container').css('top');\n        }\n    }\n\n    function selectFlightPassenger(flightNum, passengerNum) {\n        // Нужно запомнить положение карты мест для переключения между пассажирами одного сегмента\n        setSeatMapContainerTopPosition(vm.selectedFlight !== flightNum);\n        vm.selectedFlight = flightNum;\n        vm.selectedPassenger = passengerNum;\n        updateSeatMap();\n    }\n\n    function selectFirstAvailablePassengerFlight() {\n        vm.selectedFlight = getFirstAvailableFlightNum();\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\n        updateSeatMap();\n    }\n\n    function updateSeatMap() {\n\n        if (vm.selectedPassenger !== -1 && vm.selectedFlight !== -1) {\n            vm.loadingSeatMap = true;\n            vm.seatMapError = false;\n            backend.seatMap(\n                vm.orderInfo.passengers[vm.selectedPassenger].id,\n                vm.orderInfo.plainFlights[vm.selectedFlight].id\n            ).then(function (resp) {\n                vm.seatMap = resp;\n                vm.seatMap.hasSeatsWithBabyBassinet = checkExistSeatsWithBabyBassinetBySeatMap(resp);\n                vm.loadingSeatMap = false;\n                $timeout(function () {\n                    jQuery('#seatMapCont .mCSB_container').css('top', seatMapContainerTopPosition);\n                });\n            }, function (resp) {\n                vm.seatMapError = resp.error;\n                vm.loadingSeatMap = false;\n            });\n        }\n\n    }\n\n    function checkExistSeatsWithBabyBassinetBySeatMap(seatMap) {\n        var hasBabyBassinet = false;\n        if (seatMap && seatMap.decks) {\n            seatMap.decks.forEach(function (deck) {\n                if (deck && deck.cabins) {\n                    deck.cabins.forEach(function (cabin) {\n                        if (cabin && cabin.rows) {\n                            cabin.rows.forEach(function (row) {\n                                if (row && row.chairs) {\n                                    row.chairs.forEach(function (chair) {\n                                        if (checkExistSeatsWithBabyBassinetByChair(chair)) {\n                                            hasBabyBassinet = true;\n                                        }\n                                    });\n                                }\n                            });\n                        }\n                    });\n                }\n            });\n        }\n        return hasBabyBassinet;\n    }\n\n    function checkExistSeatsWithBabyBassinetByChair(chair) {\n        var hasBabyBassinet = false;\n        if (chair && chair.properties) {\n            chair.properties.forEach(function (prop) {\n                if (prop === 'babyBassinet') {\n                    hasBabyBassinet = true\n                }\n            });\n        }\n        return hasBabyBassinet;\n    }\n\n    function setPassengerFlightSeat(chair, cabinAllowed, rowNumber) {\n        var babyBassinetItem,\n            paxId = vm.orderInfo.passengers[vm.selectedPassenger].id,\n            segId = vm.orderInfo.plainFlights[vm.selectedFlight].id;\n        if (!vm.locked) {\n            if (chair.available && cabinAllowed) {\n                setSeatMapContainerTopPosition();\n                vm.modifyError = false;\n                backend.modifyExtraService({\n                    code: 'seat',\n                    passenger_id: paxId,\n                    segment_id: segId,\n                    value: rowNumber + chair.number,\n                    subgroup: vm.service.commonSubgroup,\n                    rfisc: chair.rfisc || '',\n                    service_type: 'F'\n                }).then(function () {\n                    updateSeatMap()\n                    if (checkExistSeatsWithBabyBassinetByChair(chair)) {\n                        if (\n                            vm.babyBassinetService &&\n                            vm.babyBassinetService.itemsByPassengerSegments &&\n                            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger] &&\n                            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]\n                        ) { \n                            babyBassinetItem = utils.getFirstNotEmptySubListItem(vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]);\n                            if (\n                                babyBassinetItem &&\n                                babyBassinetItem.serviceType &&\n                                babyBassinetItem.rfisc\n                            ) {\n                                backend.modifyExtraService({\n                                    code: 'babyBassinet',\n                                    passenger_id: paxId,\n                                    segment_id: segId,\n                                    subgroup: vm.babyBassinetService.commonSubgroup,\n                                    rfisc: babyBassinetItem.rfisc,\n                                    service_type: babyBassinetItem.serviceType\n                                })\n                            }\n                        }\n                    } else {\n                        removeBabyBassinetIfExist(paxId, segId);\n                    }\n                }, function (resp) {\n                    if (resp.error) {\n                        vm.modifyError = resp.error;\n                    }\n                });\n            }\n        }\n    }\n\n    function updateSunInfoByFlights() {\n        vm.sunInfoByFlights = [];\n        vm.orderInfo.plainFlights.forEach(function (flight, flightNum) {\n            backend.sunInfo(\n                flight.origincity,\n                flight.departuredate,\n                flight.departuretime,\n                flight.destinationcity,\n                flight.arrivaldate,\n                flight.arrivaltime\n            ).then(function (resp) {\n                vm.sunInfoByFlights[flightNum] = resp;\n            });\n        });\n    }\n\n    function getFirstAvailableFlightNum() {\n        var i;\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n            if (vm.service.availableBySegments[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getFirstAvailablePassengerNum(flightNum) {\n        var i;\n        if (vm.service.availableByPassengerSegments) {\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    function scrollToStart() {\n        passengersTableContainer.scrollTo(0);\n    }\n\n    function scrollToEnd() {\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\n    }\n\n    function mobileTableScrollHandler() {\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\n            scrollWidth = passengersTableContainer[0].scrollWidth,\n            clientWidth = passengersTableContainer[0].clientWidth,\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\n        vm.canScrollRight = (scrollRight !== 0);\n        vm.canScrollLeft = (scrollLeft !== 0);\n        $scope.$apply();\n    }\n\n    function getAvailablePassengersCountWrap(availableByPassengerSegments) {\n        var count = utils.getAvailablePassengersCount(availableByPassengerSegments);\n        return count + vm.orderInfo.passengers.filter(function (pax) {\n            return !pax.hasSeats;\n        }).length;\n    }\n\n    function removePassengerFlightSeat(passengerNum, flightNum) {\n        var paxId = vm.orderInfo.passengers[passengerNum].id,\n            segId = vm.orderInfo.plainFlights[flightNum].id;\n        if (\n            !vm.locked && !backend.checkServiceRemovalProhibited('seat', passengerNum, flightNum)\n        ) {\n            vm.modifyError = false;\n            \n            backend.removeExtraService({\n                code: 'seat',\n                passenger_id: paxId,\n                segment_id: segId\n            }).then(function () {\n                removeBabyBassinetIfExist(paxId, segId);\n                if (vm.selectedFlight === flightNum) {\n                    updateSeatMap();\n                }\n            }, function (resp) {\n                if (resp.error) {\n                    vm.modifyError = resp.error;\n                }\n            });\n            \n           \n        }\n    }\n\n    function removeBabyBassinetIfExist(paxId, segId) {\n        if (\n            vm.orderInfo.editableExtraServicesHeap &&\n            _.findWhere(\n                vm.orderInfo.editableExtraServicesHeap,\n                {\n                    groupCode: 'babyBassinet',\n                    mainSegmentId: segId,\n                    passengerId: paxId\n                }\n            )\n        ) {\n            backend.removeExtraService({\n                code: 'babyBassinet',\n                passenger_id: paxId,\n                segment_id: segId\n            })\n        }\n    }\n\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\n        var result,\n            passengerSegmentServices,\n            passengerSegmentSeat;\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\n                /* jshint maxlen: 150 */\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\n                if (passengerSegmentServices) {\n                    passengerSegmentSeat = _.findWhere(passengerSegmentServices, { code: 'seat' });\n                    if (passengerSegmentSeat) {\n                        result = passengerSegmentSeat.serviceItem;\n                    }\n                }\n            }\n        }\n        return result;\n    }\n\n    function checkAllChoose() {\n\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\n          if (getSelectedPassengerFlightMeal(j, i)) {\n            return true\n          }\n        }\n      }\n\n      return false;\n\n    }\n\n}\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nangular.module('app').component('orderRossiya', {\n    templateUrl: 'components/order-rossiya/order-rossiya.html',\n    controller: ['$window', '$timeout', 'backend', 'utils', 'redirect', 'fancyboxTools', OrderRossiyaController],\n    controllerAs: 'vm',\n    bindings: {\n        pnrOrTicketNumber: '=num',\n        lastName: '=lastname'\n    }\n});\n\nfunction OrderRossiyaController($window, $timeout, backend, utils, redirect, fancyboxTools) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.errorMessage = false;\n    vm.openExchange = redirect.goToExchange;\n    vm.openRefund = redirect.goToRefund;\n    vm.openAddServices = redirect.goToAddServices;\n    vm.suffixCount = utils.suffixCount;\n    vm.retryPayment = retryPayment;\n    vm.bindOrder = bindOrder;\n    vm.checkAllPassengersHavePaidService = checkAllPassengersHavePaidService;\n    vm.clearSession = clearSession;\n\n    backend.searchOrder(vm.pnrOrTicketNumber, vm.lastName).then(function (orderInfo) {\n\n        var resultParam = utils.getParamFromLocation('result');\n\n        vm.orderInfo = orderInfo;\n\n        if (\n            vm.orderInfo.header &&\n            (\n                vm.orderInfo.header.status === 'being_paid' ||\n                vm.orderInfo.header.status === 'being_paid_for_exchange'\n            )\n        ) {\n            if (resultParam === 'success') {\n                backend.waitPayment(vm.orderInfo.header.regnum, vm.lastName).then(function () {\n                    $window.location = './order?pnr=' + vm.orderInfo.header.regnum + '&lastName=' + vm.lastName + '&result=success';\n                    return;\n                }, function () {\n                    vm.loading = false;\n                });\n            } else {\n                if (!vm.orderInfo.hasFailedServices) {\n                    vm.showPaymentFrame = true;\n                }\n                vm.loading = false;\n            }\n        } else {\n            vm.loading = false;\n        }\n\n        if (\n            vm.orderInfo.hasFailedServices &&\n            !resultParam &&\n            vm.orderInfo.header &&\n            (\n                vm.orderInfo.header.status === 'being_paid' ||\n                vm.orderInfo.header.status === 'booked'\n            )\n        ) {\n            $timeout(function () {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function () {\n                        if (vm.orderInfo.paymentRedirectTo) {\n                            vm.showPaymentFrame = true;\n                        }\n                        vm.ignoreFailedServices = true;\n                    },\n                    disableOutsideCloseClick: true\n                });\n            });\n        }\n\n\n        if (\n            backend.getParam('ffp.enable') &&\n            (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)\n        ) {\n            backend.ffpBonus().then(function (resp) {\n                vm.ffpBonus = resp.total || 0;\n            });\n        }\n\n    }, function (resp) {\n        vm.loading = false;\n        vm.errorMessage = resp.error;\n    });\n\n    function retryPayment() {\n        vm.loading = true;\n        backend.retryRegister().then(function (resp) {\n            if (resp.lastName && resp.pnr) {\n                $window.location = './order?pnr=' + resp.pnr + '&lastName=' + resp.lastName;\n            } else {\n                vm.loading = false;\n            }\n        }, function (resp) {\n            vm.loading = false;\n            vm.errorMessage = resp.error;\n        });\n    }\n\n    function bindOrder() {\n        if (!vm.orderInfo.header || !vm.orderInfo.header.regnum) {\n            return;\n        }\n        vm.loading = true;\n        backend.bindOrder(vm.orderInfo.header.regnum, vm.lastName).then(function () {\n            vm.loading = false;\n            vm.orderInfo.bindAlowed = false;\n            vm.showBindOrderSuccessMessage = true;\n            $timeout(function () {\n                vm.showBindOrderSuccessMessage = false;\n            }, 10000);\n        }, function () {\n            vm.loading = false;\n            vm.showBindOrderFailMessage = true;\n            $timeout(function () {\n                vm.showBindOrderFailMessage = false;\n            }, 10000);\n        });\n    }\n\n    function checkAllPassengersHavePaidService(name) {\n        var result = true;\n        vm.orderInfo.passengers.forEach(function (passenger, passengerNum) {\n            if (\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers &&\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum] &&\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices\n\t\t\t) {\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices.forEach(\n\t\t\t\t\tfunction (segmentServices) {\n\t\t\t\t\t\tvar segmentWantedService = _.findWhere(segmentServices, { code: name });\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!segmentServices || !segmentWantedService ||\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tsegmentWantedService &&\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem &&\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem.status !== 'ISSUED_WITH_EMD'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresult = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tresult = false;\n\t\t\t}\n        });\n        return result;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n}\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('popupMealRossiya', {\n\ttemplateUrl: 'components/popup-meal-rossiya/popup-meal-rossiya.html',\n\tcontroller: ['utils', '$scope', PopupMealRossiyaController],\n\tcontrollerAs: 'vm',\n\tbindings: {\n\t\tmealMenu: '=menu',\n\t\tpassenger: '=passenger',\n\t\tcurrentPassengerIndex: '=',\n\t\tcurrentFlightIndex: '=',\n\t\tpassengers: '=passengers',\n\t\tflight: '=flight',\n\t\tsetPassengerFlightMeal: '=handler',\n\t\tclearPassengerFlightMeal: '&remove',\n\t\tgetPassengerFlightMeal: '=get',\n\t\tsubgroups: '=subgroups',\n\t\tmealImagesPath: '=path',\n\t\tservice: '=',\n\t\tselectFlightPassenger: '=select'\n\t}\n});\n\nfunction PopupMealRossiyaController(utils, $scope) {\n\n\tvar vm = this;\n\tvm.close = jQuery.fancybox.close;\n\tvm.mealMenuSubgroupMobileChange = mealMenuSubgroupMobileChange;\n\tvm.mealMenuSubgroup = false;\n\tvm.mealMenuSubgroupMobile = 'false';\n\tvm.subgroupItems = utils.createOptionsForUiSelect(vm.subgroups, 'all');\n\tvm.switchNext = switchNext;\n\tvm.switchPrev = switchPrev;\n\tvm.arrayString = arrayString;\n\tvm.getGroupMeal = getGroupMeal;\n\n\tfunction setAvailablePassengers() {\n\t\tvm.availablePassengers = vm.passengers.filter(function (passenger, index) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index] &&\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index][vm.currentFlightIndex]\n\t\t\t\t\t);\n\t\t\t});\n\t}\n\n\t$scope.$watch('vm.currentFlightIndex', function () {\n\t\tsetAvailablePassengers();\n\t});\n\n\tfunction mealMenuSubgroupMobileChange() {\n\t\tif (vm.mealMenuSubgroupMobile === false) {\n\t\t\tvm.mealMenuSubgroup = false;\n\t\t} else {\n\t\t\tvm.mealMenuSubgroup = vm.mealMenuSubgroupMobile * 1;\n\t\t}\n\t}\n\n\tfunction switchNext() {\n\t\tvar successSwitch = false;\n\t\tfor (var i = vm.currentPassengerIndex + 1; i < vm.passengers.length; i++) {\n\t\t\tif (\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\n\t\t\t) {\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\n\t\t\t\tsuccessSwitch = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!successSwitch) {\n\t\t\tfor (var j = 0; j < vm.passengers.length; j++) {\n\t\t\t\tif (\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\n\t\t\t\t) {\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction switchPrev() {\n\t\tvar successSwitch = false;\n\t\tfor (var i = vm.currentPassengerIndex - 1; i > -1; i--) {\n\t\t\tif (\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\n\t\t\t) {\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\n\t\t\t\tsuccessSwitch = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!successSwitch) {\n\t\t\tfor (var j = vm.passengers.length - 1; j > -1; j--) {\n\t\t\t\tif (\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\n\t\t\t\t) {\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction arrayString(arrays) {\n\n\t\tif(!Array.isArray(arrays)) return;\n\n\t\tvar total = arrays.reduce(function(flat, current) {\n\t\t\treturn flat.concat(current);\n\t\t}, []);\n\n\t\tif(vm.mealMenuSubgroup === false ) return total;\n\n\t\treturn arrays;\n\t}\n\n\tfunction getGroupMeal(meal, arrays) {\n\n\t\tfor (var i = 0; i < arrays.length; i++) {\n\t\t\tfor(var j = 0; j < arrays[i].length; j++) {\n\t\t\t\tif (arrays[i][j]['rfisc'] == meal['rfisc']) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\nrequire('./components/popup-meal-rossiya/popup-meal-rossiya');\nrequire('./components/es-meal-rossiya/es-meal-rossiya');\nrequire('./components/es-seat-rossiya/es-seat-rossiya');\nrequire('./components/order-rossiya/order-rossiya');\nrequire('./components/baby-bassinet-icon/baby-bassinet-icon');\nrequire('./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend');\n},{\"./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend\":1,\"./components/baby-bassinet-icon/baby-bassinet-icon\":2,\"./components/es-meal-rossiya/es-meal-rossiya\":3,\"./components/es-seat-rossiya/es-seat-rossiya\":4,\"./components/order-rossiya/order-rossiya\":5,\"./components/popup-meal-rossiya/popup-meal-rossiya\":6}]},{},[7]);\n"]}
>>>>>>> f20190b056ed7b4a16f51cb4861b8e5d41051064
