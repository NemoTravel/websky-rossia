{"version":3,"sources":["controllers-rossia.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","BabyBassinetIconController","angular","component","templateUrl","controller","controllerAs","bindings","rfisc","2","MealRossiyaController","$scope","$element","backend","utils","switchService","vm","locked","checkServiceRemovalProhibited","service","active","selectFirstAvailablePassengerFlight","removeExtraService","selectFlightPassenger","flightNum","passengerNum","selectedFlight","selectedPassenger","updateMealMenu","getFirstAvailableFlightNum","getFirstAvailablePassengerNum","mealMenu","itemsByPassengerSegments","undefined","mealMenuSubgroup","setPassengerFlightMeal","subgroupNum","mealItem","selectedPassengerFlightMeal","getSelectedPassengerFlightMeal","newMealParams","passenger_id","orderInfo","passengers","id","segment_id","plainFlights","subgroup","subgroups","service_type","serviceType","then","modifyExtraService","removePassengerFlightMeal","result","passengerSegmentServices","passengerSegmentMeal","editableExtraServicesByPassengers","_","findWhere","serviceItem","scrollToStart","passengersTableContainer","scrollTo","scrollToEnd","scrollWidth","mobileTableScrollHandler","scrollLeft","clientWidth","scrollRight","canScrollRight","canScrollLeft","$apply","availableBySegments","availableByPassengerSegments","checkAllChoose","j","this","find","hasAlias","getAvailablePassengersCount","getParam","mealImagesPath","addOrderInfoListener","$watch","on","3","SeatRossiyaController","$timeout","modifyError","clearFlightPassenger","resp","error","seatMap","setSeatMapContainerTopPosition","reset","seatMapContainerTopPosition","jQuery","css","updateSeatMap","loadingSeatMap","seatMapError","setPassengerFlightSeat","chair","cabinAllowed","rowNumber","available","value","number","commonSubgroup","updateSunInfoByFlights","sunInfoByFlights","forEach","flight","sunInfo","origincity","departuredate","departuretime","destinationcity","arrivaldate","arrivaltime","getAvailablePassengersCountWrap","count","filter","pax","hasSeats","removePassengerFlightSeat","passengerSegmentSeat","4","OrderRossiyaController","$window","redirect","fancyboxTools","retryPayment","loading","retryRegister","lastName","pnr","location","errorMessage","bindOrder","header","regnum","bindAlowed","showBindOrderSuccessMessage","showBindOrderFailMessage","checkAllPassengersHavePaidService","name","passenger","allExtraServicesByPassengers","segmentServices","segmentWantedService","status","clearSession","goToSearchOrder","openExchange","goToExchange","openRefund","goToRefund","openAddServices","goToAddServices","suffixCount","searchOrder","pnrOrTicketNumber","resultParam","getParamFromLocation","waitPayment","hasFailedServices","showPaymentFrame","openHandler","submitCallback","paymentRedirectTo","ignoreFailedServices","disableOutsideCloseClick","hasBonusCard","ffpSumm","ffpBonus","total","5","PopupMealRossiyaController","setAvailablePassengers","availablePassengers","index","currentFlightIndex","mealMenuSubgroupMobileChange","mealMenuSubgroupMobile","switchNext","successSwitch","currentPassengerIndex","switchPrev","arrayString","arrays","Array","isArray","reduce","flat","current","concat","getGroupMeal","meal","close","fancybox","subgroupItems","createOptionsForUiSelect","clearPassengerFlightMeal","getPassengerFlightMeal","6","./components/baby-bassinet-icon/baby-bassinet-icon","./components/es-meal-rossiya/es-meal-rossiya","./components/es-seat-rossiya/es-seat-rossiya","./components/order-rossiya/order-rossiya","./components/popup-meal-rossiya/popup-meal-rossiya"],"mappings":"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","file":"controllers-rossia.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIcon', {\n    templateUrl: 'components/baby-bassinet-icon/baby-bassinet-icon.html',\n    controller: [BabyBassinetIconController],\n    controllerAs: 'vm',\n    bindings: {\n        rfisc: '=rfisc'\n    }\n});\n\nfunction BabyBassinetIconController() {\n    var vm = this;\n\n    function getColorByRFISC(rfisc, propName) {\n        var style = {};\n\n        style[propName] = {\n            '04D': '#1B3E6F',\n            '06Z': '#006DA4'\n        }[rfisc] || '#CBC8C8';\n\n        console.log('style: ', style);\n\n        return style;\n    }\n}\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esMealRossiya', {\n    templateUrl: 'components/es-meal-rossiya/es-meal-rossiya.html',\n    controller: ['$scope', '$element','backend', 'utils', MealRossiyaController],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        locked: '=locked'\n    }\n});\n\nfunction MealRossiyaController($scope, $element, backend, utils) {\n\n    var vm = this,\n        passengersTableContainer = $element.find('div.passengersTableContainer');\n\n    vm.switchService = switchService;\n    vm.selectFlightPassenger = selectFlightPassenger;\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\n    vm.setPassengerFlightMeal = setPassengerFlightMeal;\n    vm.removePassengerFlightMeal = removePassengerFlightMeal;\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\n    vm.scrollToStart = scrollToStart;\n    vm.scrollToEnd = scrollToEnd;\n    vm.checkAllChoose = checkAllChoose;\n    vm.hasAlias = backend.hasAlias;\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\n\n    vm.canScrollRight = true;\n    vm.canScrollLeft = false;\n\n    vm.selectedFlight = 0;\n    vm.selectedPassenger = 0;\n\n    if (backend.getParam('site.externalStorageBaseUrl')) {\n        vm.mealImagesPath = backend.getParam('site.externalStorageBaseUrl') + '/img/content/meal';\n    } else {\n        vm.mealImagesPath = './themes/websky/assets/static/img/content/meal';\n    }\n\n    backend.addOrderInfoListener(function (orderInfo) {\n        vm.orderInfo = orderInfo;\n    }, false, true);\n\n    $scope.$watch('vm.service', function () {\n        if (vm.mealMenu) {\n            updateMealMenu();\n        }\n    });\n\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\n\n    if (vm.service.active) {\n        updateMealMenu();\n    }\n\n    function switchService() {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal')) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                selectFirstAvailablePassengerFlight();\n            } else {\n                backend.removeExtraService({\n                    code: 'meal'\n                });\n            }\n        }\n    }\n\n    function selectFlightPassenger(flightNum, passengerNum) {\n        vm.selectedFlight = flightNum;\n        vm.selectedPassenger = passengerNum;\n        updateMealMenu();\n    }\n\n    function selectFirstAvailablePassengerFlight() {\n        vm.selectedFlight = getFirstAvailableFlightNum();\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\n        updateMealMenu();\n    }\n\n    function updateMealMenu() {\n        vm.mealMenu = vm.service.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight];\n        if (vm.mealMenuSubgroup === undefined) {\n            vm.mealMenuSubgroup = false;\n        }\n    }\n\n    function setPassengerFlightMeal(subgroupNum, mealItem) {\n        var selectedPassengerFlightMeal = getSelectedPassengerFlightMeal(vm.selectedPassenger, vm.selectedFlight),\n            newMealParams = {\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                subgroup: vm.service.subgroups[subgroupNum],\n                service_type: mealItem.serviceType,\n                rfisc: mealItem.rfisc\n            };\n        if (!vm.locked) {\n            if (\n                selectedPassengerFlightMeal &&\n                !backend.checkServiceRemovalProhibited('meal', vm.selectedPassenger, vm.selectedFlight)\n            ) {\n                backend.removeExtraService({\n                    code: 'meal',\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                    service_type: selectedPassengerFlightMeal.serviceType,\n                    rfisc: selectedPassengerFlightMeal.rfisc\n                }, true).then(function () {\n                    backend.modifyExtraService(newMealParams);\n                });\n            } else {\n                backend.modifyExtraService(newMealParams);\n            }\n        }\n    }\n\n    function removePassengerFlightMeal(passengerNum, flightNum) {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal', passengerNum, flightNum)) {\n            backend.removeExtraService({\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\n            });\n        }\n    }\n\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\n        var result,\n            passengerSegmentServices,\n            passengerSegmentMeal;\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\n                /* jshint maxlen: 150 */\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\n                if (passengerSegmentServices) {\n                    passengerSegmentMeal = _.findWhere(passengerSegmentServices, { code: 'meal' });\n                    if (passengerSegmentMeal) {\n                        result = passengerSegmentMeal.serviceItem;\n                    }\n                }\n            }\n        }\n        return result;\n    }\n\n    function scrollToStart() {\n        passengersTableContainer.scrollTo(0);\n    }\n\n    function scrollToEnd() {\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\n    }\n\n    function mobileTableScrollHandler() {\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\n            scrollWidth = passengersTableContainer[0].scrollWidth,\n            clientWidth = passengersTableContainer[0].clientWidth,\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\n        vm.canScrollRight = (scrollRight !== 0);\n        vm.canScrollLeft = (scrollLeft !== 0);\n        $scope.$apply();\n    }\n\n    function getFirstAvailableFlightNum() {\n        var i;\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n            if (vm.service.availableBySegments[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getFirstAvailablePassengerNum(flightNum) {\n        var i;\n        if (vm.service.availableByPassengerSegments) {\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    function checkAllChoose() {\n\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\n          if (getSelectedPassengerFlightMeal(j, i)) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n\n    }\n\n}\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esSeatRossiya', {\n    templateUrl: 'components/es-seat-rossiya/es-seat-rossiya.html',\n    controller: ['$scope', '$element', '$timeout', 'backend', 'utils', SeatRossiyaController],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        locked: '=locked'\n    }\n});\n\nfunction SeatRossiyaController($scope, $element, $timeout, backend, utils) {\n\n    var vm = this,\n        passengersTableContainer = $element.find('div.passengersTableContainer'),\n        seatMapContainerTopPosition = '0px';\n\n    vm.switchService = switchService;\n\n    vm.selectFlightPassenger = selectFlightPassenger;\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\n    vm.setPassengerFlightSeat = setPassengerFlightSeat;\n    //\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\n    vm.checkAllChoose = checkAllChoose;\n\n    vm.hasAlias = backend.hasAlias;\n\n    vm.scrollToStart = scrollToStart;\n    vm.scrollToEnd = scrollToEnd;\n\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\n    vm.getAvailablePassengersCountWrap = getAvailablePassengersCountWrap;\n\n    vm.removePassengerFlightSeat = removePassengerFlightSeat;\n\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\n\n    vm.canScrollRight = true;\n    vm.canScrollLeft = false;\n\n    backend.addOrderInfoListener(function (orderInfo) {\n        vm.orderInfo = orderInfo;\n    }, false, true);\n\n    updateSunInfoByFlights();\n\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\n\n    if (vm.service.active) {\n        selectFirstAvailablePassengerFlight();\n    }\n\n    function switchService() {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('seat')) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                selectFirstAvailablePassengerFlight();\n            } else {\n                vm.modifyError = false;\n                backend.removeExtraService({\n                    code: 'seat'\n                }).then(clearFlightPassenger, function (resp) {\n                    if (resp.error) {\n                        vm.modifyError = resp.error;\n                    }\n                });\n            }\n        }\n    }\n\n    function clearFlightPassenger() {\n        vm.seatMap = false;\n        vm.selectedFlight = -1;\n        vm.selectedPassenger = -1;\n    }\n\n    function setSeatMapContainerTopPosition(reset) {\n        if (reset) {\n            seatMapContainerTopPosition = '0px';\n        } else {\n            seatMapContainerTopPosition = jQuery('#seatMapCont .mCSB_container').css('top');\n        }\n    }\n\n    function selectFlightPassenger(flightNum, passengerNum) {\n        // Нужно запомнить положение карты мест для переключения между пассажирами одного сегмента\n        setSeatMapContainerTopPosition(vm.selectedFlight !== flightNum);\n        vm.selectedFlight = flightNum;\n        vm.selectedPassenger = passengerNum;\n        updateSeatMap();\n    }\n\n    function selectFirstAvailablePassengerFlight() {\n        vm.selectedFlight = getFirstAvailableFlightNum();\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\n        updateSeatMap();\n    }\n\n    function updateSeatMap() {\n\n        if (vm.selectedPassenger !== -1 && vm.selectedFlight !== -1) {\n            vm.loadingSeatMap = true;\n            vm.seatMapError = false;\n            backend.seatMap(\n                vm.orderInfo.passengers[vm.selectedPassenger].id,\n                vm.orderInfo.plainFlights[vm.selectedFlight].id\n            ).then(function (resp) {\n                vm.seatMap = resp;\n                vm.loadingSeatMap = false;\n                $timeout(function () {\n                    jQuery('#seatMapCont .mCSB_container').css('top', seatMapContainerTopPosition);\n                });\n            }, function (resp) {\n                vm.seatMapError = resp.error;\n                vm.loadingSeatMap = false;\n            });\n        }\n\n    }\n\n    function setPassengerFlightSeat(chair, cabinAllowed, rowNumber) {\n        if (!vm.locked) {\n            if (chair.available && cabinAllowed) {\n                setSeatMapContainerTopPosition();\n                vm.modifyError = false;\n                backend.modifyExtraService({\n                    code: 'seat',\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                    value: rowNumber + chair.number,\n                    subgroup: vm.service.commonSubgroup,\n                    rfisc: chair.rfisc || '',\n                    service_type: 'F'\n                }).then(updateSeatMap, function (resp) {\n                    if (resp.error) {\n                        vm.modifyError = resp.error;\n                    }\n                });\n            }\n        }\n    }\n\n    function updateSunInfoByFlights() {\n        vm.sunInfoByFlights = [];\n        vm.orderInfo.plainFlights.forEach(function (flight, flightNum) {\n            backend.sunInfo(\n                flight.origincity,\n                flight.departuredate,\n                flight.departuretime,\n                flight.destinationcity,\n                flight.arrivaldate,\n                flight.arrivaltime\n            ).then(function (resp) {\n                vm.sunInfoByFlights[flightNum] = resp;\n            });\n        });\n    }\n\n    function getFirstAvailableFlightNum() {\n        var i;\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n            if (vm.service.availableBySegments[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getFirstAvailablePassengerNum(flightNum) {\n        var i;\n        if (vm.service.availableByPassengerSegments) {\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    function scrollToStart() {\n        passengersTableContainer.scrollTo(0);\n    }\n\n    function scrollToEnd() {\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\n    }\n\n    function mobileTableScrollHandler() {\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\n            scrollWidth = passengersTableContainer[0].scrollWidth,\n            clientWidth = passengersTableContainer[0].clientWidth,\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\n        vm.canScrollRight = (scrollRight !== 0);\n        vm.canScrollLeft = (scrollLeft !== 0);\n        $scope.$apply();\n    }\n\n    function getAvailablePassengersCountWrap(availableByPassengerSegments) {\n        var count = utils.getAvailablePassengersCount(availableByPassengerSegments);\n        return count + vm.orderInfo.passengers.filter(function (pax) {\n            return !pax.hasSeats;\n        }).length;\n    }\n\n    function removePassengerFlightSeat(passengerNum, flightNum) {\n        if (\n            !vm.locked && !backend.checkServiceRemovalProhibited('seat', passengerNum, flightNum)\n        ) {\n            vm.modifyError = false;\n            backend.removeExtraService({\n                code: 'seat',\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\n            }).then(function () {\n                if (vm.selectedFlight === flightNum) {\n                    updateSeatMap();\n                }\n            }, function (resp) {\n                if (resp.error) {\n                    vm.modifyError = resp.error;\n                }\n            });\n        }\n    }\n\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\n        var result,\n            passengerSegmentServices,\n            passengerSegmentSeat;\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\n                /* jshint maxlen: 150 */\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\n                if (passengerSegmentServices) {\n                    passengerSegmentSeat = _.findWhere(passengerSegmentServices, { code: 'seat' });\n                    if (passengerSegmentSeat) {\n                        result = passengerSegmentSeat.serviceItem;\n                    }\n                }\n            }\n        }\n        return result;\n    }\n\n    function checkAllChoose() {\n\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\n          if (getSelectedPassengerFlightMeal(j, i)) {\n            return true\n          }\n        }\n      }\n\n      return false;\n\n    }\n\n}\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\n\nangular.module('app').component('orderRossiya', {\n    templateUrl: 'components/order-rossiya/order-rossiya.html',\n    controller: ['$window', '$timeout', 'backend', 'utils', 'redirect', 'fancyboxTools', OrderRossiyaController],\n    controllerAs: 'vm',\n    bindings: {\n        pnrOrTicketNumber: '=num',\n        lastName: '=lastname'\n    }\n});\n\nfunction OrderRossiyaController($window, $timeout, backend, utils, redirect, fancyboxTools) {\n\n    var vm = this;\n    vm.loading = true;\n    vm.errorMessage = false;\n    vm.openExchange = redirect.goToExchange;\n    vm.openRefund = redirect.goToRefund;\n    vm.openAddServices = redirect.goToAddServices;\n    vm.suffixCount = utils.suffixCount;\n    vm.retryPayment = retryPayment;\n    vm.bindOrder = bindOrder;\n    vm.checkAllPassengersHavePaidService = checkAllPassengersHavePaidService;\n    vm.clearSession = clearSession;\n\n    backend.searchOrder(vm.pnrOrTicketNumber, vm.lastName).then(function (orderInfo) {\n\n        var resultParam = utils.getParamFromLocation('result');\n\n        vm.orderInfo = orderInfo;\n\n        if (\n            vm.orderInfo.header &&\n            (\n                vm.orderInfo.header.status === 'being_paid' ||\n                vm.orderInfo.header.status === 'being_paid_for_exchange'\n            )\n        ) {\n            if (resultParam === 'success') {\n                backend.waitPayment(vm.orderInfo.header.regnum, vm.lastName).then(function () {\n                    $window.location = './order?pnr=' + vm.orderInfo.header.regnum + '&lastName=' + vm.lastName + '&result=success';\n                    return;\n                }, function () {\n                    vm.loading = false;\n                });\n            } else {\n                if (!vm.orderInfo.hasFailedServices) {\n                    vm.showPaymentFrame = true;\n                }\n                vm.loading = false;\n            }\n        } else {\n            vm.loading = false;\n        }\n\n        if (\n            vm.orderInfo.hasFailedServices &&\n            !resultParam &&\n            vm.orderInfo.header &&\n            (\n                vm.orderInfo.header.status === 'being_paid' ||\n                vm.orderInfo.header.status === 'booked'\n            )\n        ) {\n            $timeout(function () {\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\n                    submitCallback: function () {\n                        if (vm.orderInfo.paymentRedirectTo) {\n                            vm.showPaymentFrame = true;\n                        }\n                        vm.ignoreFailedServices = true;\n                    },\n                    disableOutsideCloseClick: true\n                });\n            });\n        }\n\n\n        if (\n            backend.getParam('ffp.enable') &&\n            (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)\n        ) {\n            backend.ffpBonus().then(function (resp) {\n                vm.ffpBonus = resp.total || 0;\n            });\n        }\n\n    }, function (resp) {\n        vm.loading = false;\n        vm.errorMessage = resp.error;\n    });\n\n    function retryPayment() {\n        vm.loading = true;\n        backend.retryRegister().then(function (resp) {\n            if (resp.lastName && resp.pnr) {\n                $window.location = './order?pnr=' + resp.pnr + '&lastName=' + resp.lastName;\n            } else {\n                vm.loading = false;\n            }\n        }, function (resp) {\n            vm.loading = false;\n            vm.errorMessage = resp.error;\n        });\n    }\n\n    function bindOrder() {\n        if (!vm.orderInfo.header || !vm.orderInfo.header.regnum) {\n            return;\n        }\n        vm.loading = true;\n        backend.bindOrder(vm.orderInfo.header.regnum, vm.lastName).then(function () {\n            vm.loading = false;\n            vm.orderInfo.bindAlowed = false;\n            vm.showBindOrderSuccessMessage = true;\n            $timeout(function () {\n                vm.showBindOrderSuccessMessage = false;\n            }, 10000);\n        }, function () {\n            vm.loading = false;\n            vm.showBindOrderFailMessage = true;\n            $timeout(function () {\n                vm.showBindOrderFailMessage = false;\n            }, 10000);\n        });\n    }\n\n    function checkAllPassengersHavePaidService(name) {\n        var result = true;\n        vm.orderInfo.passengers.forEach(function (passenger, passengerNum) {\n            if (\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers &&\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum] &&\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices\n\t\t\t) {\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices.forEach(\n\t\t\t\t\tfunction (segmentServices) {\n\t\t\t\t\t\tvar segmentWantedService = _.findWhere(segmentServices, { code: name });\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!segmentServices || !segmentWantedService ||\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tsegmentWantedService &&\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem &&\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem.status !== 'ISSUED_WITH_EMD'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresult = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tresult = false;\n\t\t\t}\n        });\n        return result;\n    }\n\n    function clearSession() {\n        backend.clearSession().then(function () {\n            redirect.goToSearchOrder();\n        });\n    }\n\n}\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('popupMealRossiya', {\n\ttemplateUrl: 'components/popup-meal-rossiya/popup-meal-rossiya.html',\n\tcontroller: ['utils', '$scope', PopupMealRossiyaController],\n\tcontrollerAs: 'vm',\n\tbindings: {\n\t\tmealMenu: '=menu',\n\t\tpassenger: '=passenger',\n\t\tcurrentPassengerIndex: '=',\n\t\tcurrentFlightIndex: '=',\n\t\tpassengers: '=passengers',\n\t\tflight: '=flight',\n\t\tsetPassengerFlightMeal: '=handler',\n\t\tclearPassengerFlightMeal: '&remove',\n\t\tgetPassengerFlightMeal: '=get',\n\t\tsubgroups: '=subgroups',\n\t\tmealImagesPath: '=path',\n\t\tservice: '=',\n\t\tselectFlightPassenger: '=select'\n\t}\n});\n\nfunction PopupMealRossiyaController(utils, $scope) {\n\n\tvar vm = this;\n\tvm.close = jQuery.fancybox.close;\n\tvm.mealMenuSubgroupMobileChange = mealMenuSubgroupMobileChange;\n\tvm.mealMenuSubgroup = false;\n\tvm.mealMenuSubgroupMobile = 'false';\n\tvm.subgroupItems = utils.createOptionsForUiSelect(vm.subgroups, 'all');\n\tvm.switchNext = switchNext;\n\tvm.switchPrev = switchPrev;\n\tvm.arrayString = arrayString;\n\tvm.getGroupMeal = getGroupMeal;\n\n\tfunction setAvailablePassengers() {\n\t\tvm.availablePassengers = vm.passengers.filter(function (passenger, index) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index] &&\n\t\t\t\t\t\t\tvm.service.availableByPassengerSegments[index][vm.currentFlightIndex]\n\t\t\t\t\t);\n\t\t\t});\n\t}\n\n\t$scope.$watch('vm.currentFlightIndex', function () {\n\t\tsetAvailablePassengers();\n\t});\n\n\tfunction mealMenuSubgroupMobileChange() {\n\t\tif (vm.mealMenuSubgroupMobile === false) {\n\t\t\tvm.mealMenuSubgroup = false;\n\t\t} else {\n\t\t\tvm.mealMenuSubgroup = vm.mealMenuSubgroupMobile * 1;\n\t\t}\n\t}\n\n\tfunction switchNext() {\n\t\tvar successSwitch = false;\n\t\tfor (var i = vm.currentPassengerIndex + 1; i < vm.passengers.length; i++) {\n\t\t\tif (\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\n\t\t\t) {\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\n\t\t\t\tsuccessSwitch = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!successSwitch) {\n\t\t\tfor (var j = 0; j < vm.passengers.length; j++) {\n\t\t\t\tif (\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\n\t\t\t\t) {\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction switchPrev() {\n\t\tvar successSwitch = false;\n\t\tfor (var i = vm.currentPassengerIndex - 1; i > -1; i--) {\n\t\t\tif (\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\n\t\t\t) {\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\n\t\t\t\tsuccessSwitch = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!successSwitch) {\n\t\t\tfor (var j = vm.passengers.length - 1; j > -1; j--) {\n\t\t\t\tif (\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\n\t\t\t\t) {\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction arrayString(arrays) {\n\n\t\tif(!Array.isArray(arrays)) return;\n\n\t\tvar total = arrays.reduce(function(flat, current) {\n\t\t\treturn flat.concat(current);\n\t\t}, []);\n\n\t\tif(vm.mealMenuSubgroup === false ) return total;\n\n\t\treturn arrays;\n\t}\n\n\tfunction getGroupMeal(meal, arrays) {\n\n\t\tfor (var i = 0; i < arrays.length; i++) {\n\t\t\tfor(var j = 0; j < arrays[i].length; j++) {\n\t\t\t\tif (arrays[i][j]['rfisc'] == meal['rfisc']) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\nrequire('./components/popup-meal-rossiya/popup-meal-rossiya');\nrequire('./components/es-meal-rossiya/es-meal-rossiya');\nrequire('./components/es-seat-rossiya/es-seat-rossiya');\nrequire('./components/order-rossiya/order-rossiya');\nrequire('./components/baby-bassinet-icon/baby-bassinet-icon');\n},{\"./components/baby-bassinet-icon/baby-bassinet-icon\":1,\"./components/es-meal-rossiya/es-meal-rossiya\":2,\"./components/es-seat-rossiya/es-seat-rossiya\":3,\"./components/order-rossiya/order-rossiya\":4,\"./components/popup-meal-rossiya/popup-meal-rossiya\":5}]},{},[6]);\n"]}