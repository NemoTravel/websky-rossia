{"version":3,"sources":["controllers-rossia.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","angular","component","templateUrl","2","3","controller","controllerAs","bindings","rfisc","active","disabled","4","MealRossiyaController","$scope","$element","backend","utils","switchService","vm","locked","checkServiceRemovalProhibited","service","selectFirstAvailablePassengerFlight","removeExtraService","mealCountChangeHandler","subgroupNum","mealItem","delta","modifyExtraService","passenger_id","orderInfo","passengers","selectedPassenger","id","segment_id","plainFlights","selectedFlight","subgroup","subgroups","amount","alreadySelectedCount","service_type","serviceType","getLimitStatus","selectFlightPassenger","flightNum","passengerNum","updateMealMenu","getFirstAvailableFlightNum","getFirstAvailablePassengerNum","mealMenu","flattenMealMenu","itemsByPassengerSegments","undefined","mealMenuSubgroup","deepMenu","flatMenu","forEach","deepMenuItems","deepMenuItem","push","setPassengerFlightMeal","selectedPassengerFlightMeal","getSelectedPassengerFlightMeal","newMealParams","then","removePassengerFlightMeal","result","passengerSegmentServices","passengerSegmentMeal","editableExtraServicesByPassengers","_","findWhere","serviceItem","scrollToStart","passengersTableContainer","scrollTo","scrollToEnd","scrollWidth","mobileTableScrollHandler","scrollLeft","clientWidth","scrollRight","canScrollRight","canScrollLeft","$apply","availableBySegments","availableByPassengerSegments","checkAllChoose","j","countMeals","mealsIssued","getMealsIssuedLength","item","groupedIssuedExtraServices","meal","getMealInfo","obj","infoMeal","group","splitMeal","selectedMeal","map","selectedMealPassenger","selectedMealPassengerSegment","newMealList","selectedMealItem","tmpItem","copy","totalPrice","Big","div","toFixed","this","find","hasAlias","getAvailablePassengersCount","getParam","mealImagesPath","addOrderInfoListener","groupedEditableExtraServices","$watch","on","5","SeatRossiyaController","$timeout","modifyError","clearFlightPassenger","editable_extra_services","resp","error","seatMap","setSeatMapContainerTopPosition","reset","seatMapContainerTopPosition","jQuery","css","updateSeatMap","loadingSeatMap","seatMapError","hasSeatsWithBabyBassinet","checkExistSeatsWithBabyBassinetBySeatMap","babyBassinetCost","getBabyBassinetCost","paxNum","babyBassinetItem","babyBassinetService","getFirstNotEmptySubListItem","price","currency","value","hasBabyBassinet","decks","deck","cabins","cabin","rows","row","chairs","chair","checkExistSeatsWithBabyBassinetByChair","properties","prop","setPassengerFlightSeat","cabinAllowed","rowNumber","paxId","segId","available","number","commonSubgroup","removeBabyBassinetIfExist","updateSunInfoByFlights","sunInfoByFlights","flight","sunInfo","origincity","departuredate","departuretime","destinationcity","arrivaldate","arrivaltime","getAvailablePassengersCountWrap","count","filter","pax","hasSeats","removePassengerFlightSeat","editableExtraServicesHeap","groupCode","mainSegmentId","passengerId","passengerSegmentSeat","6","OrderRossiyaController","$window","redirect","fancyboxTools","retryPayment","loading","retryRegister","lastName","pnr","location","errorMessage","bindOrder","header","regnum","bindAlowed","showBindOrderSuccessMessage","showBindOrderFailMessage","checkAllPassengersHavePaidService","name","passenger","allExtraServicesByPassengers","segmentServices","segmentWantedService","status","clearSession","goToSearchOrder","openExchange","goToExchange","openRefund","goToRefund","openAddServices","goToAddServices","suffixCount","searchOrder","pnrOrTicketNumber","resultParam","getParamFromLocation","waitPayment","hasFailedServices","showPaymentFrame","openHandler","submitCallback","paymentRedirectTo","ignoreFailedServices","disableOutsideCloseClick","hasBonusCard","ffpSumm","ffpBonus","total","7","PopupMealRossiyaController","setItemIndex","mealIndex","detailedView","open","closeItemPopup","nextItemPopup","prevItemPopup","setAvailablePassengers","availablePassengers","index","currentFlightIndex","mealMenuSubgroupMobileChange","mealMenuSubgroupMobile","switchNext","successSwitch","currentPassengerIndex","switchPrev","arrayString","arrays","Array","isArray","reduce","flat","current","concat","getGroupMeal","totalAmount","totalSumm","close","fancybox","subgroupItems","createOptionsForUiSelect","clearPassengerFlightMeal","getPassengerFlightMeal","mealSelect","8","./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend","./components/baby-bassinet-icon-tooltip/baby-bassinet-icon-tooltip","./components/baby-bassinet-icon/baby-bassinet-icon","./components/es-meal-rossiya/es-meal-rossiya","./components/es-seat-rossiya/es-seat-rossiya","./components/order-rossiya/order-rossiya","./components/popup-meal-rossiya/popup-meal-rossiya"],"mappings":"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","file":"controllers-rossia.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIconLegend', {\r\n    templateUrl: 'components/baby-bassinet-icon-legend/baby-bassinet-icon-legend.html'\r\n});\r\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIconTooltip', {\r\n    templateUrl: 'components/baby-bassinet-icon-tooltip/baby-bassinet-icon-tooltip.html'\r\n});\r\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('babyBassinetIcon', {\r\n    templateUrl: 'components/baby-bassinet-icon/baby-bassinet-icon.html',\r\n    controller: function () {},\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        rfisc: '=rfisc',\r\n        active: '=active',\r\n        disabled: '=disabled'\r\n    }\r\n});\r\n\r\n\r\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esMealRossiya', {\r\n    templateUrl: 'components/es-meal-rossiya/es-meal-rossiya.html',\r\n    controller: ['$scope', '$element','backend', 'utils', MealRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        service: '=service',\r\n        locked: '=locked'\r\n    }\r\n});\r\n\r\nfunction MealRossiyaController($scope, $element, backend, utils) {\r\n\r\n    var vm = this,\r\n        passengersTableContainer = $element.find('div.passengersTableContainer');\r\n\r\n    vm.switchService = switchService;\r\n    vm.selectFlightPassenger = selectFlightPassenger;\r\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\r\n    vm.setPassengerFlightMeal = setPassengerFlightMeal;\r\n    vm.removePassengerFlightMeal = removePassengerFlightMeal;\r\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\r\n    vm.scrollToStart = scrollToStart;\r\n    vm.scrollToEnd = scrollToEnd;\r\n    vm.checkAllChoose = checkAllChoose;\r\n    vm.mealCountChangeHandler = mealCountChangeHandler;\r\n    vm.hasAlias = backend.hasAlias;\r\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\r\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\r\n    vm.getLimitStatus = getLimitStatus;\r\n    vm.getMealInfo = getMealInfo;\r\n\r\n    vm.canScrollRight = true;\r\n    vm.canScrollLeft = false;\r\n\r\n    vm.selectedFlight = 0;\r\n    vm.selectedPassenger = 0;\r\n\r\n    if (backend.getParam('site.externalStorageBaseUrl')) {\r\n        vm.mealImagesPath = backend.getParam('site.externalStorageBaseUrl') + '/img/content/meal';\r\n    } else {\r\n        vm.mealImagesPath = './themes/websky/assets/static/img/content/meal';\r\n    }\r\n\r\n    backend.addOrderInfoListener(function (orderInfo) {\r\n        if (\r\n            orderInfo &&\r\n            orderInfo.groupedEditableExtraServices &&\r\n            orderInfo.groupedEditableExtraServices.meal\r\n        ) {\r\n            orderInfo.groupedEditableExtraServices.meal = splitMeal(orderInfo.groupedEditableExtraServices.meal);\r\n        }\r\n        vm.orderInfo = orderInfo;\r\n    }, false, true);\r\n\r\n    $scope.$watch('vm.service', function () {\r\n        if (vm.mealMenu) {\r\n            updateMealMenu();\r\n        }\r\n    });\r\n\r\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\r\n\r\n    if (vm.service.active) {\r\n        updateMealMenu();\r\n    }\r\n\r\n    function switchService() {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal')) {\r\n            vm.service.active = !vm.service.active;\r\n            if (vm.service.active) {\r\n                selectFirstAvailablePassengerFlight();\r\n            } else {\r\n                backend.removeExtraService({\r\n                    code: 'meal'\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function mealCountChangeHandler(subgroupNum, mealItem, delta) {\r\n\r\n      if(delta < 0) {\r\n        if (!vm.locked) {\r\n            backend.modifyExtraService({\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                subgroup: vm.service.subgroups[subgroupNum],\r\n                amount: (mealItem.alreadySelectedCount || 0) + delta,\r\n                service_type: mealItem.serviceType,\r\n                rfisc: mealItem.rfisc\r\n            });\r\n        }\r\n      }\r\n\r\n      // if countSumm for all meal > limit, don't plus\r\n      if(!getLimitStatus() && delta > 0) {\r\n        if (!vm.locked) {\r\n            backend.modifyExtraService({\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                subgroup: vm.service.subgroups[subgroupNum],\r\n                amount: (mealItem.alreadySelectedCount || 0) + delta,\r\n                service_type: mealItem.serviceType,\r\n                rfisc: mealItem.rfisc\r\n            });\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    function selectFlightPassenger(flightNum, passengerNum) {\r\n        vm.selectedFlight = flightNum;\r\n        vm.selectedPassenger = passengerNum;\r\n        updateMealMenu();\r\n    }\r\n\r\n    function selectFirstAvailablePassengerFlight() {\r\n        vm.selectedFlight = getFirstAvailableFlightNum();\r\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\r\n        updateMealMenu();\r\n    }\r\n\r\n    function updateMealMenu() {\r\n        vm.mealMenu = flattenMealMenu(vm.service.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]);\r\n        if (vm.mealMenuSubgroup === undefined) {\r\n            vm.mealMenuSubgroup = false;\r\n        }\r\n    }\r\n\r\n    function flattenMealMenu(deepMenu) {\r\n        var flatMenu = [];\r\n        if (deepMenu && deepMenu.length) {\r\n            deepMenu.forEach(function (deepMenuItems, subgroupNum) {\r\n                if (deepMenuItems && deepMenuItems.length) {\r\n                    deepMenuItems.forEach(function (deepMenuItem) {\r\n                        deepMenuItem.subgroupNum = subgroupNum;\r\n                        flatMenu.push(deepMenuItem);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        return flatMenu;\r\n    }\r\n\r\n    function setPassengerFlightMeal(subgroupNum, mealItem) {\r\n        var selectedPassengerFlightMeal = getSelectedPassengerFlightMeal(vm.selectedPassenger, vm.selectedFlight),\r\n            newMealParams = {\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                subgroup: vm.service.subgroups[subgroupNum],\r\n                service_type: mealItem.serviceType,\r\n                rfisc: mealItem.rfisc\r\n            };\r\n        if (!vm.locked) {\r\n            if (\r\n                selectedPassengerFlightMeal &&\r\n                !backend.checkServiceRemovalProhibited('meal', vm.selectedPassenger, vm.selectedFlight)\r\n            ) {\r\n                backend.removeExtraService({\r\n                    code: 'meal',\r\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\r\n                    service_type: selectedPassengerFlightMeal.serviceType,\r\n                    rfisc: selectedPassengerFlightMeal.rfisc\r\n                }, true).then(function () {\r\n                    backend.modifyExtraService(newMealParams);\r\n                });\r\n            } else {\r\n                backend.modifyExtraService(newMealParams);\r\n            }\r\n        }\r\n    }\r\n\r\n    function removePassengerFlightMeal(passengerNum, flightNum) {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal', passengerNum, flightNum)) {\r\n            backend.removeExtraService({\r\n                code: 'meal',\r\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\r\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\r\n            });\r\n        }\r\n    }\r\n\r\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\r\n        var result,\r\n            passengerSegmentServices,\r\n            passengerSegmentMeal;\r\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\r\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\r\n                /* jshint maxlen: 150 */\r\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\r\n                if (passengerSegmentServices) {\r\n                    passengerSegmentMeal = _.findWhere(passengerSegmentServices, { code: 'meal' });\r\n                    if (passengerSegmentMeal) {\r\n                        result = passengerSegmentMeal.serviceItem;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function scrollToStart() {\r\n        passengersTableContainer.scrollTo(0);\r\n    }\r\n\r\n    function scrollToEnd() {\r\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\r\n    }\r\n\r\n    function mobileTableScrollHandler() {\r\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\r\n            scrollWidth = passengersTableContainer[0].scrollWidth,\r\n            clientWidth = passengersTableContainer[0].clientWidth,\r\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\r\n        vm.canScrollRight = (scrollRight !== 0);\r\n        vm.canScrollLeft = (scrollLeft !== 0);\r\n        $scope.$apply();\r\n    }\r\n\r\n    function getFirstAvailableFlightNum() {\r\n        var i;\r\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n            if (vm.service.availableBySegments[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function getFirstAvailablePassengerNum(flightNum) {\r\n        var i;\r\n        if (vm.service.availableByPassengerSegments) {\r\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\r\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function checkAllChoose() {\r\n\r\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\r\n          if (getSelectedPassengerFlightMeal(j, i)) {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    function getLimitStatus() {\r\n      var countMeals = 0,\r\n          selectedPassenger = vm.selectedPassenger || 0,\r\n          selectedFlight = vm.selectedFlight || 0,\r\n          mealsIssued = getMealsIssuedLength(selectedPassenger, selectedFlight);\r\n\r\n      vm.mealMenu.forEach(function(item) {\r\n          countMeals += item.alreadySelectedCount;\r\n      });\r\n\r\n      countMeals += mealsIssued;\r\n\r\n      return (countMeals >= 3) ? true : false;\r\n    }\r\n\r\n    function getMealsIssuedLength(selectedPassenger, selectedFlight) {\r\n        if (\r\n            vm.orderInfo.groupedIssuedExtraServices &&\r\n            vm.orderInfo.groupedIssuedExtraServices.meal &&\r\n            vm.orderInfo.groupedIssuedExtraServices.meal[selectedPassenger] &&\r\n            vm.orderInfo.groupedIssuedExtraServices.meal[selectedPassenger][selectedFlight] &&\r\n            vm.orderInfo.groupedIssuedExtraServices.meal[selectedPassenger][selectedFlight].length\r\n        ) {\r\n            return vm.orderInfo.groupedIssuedExtraServices.meal[selectedPassenger][selectedFlight].length;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    function getMealInfo(obj) {\r\n      var infoMeal = {\r\n        group: 0,\r\n        meal: {}\r\n      }\r\n\r\n      for (var i = 0; i < vm.mealMenu.length; i++) {\r\n        if(vm.mealMenu[i].rfisc == obj.rfisc) {\r\n          infoMeal.meal = vm.mealMenu[i];\r\n          infoMeal.group = vm.mealMenu[i].subgroupNum;\r\n        }\r\n      }\r\n\r\n      return infoMeal;\r\n    }\r\n\r\n    function splitMeal(selectedMeal) {\r\n        if (selectedMeal && selectedMeal.length) {\r\n            selectedMeal = selectedMeal.map(function (selectedMealPassenger) {\r\n                if (selectedMealPassenger && selectedMealPassenger.length) {\r\n                    selectedMealPassenger = selectedMealPassenger.map(function (selectedMealPassengerSegment) {\r\n                        var newMealList = [];\r\n                        if (selectedMealPassengerSegment && selectedMealPassengerSegment.length) {\r\n                            selectedMealPassengerSegment.forEach(function (selectedMealItem) {\r\n                                var tmpItem;\r\n                                if (selectedMealItem && selectedMealItem.amount) {\r\n                                    tmpItem = angular.copy(selectedMealItem);\r\n                                    tmpItem.amount = 1;\r\n                                    tmpItem.totalPrice = Big(selectedMealItem.totalPrice).div(selectedMealItem.amount).toFixed(2);\r\n                                    for (var i=0; i<selectedMealItem.amount; i++) {\r\n                                        newMealList.push(tmpItem);\r\n                                    }\r\n                                }\r\n                            });\r\n                            selectedMealPassengerSegment = newMealList;\r\n                        }\r\n                        return selectedMealPassengerSegment;\r\n                    });\r\n                }\r\n                return selectedMealPassenger;\r\n            });\r\n        }\r\n        return selectedMeal;\r\n    }\r\n\r\n}\r\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esSeatRossiya', {\r\n    templateUrl: 'components/es-seat-rossiya/es-seat-rossiya.html',\r\n    controller: ['$scope', '$element', '$timeout', 'backend', 'utils', SeatRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        service: '=service',\r\n        babyBassinetService: '=',\r\n        locked: '=locked'\r\n    }\r\n});\r\n\r\nfunction SeatRossiyaController($scope, $element, $timeout, backend, utils) {\r\n\r\n    var vm = this,\r\n        passengersTableContainer = $element.find('div.passengersTableContainer'),\r\n        seatMapContainerTopPosition = '0px';\r\n\r\n    vm.switchService = switchService;\r\n\r\n    vm.selectFlightPassenger = selectFlightPassenger;\r\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\r\n    vm.setPassengerFlightSeat = setPassengerFlightSeat;\r\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\r\n    vm.checkAllChoose = checkAllChoose;\r\n\r\n    vm.hasAlias = backend.hasAlias;\r\n\r\n    vm.scrollToStart = scrollToStart;\r\n    vm.scrollToEnd = scrollToEnd;\r\n\r\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\r\n    vm.getAvailablePassengersCountWrap = getAvailablePassengersCountWrap;\r\n\r\n    vm.removePassengerFlightSeat = removePassengerFlightSeat;\r\n\r\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\r\n\r\n    vm.canScrollRight = true;\r\n    vm.canScrollLeft = false;\r\n\r\n    backend.addOrderInfoListener(function (orderInfo) {\r\n        vm.orderInfo = orderInfo;\r\n    }, false, true);\r\n\r\n    updateSunInfoByFlights();\r\n\r\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\r\n\r\n    if (vm.service.active) {\r\n        selectFirstAvailablePassengerFlight();\r\n    }\r\n\r\n    function switchService() {\r\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('seat')) {\r\n            vm.service.active = !vm.service.active;\r\n            if (vm.service.active) {\r\n                selectFirstAvailablePassengerFlight();\r\n            } else {\r\n                vm.modifyError = false;\r\n                backend.removeExtraService({\r\n                    code: 'seat'\r\n                }).then(function () {\r\n                    clearFlightPassenger();\r\n                    if (\r\n                        vm.orderInfo.editable_extra_services &&\r\n                        _.findWhere(vm.orderInfo.editable_extra_services, { code: 'babyBassinet' })\r\n                    ) {\r\n                        backend.removeExtraService({\r\n                            code: 'babyBassinet'\r\n                        })\r\n                    }\r\n                }, function (resp) {\r\n                    if (resp.error) {\r\n                        vm.modifyError = resp.error;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function clearFlightPassenger() {\r\n        vm.seatMap = false;\r\n        vm.selectedFlight = -1;\r\n        vm.selectedPassenger = -1;\r\n    }\r\n\r\n    function setSeatMapContainerTopPosition(reset) {\r\n        if (reset) {\r\n            seatMapContainerTopPosition = '0px';\r\n        } else {\r\n            seatMapContainerTopPosition = jQuery('.passengersSeatMap').find('.mCSB_container').css('top');\r\n        }\r\n    }\r\n\r\n    function selectFlightPassenger(flightNum, passengerNum) {\r\n        // Нужно запомнить положение карты мест для переключения между пассажирами одного сегмента\r\n        setSeatMapContainerTopPosition(vm.selectedFlight !== flightNum);\r\n        vm.selectedFlight = flightNum;\r\n        vm.selectedPassenger = passengerNum;\r\n        updateSeatMap();\r\n    }\r\n\r\n    function selectFirstAvailablePassengerFlight() {\r\n        vm.selectedFlight = getFirstAvailableFlightNum();\r\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\r\n        updateSeatMap();\r\n    }\r\n\r\n    function updateSeatMap() {\r\n\r\n        if (vm.selectedPassenger !== -1 && vm.selectedFlight !== -1) {\r\n            vm.loadingSeatMap = true;\r\n            vm.seatMapError = false;\r\n            backend.seatMap(\r\n                vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n                vm.orderInfo.plainFlights[vm.selectedFlight].id\r\n            ).then(function (resp) {\r\n                vm.seatMap = resp;\r\n                vm.seatMap.hasSeatsWithBabyBassinet = checkExistSeatsWithBabyBassinetBySeatMap(resp);\r\n                if (vm.seatMap.hasSeatsWithBabyBassinet) {\r\n                    vm.seatMap.babyBassinetCost = getBabyBassinetCost();\r\n                }\r\n                vm.loadingSeatMap = false;\r\n\r\n                $timeout(function () {\r\n                    jQuery('.passengersSeatMap').find('.mCSB_container').css('top', seatMapContainerTopPosition);\r\n                });\r\n            }, function (resp) {\r\n                vm.seatMapError = resp.error;\r\n                vm.loadingSeatMap = false;\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    function getBabyBassinetCost(paxNum, flightNum) {\r\n        var babyBassinetItem;\r\n        if (\r\n            vm.babyBassinetService &&\r\n            vm.babyBassinetService.itemsByPassengerSegments &&\r\n            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger] &&\r\n            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]\r\n        ) {\r\n            babyBassinetItem = utils.getFirstNotEmptySubListItem(vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]);\r\n            if (\r\n                babyBassinetItem &&\r\n                babyBassinetItem.price &&\r\n                babyBassinetItem.currency\r\n            ) {\r\n                return {\r\n                    value: babyBassinetItem.price,\r\n                    currency: babyBassinetItem.currency\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function checkExistSeatsWithBabyBassinetBySeatMap(seatMap) {\r\n        var hasBabyBassinet = false;\r\n        if (seatMap && seatMap.decks) {\r\n            seatMap.decks.forEach(function (deck) {\r\n                if (deck && deck.cabins) {\r\n                    deck.cabins.forEach(function (cabin) {\r\n                        if (cabin && cabin.rows) {\r\n                            cabin.rows.forEach(function (row) {\r\n                                if (row && row.chairs) {\r\n                                    row.chairs.forEach(function (chair) {\r\n                                        if (checkExistSeatsWithBabyBassinetByChair(chair)) {\r\n                                            hasBabyBassinet = true;\r\n                                        }\r\n                                    });\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        return hasBabyBassinet;\r\n    }\r\n\r\n    function checkExistSeatsWithBabyBassinetByChair(chair) {\r\n        var hasBabyBassinet = false;\r\n        if (chair && chair.properties) {\r\n            chair.properties.forEach(function (prop) {\r\n                if (prop === 'babyBassinet') {\r\n                    hasBabyBassinet = true\r\n                    chair.hasBabyBassinet = true\r\n                }\r\n            });\r\n        }\r\n        return hasBabyBassinet;\r\n    }\r\n\r\n    function setPassengerFlightSeat(chair, cabinAllowed, rowNumber) {\r\n        var babyBassinetItem,\r\n            paxId = vm.orderInfo.passengers[vm.selectedPassenger].id,\r\n            segId = vm.orderInfo.plainFlights[vm.selectedFlight].id;\r\n        if (!vm.locked) {\r\n            if (chair.available && cabinAllowed) {\r\n                //setSeatMapContainerTopPosition();\r\n\r\n                seatMapContainerTopPosition = jQuery('.passengersSeatMap').find('.mCSB_container').css('top');\r\n\r\n                vm.modifyError = false;\r\n\r\n                backend.modifyExtraService({\r\n                    code: 'seat',\r\n                    passenger_id: paxId,\r\n                    segment_id: segId,\r\n                    value: rowNumber + chair.number,\r\n                    subgroup: vm.service.commonSubgroup,\r\n                    rfisc: chair.rfisc || '',\r\n                    service_type: 'F'\r\n                }).then(function () {\r\n                    updateSeatMap();\r\n\r\n                    if (checkExistSeatsWithBabyBassinetByChair(chair)) {\r\n                        if (\r\n                            vm.babyBassinetService &&\r\n                            vm.babyBassinetService.itemsByPassengerSegments &&\r\n                            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger] &&\r\n                            vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]\r\n                        ) {\r\n                            babyBassinetItem = utils.getFirstNotEmptySubListItem(vm.babyBassinetService.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight]);\r\n                            if (\r\n                                babyBassinetItem &&\r\n                                babyBassinetItem.serviceType &&\r\n                                babyBassinetItem.rfisc\r\n                            ) {\r\n                                backend.modifyExtraService({\r\n                                    code: 'babyBassinet',\r\n                                    passenger_id: paxId,\r\n                                    segment_id: segId,\r\n                                    subgroup: vm.babyBassinetService.commonSubgroup,\r\n                                    rfisc: babyBassinetItem.rfisc,\r\n                                    service_type: babyBassinetItem.serviceType\r\n                                })\r\n                            }\r\n                        }\r\n                    } else {\r\n                        removeBabyBassinetIfExist(paxId, segId);\r\n                    }\r\n                }, function (resp) {\r\n                    if (resp.error) {\r\n                        vm.modifyError = resp.error;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    function updateSunInfoByFlights() {\r\n        vm.sunInfoByFlights = [];\r\n        vm.orderInfo.plainFlights.forEach(function (flight, flightNum) {\r\n            backend.sunInfo(\r\n                flight.origincity,\r\n                flight.departuredate,\r\n                flight.departuretime,\r\n                flight.destinationcity,\r\n                flight.arrivaldate,\r\n                flight.arrivaltime\r\n            ).then(function (resp) {\r\n                vm.sunInfoByFlights[flightNum] = resp;\r\n            });\r\n        });\r\n    }\r\n\r\n    function getFirstAvailableFlightNum() {\r\n        var i;\r\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n            if (vm.service.availableBySegments[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function getFirstAvailablePassengerNum(flightNum) {\r\n        var i;\r\n        if (vm.service.availableByPassengerSegments) {\r\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\r\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    function scrollToStart() {\r\n        passengersTableContainer.scrollTo(0);\r\n    }\r\n\r\n    function scrollToEnd() {\r\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\r\n    }\r\n\r\n    function mobileTableScrollHandler() {\r\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\r\n            scrollWidth = passengersTableContainer[0].scrollWidth,\r\n            clientWidth = passengersTableContainer[0].clientWidth,\r\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\r\n        vm.canScrollRight = (scrollRight !== 0);\r\n        vm.canScrollLeft = (scrollLeft !== 0);\r\n        $scope.$apply();\r\n    }\r\n\r\n    function getAvailablePassengersCountWrap(availableByPassengerSegments) {\r\n        var count = utils.getAvailablePassengersCount(availableByPassengerSegments);\r\n        return count + vm.orderInfo.passengers.filter(function (pax) {\r\n            return !pax.hasSeats;\r\n        }).length;\r\n    }\r\n\r\n    function removePassengerFlightSeat(passengerNum, flightNum) {\r\n        var paxId = vm.orderInfo.passengers[passengerNum].id,\r\n            segId = vm.orderInfo.plainFlights[flightNum].id;\r\n        if (\r\n            !vm.locked && !backend.checkServiceRemovalProhibited('seat', passengerNum, flightNum)\r\n        ) {\r\n            vm.modifyError = false;\r\n\r\n            backend.removeExtraService({\r\n                code: 'seat',\r\n                passenger_id: paxId,\r\n                segment_id: segId\r\n            }).then(function () {\r\n                removeBabyBassinetIfExist(paxId, segId);\r\n                if (vm.selectedFlight === flightNum) {\r\n                    updateSeatMap();\r\n                }\r\n            }, function (resp) {\r\n                if (resp.error) {\r\n                    vm.modifyError = resp.error;\r\n                }\r\n            });\r\n\r\n\r\n        }\r\n    }\r\n\r\n    function removeBabyBassinetIfExist(paxId, segId) {\r\n        if (\r\n            vm.orderInfo.editableExtraServicesHeap &&\r\n            _.findWhere(\r\n                vm.orderInfo.editableExtraServicesHeap,\r\n                {\r\n                    groupCode: 'babyBassinet',\r\n                    mainSegmentId: segId,\r\n                    passengerId: paxId\r\n                }\r\n            )\r\n        ) {\r\n            backend.removeExtraService({\r\n                code: 'babyBassinet',\r\n                passenger_id: paxId,\r\n                segment_id: segId\r\n            })\r\n        }\r\n    }\r\n\r\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\r\n        var result,\r\n            passengerSegmentServices,\r\n            passengerSegmentSeat;\r\n        if (vm.orderInfo.editableExtraServicesByPassengers) {\r\n            if (vm.orderInfo.editableExtraServicesByPassengers[passengerNum]) {\r\n                /* jshint maxlen: 150 */\r\n                passengerSegmentServices = vm.orderInfo.editableExtraServicesByPassengers[passengerNum].passengerSegmentServices[flightNum];\r\n                if (passengerSegmentServices) {\r\n                    passengerSegmentSeat = _.findWhere(passengerSegmentServices, { code: 'seat' });\r\n                    if (passengerSegmentSeat) {\r\n                        result = passengerSegmentSeat.serviceItem;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function checkAllChoose() {\r\n\r\n      for (var i = 0; i < vm.orderInfo.plainFlights.length; i++) {\r\n        for (var j = 0; j < vm.orderInfo.passengers.length; j++) {\r\n          if (getSelectedPassengerFlightMeal(j, i)) {\r\n            return true\r\n          }\r\n        }\r\n      }\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n}\r\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\r\nangular.module('app').component('orderRossiya', {\r\n    templateUrl: 'components/order-rossiya/order-rossiya.html',\r\n    controller: ['$window', '$timeout', 'backend', 'utils', 'redirect', 'fancyboxTools', OrderRossiyaController],\r\n    controllerAs: 'vm',\r\n    bindings: {\r\n        pnrOrTicketNumber: '=num',\r\n        lastName: '=lastname'\r\n    }\r\n});\r\n\r\nfunction OrderRossiyaController($window, $timeout, backend, utils, redirect, fancyboxTools) {\r\n\r\n    var vm = this;\r\n    vm.loading = true;\r\n    vm.errorMessage = false;\r\n    vm.openExchange = redirect.goToExchange;\r\n    vm.openRefund = redirect.goToRefund;\r\n    vm.openAddServices = redirect.goToAddServices;\r\n    vm.suffixCount = utils.suffixCount;\r\n    vm.retryPayment = retryPayment;\r\n    vm.bindOrder = bindOrder;\r\n    vm.checkAllPassengersHavePaidService = checkAllPassengersHavePaidService;\r\n    vm.clearSession = clearSession;\r\n\r\n    backend.searchOrder(vm.pnrOrTicketNumber, vm.lastName).then(function (orderInfo) {\r\n\r\n        var resultParam = utils.getParamFromLocation('result');\r\n\r\n        vm.orderInfo = orderInfo;\r\n\r\n        if (\r\n            vm.orderInfo.header &&\r\n            (\r\n                vm.orderInfo.header.status === 'being_paid' ||\r\n                vm.orderInfo.header.status === 'being_paid_for_exchange'\r\n            )\r\n        ) {\r\n            if (resultParam === 'success') {\r\n                backend.waitPayment(vm.orderInfo.header.regnum, vm.lastName).then(function () {\r\n                    $window.location = './order?pnr=' + vm.orderInfo.header.regnum + '&lastName=' + vm.lastName + '&result=success';\r\n                    return;\r\n                }, function () {\r\n                    vm.loading = false;\r\n                });\r\n            } else {\r\n                if (!vm.orderInfo.hasFailedServices) {\r\n                    vm.showPaymentFrame = true;\r\n                }\r\n                vm.loading = false;\r\n            }\r\n        } else {\r\n            vm.loading = false;\r\n        }\r\n\r\n        if (\r\n            vm.orderInfo.hasFailedServices &&\r\n            !resultParam &&\r\n            vm.orderInfo.header &&\r\n            (\r\n                vm.orderInfo.header.status === 'being_paid' ||\r\n                vm.orderInfo.header.status === 'booked'\r\n            )\r\n        ) {\r\n            $timeout(function () {\r\n                fancyboxTools.openHandler('popupRemovedServicesWarning', false, {\r\n                    submitCallback: function () {\r\n                        if (vm.orderInfo.paymentRedirectTo) {\r\n                            vm.showPaymentFrame = true;\r\n                        }\r\n                        vm.ignoreFailedServices = true;\r\n                    },\r\n                    disableOutsideCloseClick: true\r\n                });\r\n            });\r\n        }\r\n\r\n\r\n        if (\r\n            backend.getParam('ffp.enable') &&\r\n            (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)\r\n        ) {\r\n            backend.ffpBonus().then(function (resp) {\r\n                vm.ffpBonus = resp.total || 0;\r\n            });\r\n        }\r\n\r\n    }, function (resp) {\r\n        vm.loading = false;\r\n        vm.errorMessage = resp.error;\r\n    });\r\n\r\n    function retryPayment() {\r\n        vm.loading = true;\r\n        backend.retryRegister().then(function (resp) {\r\n            if (resp.lastName && resp.pnr) {\r\n                $window.location = './order?pnr=' + resp.pnr + '&lastName=' + resp.lastName;\r\n            } else {\r\n                vm.loading = false;\r\n            }\r\n        }, function (resp) {\r\n            vm.loading = false;\r\n            vm.errorMessage = resp.error;\r\n        });\r\n    }\r\n\r\n    function bindOrder() {\r\n        if (!vm.orderInfo.header || !vm.orderInfo.header.regnum) {\r\n            return;\r\n        }\r\n        vm.loading = true;\r\n        backend.bindOrder(vm.orderInfo.header.regnum, vm.lastName).then(function () {\r\n            vm.loading = false;\r\n            vm.orderInfo.bindAlowed = false;\r\n            vm.showBindOrderSuccessMessage = true;\r\n            $timeout(function () {\r\n                vm.showBindOrderSuccessMessage = false;\r\n            }, 10000);\r\n        }, function () {\r\n            vm.loading = false;\r\n            vm.showBindOrderFailMessage = true;\r\n            $timeout(function () {\r\n                vm.showBindOrderFailMessage = false;\r\n            }, 10000);\r\n        });\r\n    }\r\n\r\n    function checkAllPassengersHavePaidService(name) {\r\n        var result = true;\r\n        vm.orderInfo.passengers.forEach(function (passenger, passengerNum) {\r\n            if (\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers &&\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum] &&\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices\r\n\t\t\t) {\r\n\t\t\t\tvm.orderInfo.allExtraServicesByPassengers[passengerNum].passengerSegmentServices.forEach(\r\n\t\t\t\t\tfunction (segmentServices) {\r\n\t\t\t\t\t\tvar segmentWantedService = _.findWhere(segmentServices, { code: name });\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t!segmentServices || !segmentWantedService ||\r\n\t\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t\tsegmentWantedService &&\r\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem &&\r\n\t\t\t\t\t\t\t\tsegmentWantedService.serviceItem.status !== 'ISSUED_WITH_EMD'\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tresult = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tresult = false;\r\n\t\t\t}\r\n        });\r\n        return result;\r\n    }\r\n\r\n    function clearSession() {\r\n        backend.clearSession().then(function () {\r\n            redirect.goToSearchOrder();\r\n        });\r\n    }\r\n\r\n}\r\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('popupMealRossiya', {\r\n\ttemplateUrl: 'components/popup-meal-rossiya/popup-meal-rossiya.html',\r\n\tcontroller: ['utils', '$scope', PopupMealRossiyaController],\r\n\tcontrollerAs: 'vm',\r\n\tbindings: {\r\n\t\tmealMenu: '=menu',\r\n\t\tpassenger: '=passenger',\r\n\t\tcurrentPassengerIndex: '=',\r\n\t\tcurrentFlightIndex: '=',\r\n\t\tpassengers: '=passengers',\r\n\t\tflight: '=flight',\r\n\t\tmealCountChangeHandler: '=handler',\r\n\t\tclearPassengerFlightMeal: '&remove',\r\n\t\tgetPassengerFlightMeal: '=get',\r\n\t\tsubgroups: '=subgroups',\r\n\t\tmealImagesPath: '=path',\r\n\t\tservice: '=',\r\n\t\tselectFlightPassenger: '=select',\r\n\t\tgetLimitStatus: '=limit',\r\n\t\tmealSelect: '=',\r\n\t\tgetMealInfo: '='\r\n\t}\r\n});\r\n\r\nfunction PopupMealRossiyaController(utils, $scope) {\r\n\r\n\tvar vm = this;\r\n\tvm.close = jQuery.fancybox.close;\r\n\tvm.mealMenuSubgroupMobileChange = mealMenuSubgroupMobileChange;\r\n\tvm.mealMenuSubgroup = false;\r\n\tvm.mealMenuSubgroupMobile = 'false';\r\n\tvm.subgroupItems = utils.createOptionsForUiSelect(vm.subgroups, 'all');\r\n\tvm.switchNext = switchNext;\r\n\tvm.switchPrev = switchPrev;\r\n\tvm.arrayString = arrayString;\r\n\tvm.getGroupMeal = getGroupMeal;\r\n\r\n\tvm.detailedView = {open: false};\r\n\tvm.setItemIndex = setItemIndex;\r\n\tvm.closeItemPopup = closeItemPopup;\r\n\tvm.nextItemPopup = nextItemPopup;\r\n\tvm.prevItemPopup = prevItemPopup;\r\n\r\n\tvm.totalAmount = totalAmount;\r\n\r\n\tfunction setItemIndex(mealIndex) {\r\n\r\n\t\tvm.detailedView.open = true;\r\n\t\tvm.detailedView.mealIndex = mealIndex;\r\n\r\n\t}\r\n\r\n\tfunction closeItemPopup() {\r\n\t\tvm.detailedView.open = false;\r\n\t}\r\n\r\n\tfunction nextItemPopup() {\r\n\r\n\t\tif (vm.detailedView.mealIndex < (vm.mealMenu.length - 1)) {\r\n\t\t\tvm.detailedView.mealIndex++;\r\n\t\t} else {\r\n\t\t\tvm.detailedView.mealIndex = 0;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction prevItemPopup() {\r\n\r\n\t\tif (vm.detailedView.mealIndex > 0) {\r\n\t\t\tvm.detailedView.mealIndex--;\r\n\t\t} else {\r\n\t\t\tvm.detailedView.mealIndex = vm.mealMenu.length - 1;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setAvailablePassengers() {\r\n\t\tvm.availablePassengers = vm.passengers.filter(function (passenger, index) {\r\n\t\t\treturn (\r\n\t\t\t\tvm.service.availableByPassengerSegments[index] &&\r\n\t\t\t\tvm.service.availableByPassengerSegments[index][vm.currentFlightIndex]\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t$scope.$watch('vm.currentFlightIndex', function () {\r\n\t\tsetAvailablePassengers();\r\n\t});\r\n\r\n\tfunction mealMenuSubgroupMobileChange() {\r\n\t\tif (vm.mealMenuSubgroupMobile === false) {\r\n\t\t\tvm.mealMenuSubgroup = false;\r\n\t\t} else {\r\n\t\t\tvm.mealMenuSubgroup = vm.mealMenuSubgroupMobile * 1;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction switchNext() {\r\n\t\tvar successSwitch = false;\r\n\t\tfor (var i = vm.currentPassengerIndex + 1; i < vm.passengers.length; i++) {\r\n\t\t\tif (\r\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\r\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\r\n\t\t\t) {\r\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\r\n\t\t\t\tsuccessSwitch = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!successSwitch) {\r\n\t\t\tfor (var j = 0; j < vm.passengers.length; j++) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\r\n\t\t\t\t) {\r\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction switchPrev() {\r\n\t\tvar successSwitch = false;\r\n\t\tfor (var i = vm.currentPassengerIndex - 1; i > -1; i--) {\r\n\t\t\tif (\r\n\t\t\t\tvm.service.availableByPassengerSegments[i] &&\r\n\t\t\t\tvm.service.availableByPassengerSegments[i][vm.currentFlightIndex]\r\n\t\t\t) {\r\n\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, i);\r\n\t\t\t\tsuccessSwitch = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!successSwitch) {\r\n\t\t\tfor (var j = vm.passengers.length - 1; j > -1; j--) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j] &&\r\n\t\t\t\t\tvm.service.availableByPassengerSegments[j][vm.currentFlightIndex]\r\n\t\t\t\t) {\r\n\t\t\t\t\tvm.selectFlightPassenger(vm.currentFlightIndex, j);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction arrayString(arrays) {\r\n\r\n\t\tif(!Array.isArray(arrays)) return;\r\n\r\n\t\tvar total = arrays.reduce(function(flat, current) {\r\n\t\t\treturn flat.concat(current);\r\n\t\t}, []);\r\n\r\n\t\tif(vm.mealMenuSubgroup === false ) return total;\r\n\r\n\t\treturn arrays;\r\n\t}\r\n\r\n\tfunction getGroupMeal(meal, arrays) {\r\n\r\n\t\tfor (var i = 0; i < arrays.length; i++) {\r\n\t\t\tfor(var j = 0; j < arrays[i].length; j++) {\r\n\t\t\t\tif (arrays[i][j]['rfisc'] == meal['rfisc']) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction totalAmount() {\r\n\t\tvm.mealMenu = vm.mealMenu || [];\r\n\r\n\t\tvar totalSumm = 0;\r\n\r\n\t\tfor (var i = 0; i < vm.mealMenu.length; i++) {\r\n\t\t\tfor(var j = 0; j < vm.mealMenu[i].length; j++) {\r\n\t\t\t\tif(vm.mealMenu[i][j].alreadySelectedCount) {\r\n\t\t\t\t\ttotalSumm += ( vm.mealMenu[i][j].price * vm.mealMenu[i][j].alreadySelectedCount );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn totalSumm;\r\n\t}\r\n\r\n}\r\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\nrequire('./components/popup-meal-rossiya/popup-meal-rossiya');\r\nrequire('./components/es-meal-rossiya/es-meal-rossiya');\r\nrequire('./components/es-seat-rossiya/es-seat-rossiya');\r\nrequire('./components/order-rossiya/order-rossiya');\r\nrequire('./components/baby-bassinet-icon/baby-bassinet-icon');\r\nrequire('./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend');\r\nrequire('./components/baby-bassinet-icon-tooltip/baby-bassinet-icon-tooltip');\n},{\"./components/baby-bassinet-icon-legend/baby-bassinet-icon-legend\":1,\"./components/baby-bassinet-icon-tooltip/baby-bassinet-icon-tooltip\":2,\"./components/baby-bassinet-icon/baby-bassinet-icon\":3,\"./components/es-meal-rossiya/es-meal-rossiya\":4,\"./components/es-seat-rossiya/es-seat-rossiya\":5,\"./components/order-rossiya/order-rossiya\":6,\"./components/popup-meal-rossiya/popup-meal-rossiya\":7}]},{},[8]);\n"]}